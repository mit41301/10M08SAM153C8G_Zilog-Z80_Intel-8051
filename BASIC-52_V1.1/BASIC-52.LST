
ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 1





       MCS-51 Family Macro Assembler   A S E M - 5 1   V 1.3
       =====================================================



	Source File:	basic-52.src
	Object File:	basic-52.hex
	List File:	basic-52.lst



 Line  I  Addr  Code            Source

    1:				;  December 18, 1986
    2:				;  MS-DOS compatible Source code for MCS BASIC-52 (tm)
    3:				;  Assembles with ASM51 Macro Assembler Version 2.2
    4:				;
    5:				;  The following source code does not include the floating point math
    6:				;  routines. These are seperately compiled using FP52.SRC.
    7:				;
    8:				;  Both the BASIC.SRC and FP52.SRC programs assemble into ABSOLUTE
    9:				;  object files, and do not need to be relocated or linked. The FP52
   10:				;  object code and the BASIC object code, when compiled without modification
   11:				;  of the source listings, create the same object code that is found on
   12:				;  the MCS BASIC-52 Version 1.1 microcontrollers.
   13:				;
   14:				;  The original source code had 7 "include" files that have been incorporated
   15:				;  into this file for ease of assembly.
   16:				;  These 7 files are: LOOK52.SRC, BAS52.RST, BAS52.PGM, BAS52.TL, BAS52.OUT,
   17:				;  BAS52.PWM, and BAS52.CLK.
   18:				;
   19:				;
   20:				;                       Intel Corporation, Embedded Controller Operations
   21:
   22:				$EJECT

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 2



 Line  I  Addr  Code            Source

   23:					;**************************************************************
   24:					;
   25:					; TRAP VECTORS TO MONITOR
   26:					;
   27:					; RESET TAG (0AAH) ---------2001H
   28:					;
   29:					; TAG LOCATION (5AH) ------ 2002H
   30:					;
   31:					; EXTERNAL INTERRUPT 0 ---- 2040H
   32:					;
   33:					; COMMAND MODE ENTRY ------ 2048H
   34:					;
   35:					; SERIAL PORT ------------- 2050H
   36:					;
   37:					; MONITOR (BUBBLE) OUTPUT - 2058H
   38:					;
   39:					; MONITOR (BUBBLE) INPUT -- 2060H
   40:					;
   41:					; MONITOR (BUBBLE) CSTS --- 2068H
   42:					;
   43:					; GET USER JUMP VECTOR ---- 2070H
   44:					;
   45:					; GET USER LOOKUP VECTOR -- 2078H
   46:					;
   47:					; PRINT AT VECTOR --------- 2080H
   48:					;
   49:					; INTERRUPT PWM ----------- 2088H
   50:					;
   51:					; EXTERNAL RESET ---------- 2090H
   52:					;
   53:					; USER OUTPUT-------------- 4030H
   54:					;
   55:					; USER INPUT -------------- 4033H
   56:					;
   57:					; USER CSTS --------------- 4036H
   58:					;
   59:					; USER RESET -------------- 4039H
   60:					;
   61:					; USER DEFINED PRINT @ ---  403CH
   62:					;
   63:					;***************************************************************
   64:					;
   65:				$EJECT

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 3



 Line  I  Addr  Code            Source

   66:					;***************************************************************
   67:					;
   68:					; MCS - 51  -  8K BASIC VERSION 1.1
   69:					;
   70:					;***************************************************************
   71:					;
   72:	  0000	61 87			AJMP	CRST		;START THE PROGRAM
   73:					;
   74:		N      0003		ORG	3H
   75:					;
   76:					;***************************************************************
   77:					;
   78:					;EXTERNAL INTERRUPT 0
   79:					;
   80:					;***************************************************************
   81:					;
   82:	  0003	20 31 2D		JB	DRQ,STQ		;SEE IF DMA IS SET
   83:	  0006	C0 D0			PUSH	PSW		;SAVE THE STATUS
   84:	  0008	02 40 03		LJMP	4003H		;JUMP TO USER IF NOT SET
   85:					;
   86:		N      000B		ORG	0BH
   87:					;
   88:					;***************************************************************
   89:					;
   90:					;TIMER 0 OVERFLOW INTERRUPT
   91:					;
   92:					;***************************************************************
   93:					;
   94:	  000B	C0 D0			PUSH	PSW		;SAVE THE STATUS
   95:	  000D	20 2E 10		JB	C_BIT,STJ	;SEE IF USER WANTS INTERRUPT
   96:	  0010	02 40 0B		LJMP	400BH		;EXIT IF USER WANTS INTERRUPTS
   97:					;
   98:		N      0013		ORG	13H
   99:					;
  100:					;***************************************************************
  101:					;
  102:					;EXTERNAL INTERRUPT 1
  103:					;
  104:					;***************************************************************
  105:					;
  106:	  0013	20 12 2B		JB	INTBIT,STK
  107:	  0016	C0 D0			PUSH	PSW
  108:	  0018	02 40 13		LJMP	4013H
  109:					;
  110:				$EJECT

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 4



 Line  I  Addr  Code            Source

  111:					;
  112:		N      001B		ORG	1BH
  113:					;
  114:					;***************************************************************
  115:					;
  116:					;TIMER 1 OVERFLOW INTERRUPT
  117:					;
  118:					;***************************************************************
  119:					;
  120:	  001B	C0 D0			PUSH	PSW
  121:	  001D	02 1F 78		LJMP	CKS_I
  122:					;
  123:	  0020	02 18 FA	STJ:	LJMP	I_DR		;DO THE INTERRUPT
  124:					;
  125:					;***************************************************************
  126:					;
  127:					;SERIAL PORT INTERRUPT
  128:					;
  129:					;***************************************************************
  130:					;
  131:		N      0023		ORG	23H
  132:					;
  133:	  0023	C0 D0			PUSH	PSW
  134:	  0025	20 1F 1C		JB	SPINT,STU	;SEE IF MONITOR EANTS INTERRUPT
  135:	  0028	02 40 23		LJMP	4023H
  136:					;
  137:		N      002B		ORG	2BH
  138:					;
  139:					;**************************************************************
  140:					;
  141:					;TIMER 2 OVERFLOW INTERRUPT
  142:					;
  143:					;**************************************************************
  144:					;
  145:	  002B	C0 D0			PUSH	PSW
  146:	  002D	02 40 2B		LJMP	402BH
  147:					;
  148:				$EJECT

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 5



 Line  I  Addr  Code            Source

  149:					;**************************************************************
  150:					;
  151:					;USER ENTRY
  152:					;
  153:					;**************************************************************
  154:					;
  155:		N      0030		ORG	30H
  156:					;
  157:	  0030	02 19 34		LJMP	IBLK		;LINK TO USER BLOCK
  158:					;
  159:	  0033	20 26 08	STQ:	JB	I_T0,STS	;SEE IF MONITOR WANTS IT
  160:	  0036	C2 96			CLR	DACK
  161:	  0038	30 B2 FD		JNB	P3.2,$		;WAIT FOR DMA TO END
  162:	  003B	D2 96			SETB	DACK
  163:	  003D	32			RETI
  164:					;
  165:	  003E	02 20 40	STS:	LJMP	2040H		;GO TO THE MONITOR
  166:					;
  167:	  0041	D2 16		STK:	SETB	INTPEN		;TELL BASIC AN INTERRUPT WAS RECEIVED
  168:	  0043	32			RETI
  169:					;
  170:	  0044	02 20 50	STU:	LJMP	2050H		;SERIAL PORT INTERRUPT
  171:					;
  172:				$EJECT

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 6



 Line  I  Addr  Code            Source

  173:
  174:				;$INCLUDE(:F2:LOOK52.SRC)
  175:				; INCLUDED BELOW
  176:
  177:					;
  178:					;**************************************************************
  179:					;
  180:					; This is the equate table for 8052 basic.
  181:					;
  182:					;**************************************************************
  183:					;
  184:					; The register to direct equates for CJNE instructions.
  185:					;
  186:		N      0000	R0B0	EQU	0
  187:		N      0001	R1B0	EQU	1
  188:		N      0002	R2B0	EQU	2
  189:		N      0003	R3B0	EQU	3
  190:		N      0004	R4B0	EQU	4
  191:		N      0005	R5B0	EQU	5
  192:		N      0006	R6B0	EQU	6
  193:		N      0007	R7B0	EQU	7
  194:					;
  195:					; Register bank 1 contains the text pointer
  196:					; and the arg stack pointer.
  197:					;
  198:		N      0008	TXAL	EQU	8		;R0 BANK 1 = TEXT POINTER LOW
  199:		N      0009	ASTKA	EQU	9		;R1 BANK 1 = ARG STACK
  200:		N      000A	TXAH	EQU	10		;R2 BANK 1 = TEXT POINTER HIGH
  201:					;
  202:					; Now five temporary locations that are used by basic.
  203:					;
  204:		N      000B	TEMP1	EQU	11
  205:		N      000C	TEMP2	EQU	12
  206:		N      000D	TEMP3	EQU	13
  207:		N      000E	TEMP4	EQU	14
  208:		N      000F	TEMP5	EQU	15
  209:					;
  210:				$EJECT

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 7



 Line  I  Addr  Code            Source

  211:					; Register bank 2 contains the read text pointer
  212:					; and the control stack pointer.
  213:					;
  214:		N      0010	RTXAL	EQU	16		;R0 BANK 2 = READ TEXT POINTER LOW
  215:		N      0011	CSTKA	EQU	17		;R1 BANK 2 = CONTROL STACK POINTER
  216:		N      0012	RTXAH	EQU	18		;R2 BANK 2 = READ TEXT POINTER HIGH
  217:					;
  218:					; Now some internal system equates.
  219:					;
  220:		N      0013	BOFAH	EQU	19		;START OF THE BASIC PROGRAM, HIGH BYTE
  221:		N      0014	BOFAL	EQU	20		;START OF THE BASIC PROGRAM, LOW BYTE
  222:		N      0015	NULLCT	EQU	21		;NULL COUNT
  223:		N      0016	PHEAD	EQU	22		;PRINT HEAD POSITION
  224:		N      0017	FORMAT	EQU	23
  225:					;
  226:					; Register bank 3 is for the user and can be loaded
  227:					; by basic
  228:					;
  229:					;
  230:					;
  231:					; Now everything else is used by basic.
  232:					; First the bit locations, these use bytes 34, 35, 36, 37 and 38
  233:					;
  234:				$EJECT

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 8



 Line  I  Addr  Code            Source

  235:		N	 10	OTS		BIT	16	;34.0-ON TIME INSTRUCTION EXECUTED
  236:		N	 11	INPROG		BIT	17	;34.1-INTERRUPT IN PROCESS
  237:		N	 12	INTBIT		BIT	18	;34.2-INTERRUPT SET BIT
  238:		N	 13	ON_ERR		BIT	19	;34.3-ON ERROR EXECUTED
  239:		N	 14	OTI		BIT	20	;34.4-ON TIME INTERRUPT IN PROGRESS
  240:		N	 15	LINEB		BIT	21	;34.5-LINE CHANGE OCCURED
  241:		N	 16	INTPEN		BIT	22	;34.6-INTERRUPT PENDING BIT
  242:		N	 17	CONB		BIT	23	;34.7-CAN CONTINUE IF SET
  243:		N	 18	GTRD		BIT	24	;35.0-READ GET LOCATION
  244:		N	 19	LPB		BIT	25	;35.1-PRINT TO LINE PRINTER PORT
  245:		N	 1A	CKS_B		BIT	26	;35.2-FOR PWM INTERRUPT
  246:		N	 1B	COB		BIT	27	;35.3-CONSOLE OUT BIT
  247:								;     0 = SERIAL PORT
  248:								;     1 = LINE PRINTER
  249:		N	 1C	COUB		BIT	28	;35.4-USER CONSOLE OUT BIT
  250:								;     0 = SERIAL PORT
  251:								;     1 = USER DRIVER
  252:		N	 1D	INBIT		BIT	29	;35.5-INITIALIZATION BIT
  253:		N	 1E	CIUB		BIT	30	;35.6-USER CONSOLE IN BIT
  254:								;     0 = SERIAL PORT
  255:								;     1 = USER ROUTINE
  256:		N	 1F	SPINT		BIT	31	;35.7-SERIAL PORT INTERRUPT
  257:		N	 20	STOPBIT		BIT	32	;36.0-PROGRAM STOP ENCOUNTERED
  258:		N	 21	U_IDL		BIT	33	;36.1-USER IDLE BREAK
  259:		N	 22	INP_B		BIT	34	;36.2-SET DURING INPUT INSTRUCTION
  260:				;DCMPXZ		BIT	35	;36.3-DCMPX ZERO FLAG
  261:		N	 24	ARGF		BIT	36	;36.4-ARG STACK HAS A VALUE
  262:		N	 25	RETBIT		BIT	37	;36.5-RET FROM INTERRUPT EXECUTED
  263:		N	 26	I_T0		BIT	38	;36.6-TRAP INTERRUPT ZERO TO MON
  264:		N	 27	UPB		BIT	39	;36.7-SET WHEN @ IS VALID
  265:		N	 28	JKBIT		BIT	40	;37.0-WB TRIGGER
  266:		N	 29	ENDBIT		BIT	41	;37.1-GET END OF PROGRAM
  267:		N	 2A	UBIT		BIT	42	;37.2-FOR DIM STATEMENT
  268:		N	 2B	ISAV		BIT	43	;37.3-SAVE INTERRUPT STATUS
  269:		N	 2C	BO		BIT	44	;37.4-BUBBLE OUTPUT
  270:		N	 2D	XBIT		BIT	45	;37.5-EXTERNAL PROGRAM PRESENT
  271:		N	 2E	C_BIT		BIT	46	;37.6-SET WHEN CLOCK RUNNING
  272:		N	 2F	DIRF		BIT	47	;37.7-DIRECT INPUT MODE
  273:		N	 30	NO_C		BIT	48	;38.0-NO CONTROL C
  274:		N	 31	DRQ		BIT	49	;38.1-DMA ENABLED
  275:		N	 32	BI		BIT	50	;38.2-BUBBLE INPUT
  276:		N	 33	INTELB		BIT	51	;38.3-INTELLIGENT PROM PROGRAMMING
  277:		N	 34	C0ORX1		BIT	52	;38.4-PRINT FROM ROM OR RAM
  278:		N	 35	CNT_S		BIT	53	;38.5-CONTROL S ENCOUNTERED
  279:		N	 36	ZSURP		BIT	54	;38.6-ZERO SUPRESS
  280:		N	 37	HMODE		BIT	55	;38.7-HEX MODE PRINT
  281:		B	 97	LP		BIT	P1.7	;SOFTWARE LINE PRINTER
  282:		B	 96	DACK		BIT	P1.6	;DMA ACK
  283:		B	 95	PROMV		BIT	P1.5	;TURN ON PROM VOLTAGE
  284:		B	 94	PROMP		BIT	P1.4	;PROM PULSE
  285:		B	 93	ALED		BIT	P1.3	;ALE DISABLE
  286:		B	 92	T_BIT		BIT	P1.2	;I/O TOGGLE BIT
  287:					;
  288:				$EJECT

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 9



 Line  I  Addr  Code            Source

  289:					;
  290:					; The next location is a bit addressable byte counter
  291:					;
  292:		N      0027	BABC	EQU	39
  293:					;
  294:					; Now floating point and the other temps
  295:					;
  296:					; FP Uses to locations 03CH
  297:					;
  298:					; Now the stack designators.
  299:					;
  300:		N      003E	SPSAV	EQU	3EH
  301:		N      003F	S_LEN	EQU	3FH
  302:		N      0040	T_HH	EQU	40H
  303:		N      0041	T_LL	EQU	41H
  304:		N      0042	INTXAH	EQU	42H
  305:		N      0043	INTXAL	EQU	43H
  306:		N      0045	MT1	EQU	45H
  307:		N      0046	MT2	EQU	46H
  308:		N      0047	MILLIV	EQU	47H		;TIMER LOCATIONS
  309:		N      0048	TVH	EQU	48H
  310:		N      0049	TVL	EQU	49H
  311:		N      004A	SAVE_T	EQU	4AH
  312:		N      004B	SP_H	EQU	4BH		;SERIAL PORT TIME OUT
  313:		N      004C	SP_L	EQU	4CH
  314:		N      004D	CMNDSP	EQU	4DH		;SYSTEM STACK POINTER
  315:		N      00FF	IRAMTOP	EQU	0FFH		;TOP OF RAM
  316:		N      00FE	STACKTP	EQU	0FEH		;ARG AND CONTROL STACK TOPS
  317:					;
  318:					; The character equates
  319:					;
  320:		N      000D	CR	EQU	0DH		;CARRIAGE RETURN
  321:		N      000A	LF	EQU	0AH		;LINE FEED
  322:		N      0007	BELL	EQU	07H		;BELL CHARACTER
  323:		N      0008	BS	EQU	08H		;BACK SPACE
  324:		N      0003	CNTRLC	EQU	03H		;CONTROL C
  325:		N      0004	CNTRLD	EQU	04H		;CONTROL D
  326:		N      0000	NULL	EQU	00H		;NULL
  327:					;
  328:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 10



 Line  I  Addr  Code            Source

  329:					;
  330:					; The internal system equates
  331:					;
  332:		N      0049	LINLEN	EQU	73		;THE LENGTH OF AN INPUT LINE
  333:		N      0001	EOF	EQU	01		;END OF FILE CHARACTER
  334:		N      0001	ASTKAH	EQU	01		;ASTKA IS IN PAGE 1 OF RAM
  335:		N      0000	CSTKAH	EQU	00		;CSTKA IS IN PAGE 0 OF RAM
  336:		N      0001	FTYPE	EQU	01		;CONTROL STACK "FOR"
  337:		N      0002	GTYPE	EQU	02		;CONTROL STACK "GOSUB"
  338:		N      0003	DTYPE	EQU	03		;DO-WHILE/UNTIL TYPE
  339:		N      8000	ROMADR	EQU	8000H		;LOCATION OF ROM
  340:					;
  341:					; The floating point equates
  342:					;
  343:		N      0006	FPSIZ	EQU	6		;NO. OF BYTES IN A FLOATING NUM
  344:		N      0004	DIGIT	EQU	FPSIZ-2		;THE MANTISSA OF A FLOATING NUM
  345:		N      0009	STESIZ	EQU	FPSIZ+3		;SIZE OF SYMBOL ADJUSTED TABLE ELEMENT
  346:		N      1993	FP_BASE	EQU	1993H		;BASE OF FLOATING POINT ROUTINES
  347:		N      0200	PSTART	EQU	512		;START OF A PROGRAM IN RAM
  348:		N      0011	FSIZE	EQU	FPSIZ+FPSIZ+2+2+1
  349:					;
  350:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 11



 Line  I  Addr  Code            Source

  351:					;**************************************************************
  352:					;
  353:	  0047			USENT:	; User entry jump table
  354:					;
  355:					;**************************************************************
  356:					;
  357:	  0047	17 7C			DW	CMND1		;(00, 00H)COMMAND MODE JUMP
  358:	  0049	12 0C			DW	IFIX		;(01, 01H)CONVERT FP TO INT
  359:	  004B	0F DE			DW	PUSHAS		;(02, 02H)PUSH VALUE ONTO ARG STACK
  360:	  004D	0F D4			DW	POPAS		;(03, 03H)POP VALUE OFF ARG STACK
  361:	  004F	04 95			DW	PG1		;(04, 04H)PROGRAM A PROM
  362:	  0051	06 D0			DW	INLINE		;(05, 05H)INPUT A LINE
  363:	  0053	06 B7			DW	UPRNT		;(06, 06H)PRINT A LINR
  364:	  0055	06 9D			DW	CRLF		;(07, 07H)OUTPUT A CRLF
  365:					;
  366:					;**************************************************************
  367:					;
  368:					; This is the operation jump table for arithmetics
  369:					;
  370:					;**************************************************************
  371:					;
  372:	  0057	13 95		OPTAB:	DW	ALPAR		;(08, 08H)LEFT PAREN
  373:	  0059	13 14			DW	AEXP		;(09, 09H)EXPONENTAION
  374:	  005B	11 99			DW	AMUL		;(10, 0AH)FP MUL
  375:	  005D	17 36			DW	AADD		;(11, 0BH)FLOATING POINT ADD
  376:	  005F	13 F3			DW	ADIV		;(12, 0CH)FLOATING POINT DIVIDE
  377:	  0061	17 11			DW	ASUB		;(13, 0DH)FLOATING POINT SUBTRACTION
  378:	  0063	14 81			DW	AXRL		;(14, 0EH)XOR
  379:	  0065	14 6D			DW	AANL		;(15, 0FH)AND
  380:	  0067	14 76			DW	AORL		;(16, 10H)OR
  381:	  0069	13 8A			DW	ANEG		;(17, 11H)NEGATE
  382:	  006B	13 C4			DW	AEQ		;(18, 12H)EQUAL
  383:	  006D	13 D0			DW	AGE		;(19, 13H)GREATER THAN OR EQUAL
  384:	  006F	13 D4			DW	ALE		;(20, 14H)LESS THAN OR EQUAL
  385:	  0071	13 CA			DW	ANE		;(21, 15H)NOT EQUAL
  386:	  0073	13 BF			DW	ALT		;(22, 16H)LESS THAN
  387:	  0075	13 AE			DW	AGT		;(23, 17H)GREATER THAN
  388:					;
  389:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 12



 Line  I  Addr  Code            Source

  390:					;***************************************************************
  391:					;
  392:					; This is the jump table for unary operators
  393:					;
  394:					;***************************************************************
  395:					;
  396:	  0077	13 78			DW	AABS		;(24, 18H)ABSOLUTE VALUE
  397:	  0079	13 56			DW	AINT		;(25, 19H)INTEGER OPERATOR
  398:	  007B	13 7E			DW	ASGN		;(26, 1AH)SIGN OPERATOR
  399:	  007D	14 7F			DW	ANOT		;(27, 1BH)ONE'S COMPLEMENT
  400:	  007F	11 56			DW	ACOS		;(28, 1CH)COSINE
  401:	  0081	11 B9			DW	ATAN		;(29, 1DH)TANGENT
  402:	  0083	11 5A			DW	ASIN		;(30, 1EH)SINE
  403:	  0085	12 76			DW	ASQR		;(31, 1FH)SQUARE ROOT
  404:	  0087	13 96			DW	ACBYTE		;(32, 20H)READ CODE
  405:	  0089	13 10			DW	AETOX		;(33, 21H)E TO THE X
  406:	  008B	11 C9			DW	AATAN		;(34, 22H)ARC TANGENT
  407:	  008D	12 A9			DW	ALN		;(35, 23H)NATURAL LOG
  408:	  008F	13 9F			DW	ADBYTE		;(36, 24H)READ DATA MEMORY
  409:	  0091	13 A7			DW	AXBYTE		;(37, 25H)READ EXTERNAL MEMORY
  410:	  0093	14 68			DW	PIPI		;(38, 26H)PI
  411:	  0095	13 DA			DW	ARND		;(39, 27H)RANDOM NUMBER
  412:	  0097	14 92			DW	AGET		;(40, 28H)GET INPUT CHARACTER
  413:	  0099	17 06			DW	AFREE		;(41, 29H)COMPUTE #BYTES FREE
  414:	  009B	17 16			DW	ALEN		;(42, 2AH) COMPUTE LEN OF PORGRAM
  415:	  009D	0F DA			DW	AXTAL		;(43, 2BH) CRYSTAL
  416:	  009F	16 38			DW	PMTOP		;(44, 2CH)TOP OF MEMORY
  417:	  00A1	17 1E			DW	ATIME		;(45, 2DH) TIME
  418:	  00A3	14 A2			DW	A_IE		;(46, 2EH) IE
  419:	  00A5	14 A6			DW	A_IP		;(47, 2FH) IP
  420:	  00A7	14 AA			DW	ATIM0		;(48, 30H) TIMER 0
  421:	  00A9	14 B0			DW	ATIM1		;(49, 31H) TIMER 1
  422:	  00AB	14 B6			DW	ATIM2		;(50, 32H) TIMER 2
  423:	  00AD	14 BC			DW	AT2CON		;(51, 33H) T2CON
  424:	  00AF	14 C0			DW	ATCON		;(52, 34H) TCON
  425:	  00B1	14 C4			DW	ATMOD		;(53, 35H) ATMOD
  426:	  00B3	14 C8			DW	ARCAP2		;(54, 36H) RCAP2
  427:	  00B5	14 CE			DW	AP1		;(55, 37H) P1
  428:	  00B7	14 D2			DW	APCON		;(56, 38H) PCON
  429:	  00B9	0F 44			DW	EXPRB		;(57, 39H) EVALUATE AN EXPRESSION
  430:	  00BB	16 45			DW	AXTAL1		;(58, 3AH) CALCULATE CRYSTAL
  431:	  00BD	14 D9			DW	LINE		;(59, 3BH) EDIT A LINE
  432:	  00BF	15 A3			DW	PP		;(60, 3CH) PROCESS A LINE
  433:	  00C1	10 83			DW	UPPL-3		;(61, 3DH) UNPROCESS A LINE
  434:	  00C3	0D 66			DW	VAR		;(62, 3EH) FIND A VARIABLE
  435:	  00C5	0E CE			DW	GC		;(63, 3FH) GET A CHARACTER
  436:	  00C7	0E D6			DW	GCI		;(64, 40H) GET CHARACTER AND INCREMENT
  437:	  00C9	07 89			DW	INCHAR		;(65, 41H) INPUT A CHARACTER
  438:	  00CB	08 06			DW	CRUN		;(66, 42H) RUN A PROGRAM
  439:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 13



 Line  I  Addr  Code            Source

  440:	  00CD	01		OPBOL:	DB	1		;
  441:					;
  442:	  00CE	0F			DB	15		;LEFT PAREN
  443:	  00CF	0E			DB	14		;EXPONENTIAN **
  444:	  00D0	0A			DB	10		;MUL
  445:	  00D1	08			DB	8		;ADD
  446:	  00D2	0A			DB	10		;DIVIDE
  447:	  00D3	08			DB	8		;SUB
  448:	  00D4	03			DB	3		;XOR
  449:	  00D5	05			DB	5		;AND
  450:	  00D6	04			DB	4		;OR
  451:	  00D7	0C			DB	12		;NEGATE
  452:	  00D8	06			DB	6		;EQ
  453:	  00D9	06			DB	6		;GT
  454:	  00DA	06			DB	6		;LT
  455:	  00DB	06			DB	6		;NE
  456:	  00DC	06			DB	6		;LE
  457:	  00DD	06			DB	6		;GE
  458:					;
  459:	  00DE	0F		UOPBOL:	DB	15		;AABS
  460:	  00DF	0F			DB	15		;AAINT
  461:	  00E0	0F			DB	15		;ASGN
  462:	  00E1	0F			DB	15		;ANOT
  463:	  00E2	0F			DB	15		;ACOS
  464:	  00E3	0F			DB	15		;ATAN
  465:	  00E4	0F			DB	15		;ASIN
  466:	  00E5	0F			DB	15		;ASQR
  467:	  00E6	0F			DB	15		;ACBYTE
  468:	  00E7	0F			DB	15		;E TO THE X
  469:	  00E8	0F			DB	15		;AATAN
  470:	  00E9	0F			DB	15		;NATURAL LOG
  471:	  00EA	0F			DB	15		;DBYTE
  472:	  00EB	0F			DB	15		;XBYTE
  473:					;
  474:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 14



 Line  I  Addr  Code            Source

  475:					;***************************************************************
  476:					;
  477:					; The ASCII printed messages.
  478:					;
  479:					;***************************************************************
  480:					;
  481:	  00EC	53 54 4F 50	STP:	DB	'STOP"'
	  00F0	22
  482:					;
  483:	  00F1	54 52 59 20	IAN:	DB	'TRY AGAIN"'
	  00F5	41 47 41 49
	  00F9	4E 22
  484:					;
  485:	  00FB	52 45 41 44	RDYS:	DB	'READY"'
	  00FF	59 22
  486:					;
  487:	  0101	20 2D 20 49	INS:	DB	' - IN LINE "'
	  0105	4E 20 4C 49
	  0109	4E 45 20 22
  488:					;
  489:					;**************************************************************
  490:					;
  491:					; This is the command jump table
  492:					;
  493:					;**************************************************************
  494:					;
  495:	  010D	08 06		CMNDD:	DW	CRUN		;RUN
  496:	  010F	10 31			DW	CLIST		;LIST
  497:	  0111	0B 09			DW	CNULL		;NULL
  498:	  0113	06 54			DW	CNEW		;NEW
  499:	  0115	18 36			DW	CCONT		;CONTINUE
  500:	  0117	04 61			DW	CPROG		;PROGRAM A PROM
  501:	  0119	17 68			DW	CXFER		;TRANSFER FROM ROM TO RAM
  502:	  011B	17 74			DW	CRAM		;RAM MODE
  503:	  011D	05 36			DW	CROM		;ROM MODE
  504:	  011F	04 5A			DW	CIPROG		;INTELLIGENT PROM PROGRAMMING
  505:					;
  506:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 15



 Line  I  Addr  Code            Source

  507:					;***************************************************************
  508:					;
  509:					; This is the statement jump table.
  510:					;
  511:					;**************************************************************
  512:					;
  513:	  0121			STATD:	;
  514:	  0121	09 6F			DW	SLET		;LET		80H
  515:	  0123	06 87			DW	SCLR		;CLEAR		81H
  516:	  0125	0A 77			DW	SPUSH		;PUSH VAR	82H
  517:	  0127	0A AB			DW	SGOTO		;GO TO		83H
  518:	  0129	16 7B			DW	STONE		;TONE		84H
  519:	  012B	0C 2A			DW	SPH0		;PRINT MODE 0	85H
  520:	  012D	19 23			DW	SUI		;USER INPUT	86H
  521:	  012F	19 28			DW	SUO		;USER OUTPUT	87H
  522:	  0131	0A 7E			DW	SPOP		;POP VAR	88H
  523:	  0133	0C 2E			DW	SPRINT		;PRINT		89H
  524:	  0135	0E 64			DW	SCALL		;CALL		8AH
  525:	  0137	0D 62			DW	SDIMX		;DIMENSION	8BH
  526:	  0139	06 04			DW	STRING		;STRING ALLO	8CH
  527:	  013B	16 EE			DW	SBAUD		;SET BAUD	8DH
  528:	  013D	19 10			DW	SCLOCK		;CLOCK		8EH
  529:	  013F	0C 2C			DW	SPH1		;PRINT MODE 1   8FH
  530:					;
  531:					; No direct mode from here on
  532:					;
  533:	  0141	08 5C			DW	SSTOP		;STOP		90H
  534:	  0143	0E 57			DW	SOT		;ON TIME	91H
  535:	  0145	14 02			DW	SONEXT		;ON EXT INT	92H
  536:	  0147	0B 0F			DW	SRETI		;RET FROM INT	93H
  537:	  0149	0F 06			DW	S_DO		;DO		94H
  538:	  014B	0B CF			DW	SRESTR		;RESTOR		95H
  539:	  014D	0E FD			DW	WCR		;REM		96H
  540:	  014F	0B 60			DW	SNEXT		;NEXT		97H
  541:	  0151	13 F8			DW	SONERR		;ON ERROR	98H
  542:	  0153	0C EC			DW	S_ON		;ON		99H
  543:	  0155	0D F6			DW	SINPUT		;INPUT		9AH
  544:	  0157	0B E4			DW	SREAD		;READ		9BH
  545:	  0159	0E ED			DW	FINDCR		;DATA		9CH
  546:	  015B	0B 11			DW	SRETRN		;RETURN		9DH
  547:	  015D	0A 87			DW	SIF		;IF		9EH
  548:	  015F	0B 2E			DW	SGOSUB		;GOSUB		9FH
  549:	  0161	0A 3D			DW	SFOR		;FOR		A0H
  550:	  0163	0A FD			DW	SWHILE		;WHILE		A1H
  551:	  0165	0B 02			DW	SUNTIL		;UNTIL		A2H
  552:	  0167	17 7C			DW	CMND1		;END		A3H
  553:	  0169	18 53			DW	I_DL		;IDLE		A4H
  554:	  016B	0F E6			DW	ST_A		;STORE AT	A5H
  555:	  016D	0F EA			DW	LD_A		;LOAD AT	A6H
  556:	  016F	05 0C			DW	PGU		;PGM		A7H
  557:	  0171	07 BC			DW	RROM		;RUN A ROM	A9H
  558:					;
  559:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 16



 Line  I  Addr  Code            Source

  560:					;**************************************************************
  561:					;
  562:	  0173			TOKTAB:	; This is the basic token table
  563:					;
  564:					;**************************************************************
  565:					;
  566:					; First the tokens for statements
  567:					;
  568:	  0173	80			DB	80H		;LET TOKEN
  569:	  0174	4C 45 54		DB	'LET'
  570:					;
  571:	  0177	81			DB	81H		;CLEAR TOKEN
  572:	  0178	43 4C 45 41		DB	'CLEAR'
	  017C	52
  573:					;
  574:	  017D	82			DB	82H		;PUSH TOKEN
  575:	  017E	50 55 53 48		DB	'PUSH'
  576:					;
  577:		N      0083	T_GOTO	EQU	83H
  578:					;
  579:	  0182	83			DB	83H		;GO TO TOKEN
  580:	  0183	47 4F 54 4F		DB	'GOTO'
  581:					;
  582:	  0187	84			DB	84H		;TOGGLE TOKEN
  583:	  0188	50 57 4D		DB	'PWM'
  584:					;
  585:	  018B	85			DB	85H		;PRINT HEX MODE 0
  586:	  018C	50 48 30 2E		DB	'PH0.'
  587:					;
  588:	  0190	86			DB	86H		;USER IN TOKEN
  589:	  0191	55 49			DB	'UI'
  590:					;
  591:	  0193	87			DB	87H		;USER OUT TOKEN
  592:	  0194	55 4F			DB	'UO'
  593:					;
  594:	  0196	88			DB	88H		;POP TOKEN
  595:	  0197	50 4F 50		DB	'POP'
  596:					;
  597:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 17



 Line  I  Addr  Code            Source

  598:	  019A	89			DB	89H		;PRINT TOKEN
  599:	  019B	50 52 49 4E		DB	'PRINT'
	  019F	54
  600:	  01A0	89			DB	89H
  601:	  01A1	50 2E			DB	'P.'		;P. ALSO MEANS PRINT
  602:	  01A3	89			DB	89H		;? ALSO
  603:	  01A4	3F			DB	'?'
  604:					;
  605:	  01A5	8A			DB	8AH		;CALL TOKEN
  606:	  01A6	43 41 4C 4C		DB	'CALL'
  607:					;
  608:	  01AA	8B			DB	8BH		;DIMENSION TOKEN
  609:	  01AB	44 49 4D		DB	'DIM'
  610:					;
  611:	  01AE	8C			DB	8CH		;STRING TOKEN
  612:	  01AF	53 54 52 49		DB	'STRING'
	  01B3	4E 47
  613:					;
  614:	  01B5	8D			DB	8DH		;SET BAUD RATE
  615:	  01B6	42 41 55 44		DB	'BAUD'
  616:					;
  617:	  01BA	8E			DB	8EH		;CLOCK
  618:	  01BB	43 4C 4F 43		DB	'CLOCK'
	  01BF	4B
  619:					;
  620:	  01C0	8F			DB	8FH		;PRINT HEX MODE 1
  621:	  01C1	50 48 31 2E		DB	'PH1.'
  622:					;
  623:		N      0090	T_STOP	EQU	90H		;STOP TOKEN
  624:	  01C5	90			DB	T_STOP
  625:	  01C6	53 54 4F 50		DB	'STOP'
  626:					;
  627:		N      0090	T_DIR	EQU	T_STOP		;NO DIRECT FROM HERE ON
  628:					;
  629:	  01CA	91			DB	T_STOP+1	;ON TIMER INTERRUPT
  630:	  01CB	4F 4E 54 49		DB	'ONTIME'
	  01CF	4D 45
  631:					;
  632:	  01D1	92			DB	T_STOP+2	;ON EXTERNAL INTERRUPT
  633:	  01D2	4F 4E 45 58		DB	'ONEX1'
	  01D6	31
  634:					;
  635:	  01D7	93			DB	T_STOP+3	;RETURN FROM INTERRUPT
  636:	  01D8	52 45 54 49		DB	'RETI'
  637:					;
  638:	  01DC	94			DB	T_STOP+4	;DO TOKEN
  639:	  01DD	44 4F			DB	'DO'
  640:					;
  641:	  01DF	95			DB	T_STOP+5	;RESTORE TOKEN
  642:	  01E0	52 45 53 54		DB	'RESTORE'
	  01E4	4F 52 45
  643:					;
  644:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 18



 Line  I  Addr  Code            Source

  645:		N      0096	T_REM	EQU	T_STOP+6	;REMARK TOKEN
  646:	  01E7	96			DB	T_REM
  647:	  01E8	52 45 4D		DB	'REM'
  648:					;
  649:	  01EB	97			DB	T_REM+1		;NEXT TOKEN
  650:	  01EC	4E 45 58 54		DB	'NEXT'
  651:					;
  652:	  01F0	98			DB	T_REM+2		;ON ERROR TOKEN
  653:	  01F1	4F 4E 45 52		DB	'ONERR'
	  01F5	52
  654:					;
  655:	  01F6	99			DB	T_REM+3		;ON TOKEN
  656:	  01F7	4F 4E			DB	'ON'
  657:					;
  658:	  01F9	9A			DB	T_REM+4		;INPUT
  659:	  01FA	49 4E 50 55		DB	'INPUT'
	  01FE	54
  660:					;
  661:	  01FF	9B			DB	T_REM+5		;READ
  662:	  0200	52 45 41 44		DB	'READ'
  663:					;
  664:		N      009C	T_DATA	EQU	T_REM+6		;DATA
  665:	  0204	9C			DB	T_DATA
  666:	  0205	44 41 54 41		DB	'DATA'
  667:					;
  668:	  0209	9D			DB	T_DATA+1	;RETURN
  669:	  020A	52 45 54 55		DB	'RETURN'
	  020E	52 4E
  670:					;
  671:	  0210	9E			DB	T_DATA+2	;IF
  672:	  0211	49 46			DB	'IF'
  673:					;
  674:		N      009F	T_GOSB	EQU	T_DATA+3	;GOSUB
  675:	  0213	9F			DB	T_GOSB
  676:	  0214	47 4F 53 55		DB	'GOSUB'
	  0218	42
  677:					;
  678:	  0219	A0			DB	T_GOSB+1	;FOR
  679:	  021A	46 4F 52		DB	'FOR'
  680:					;
  681:	  021D	A1			DB	T_GOSB+2	;WHILE
  682:	  021E	57 48 49 4C		DB	'WHILE'
	  0222	45
  683:					;
  684:	  0223	A2			DB	T_GOSB+3	;UNTIL
  685:	  0224	55 4E 54 49		DB	'UNTIL'
	  0228	4C
  686:					;
  687:	  0229	A3			DB	T_GOSB+4	;END
  688:	  022A	45 4E 44		DB	'END'
  689:					;
  690:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 19



 Line  I  Addr  Code            Source

  691:		N      00A4	T_LAST	EQU	T_GOSB+5	;LAST INITIAL TOKEN
  692:					;
  693:		N      00A4	T_TAB	EQU	T_LAST		;TAB TOKEN
  694:	  022D	A4			DB	T_TAB
  695:	  022E	54 41 42		DB	'TAB'
  696:					;
  697:		N      00A5	T_THEN	EQU	T_LAST+1	;THEN TOKEN
  698:	  0231	A5			DB	T_THEN
  699:	  0232	54 48 45 4E		DB	'THEN'
  700:					;
  701:		N      00A6	T_TO	EQU	T_LAST+2	;TO TOKEN
  702:	  0236	A6			DB	T_TO
  703:	  0237	54 4F			DB	'TO'
  704:					;
  705:		N      00A7	T_STEP	EQU	T_LAST+3	;STEP TOKEN
  706:	  0239	A7			DB	T_STEP
  707:	  023A	53 54 45 50		DB	'STEP'
  708:					;
  709:		N      00A8	T_ELSE	EQU	T_LAST+4	;ELSE TOKEN
  710:	  023E	A8			DB	T_ELSE
  711:	  023F	45 4C 53 45		DB	'ELSE'
  712:					;
  713:		N      00A9	T_SPC	EQU	T_LAST+5	;SPACE TOKEN
  714:	  0243	A9			DB	T_SPC
  715:	  0244	53 50 43		DB	'SPC'
  716:					;
  717:		N      00AA	T_CR	EQU	T_LAST+6
  718:	  0247	AA			DB	T_CR
  719:	  0248	43 52			DB	'CR'
  720:					;
  721:	  024A	AB			DB	T_CR+1
  722:	  024B	49 44 4C 45		DB	'IDLE'
  723:					;
  724:	  024F	AC			DB	T_CR+2
  725:	  0250	53 54 40		DB	'ST@'
  726:					;
  727:	  0253	AD			DB	T_CR+3
  728:	  0254	4C 44 40		DB	'LD@'
  729:					;
  730:	  0257	AE			DB	T_CR+4
  731:	  0258	50 47 4D		DB	'PGM'
  732:					;
  733:	  025B	AF			DB	T_CR+5
  734:	  025C	52 52 4F 4D		DB	'RROM'
  735:					;
  736:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 20



 Line  I  Addr  Code            Source

  737:					; Operator tokens
  738:					;
  739:		N      00E0	T_LPAR	EQU	0E0H		;LEFT PAREN
  740:	  0260	E0			DB	T_LPAR
  741:	  0261	28			DB	'('
  742:					;
  743:	  0262	E1			DB	T_LPAR+1	;EXPONENTIAN
  744:	  0263	2A 2A			DB	'**'
  745:					;
  746:	  0265	E2			DB	T_LPAR+2	;FP MULTIPLY
  747:	  0266	2A			DB	'*'
  748:					;
  749:		N      00E3	T_ADD	EQU	T_LPAR+3
  750:	  0267	E3			DB	T_LPAR+3	;ADD TOKEN
  751:	  0268	2B			DB	'+'
  752:					;
  753:	  0269	E4			DB	T_LPAR+4	;DIVIDE TOKEN
  754:	  026A	2F			DB	'/'
  755:					;
  756:		N      00E5	T_SUB	EQU	T_LPAR+5	;SUBTRACT TOKEN
  757:	  026B	E5			DB	T_SUB
  758:	  026C	2D			DB	'-'
  759:					;
  760:	  026D	E6			DB	T_LPAR+6	;LOGICAL EXCLUSIVE OR
  761:	  026E	2E 58 4F 52		DB	'.XOR.'
	  0272	2E
  762:					;
  763:	  0273	E7			DB	T_LPAR+7	;LOGICAL AND
  764:	  0274	2E 41 4E 44		DB	'.AND.'
	  0278	2E
  765:					;
  766:	  0279	E8			DB	T_LPAR+8	;LOGICAL OR
  767:	  027A	2E 4F 52 2E		DB	'.OR.'
  768:					;
  769:		N      00E9	T_NEG	EQU	T_LPAR+9
  770:					;
  771:		N      00EA	T_EQU	EQU	T_LPAR+10	;EQUAL
  772:	  027E	EA			DB	T_EQU
  773:	  027F	3D			DB	'='
  774:					;
  775:	  0280	EB			DB	T_LPAR+11	;GREATER THAN OR EQUAL
  776:	  0281	3E 3D			DB	'>='
  777:					;
  778:	  0283	EC			DB	T_LPAR+12	;LESS THAN OR EQUAL
  779:	  0284	3C 3D			DB	'<='
  780:					;
  781:	  0286	ED			DB	T_LPAR+13	;NOT EQUAL
  782:	  0287	3C 3E			DB	'<>'
  783:					;
  784:	  0289	EE			DB	T_LPAR+14	;LESS THAN
  785:	  028A	3C			DB	'<'
  786:					;
  787:	  028B	EF			DB	T_LPAR+15	;GREATER THAN
  788:	  028C	3E			DB	'>'
  789:					;
  790:					;

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 21



 Line  I  Addr  Code            Source

  791:		N      00B0	T_UOP	EQU	0B0H		;UNARY OP BASE TOKEN
  792:					;
  793:	  028D	B0			DB	T_UOP		;ABS TOKEN
  794:	  028E	41 42 53		DB	'ABS'
  795:					;
  796:	  0291	B1			DB	T_UOP+1		;INTEGER TOKEN
  797:	  0292	49 4E 54		DB	'INT'
  798:					;
  799:	  0295	B2			DB	T_UOP+2		;SIGN TOKEN
  800:	  0296	53 47 4E		DB	'SGN'
  801:					;
  802:	  0299	B3			DB	T_UOP+3		;GET TOKEN
  803:	  029A	4E 4F 54		DB	'NOT'
  804:					;
  805:	  029D	B4			DB	T_UOP+4		;COSINE TOKEN
  806:	  029E	43 4F 53		DB	'COS'
  807:					;
  808:	  02A1	B5			DB	T_UOP+5		;TANGENT TOKEN
  809:	  02A2	54 41 4E		DB	'TAN'
  810:					;
  811:	  02A5	B6			DB	T_UOP+6		;SINE TOKEN
  812:	  02A6	53 49 4E		DB	'SIN'
  813:					;
  814:	  02A9	B7			DB	T_UOP+7		;SQUARE ROOT TOKEN
  815:	  02AA	53 51 52		DB	'SQR'
  816:					;
  817:	  02AD	B8			DB	T_UOP+8		;CBYTE TOKEN
  818:	  02AE	43 42 59		DB	'CBY'
  819:					;
  820:	  02B1	B9			DB	T_UOP+9		;EXP (E TO THE X) TOKEN
  821:	  02B2	45 58 50		DB	'EXP'
  822:					;
  823:	  02B5	BA			DB	T_UOP+10
  824:	  02B6	41 54 4E		DB	'ATN'
  825:					;
  826:	  02B9	BB			DB	T_UOP+11
  827:	  02BA	4C 4F 47		DB	'LOG'
  828:					;
  829:	  02BD	BC			DB	T_UOP+12	;DBYTE TOKEN
  830:	  02BE	44 42 59		DB	'DBY'
  831:					;
  832:	  02C1	BD			DB	T_UOP+13	;XBYTE TOKEN
  833:	  02C2	58 42 59		DB	'XBY'
  834:					;
  835:		N      00BE	T_ULAST	EQU	T_UOP+14	;LAST OPERATOR NEEDING PARENS
  836:					;
  837:	  02C5	BE			DB	T_ULAST
  838:	  02C6	50 49			DB	'PI'
  839:					;
  840:	  02C8	BF			DB	T_ULAST+1	;RND TOKEN
  841:	  02C9	52 4E 44		DB	'RND'
  842:					;
  843:	  02CC	C0			DB	T_ULAST+2	;GET TOKEN
  844:	  02CD	47 45 54		DB	'GET'
  845:					;
  846:	  02D0	C1			DB	T_ULAST+3	;FREE TOKEN

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 22



 Line  I  Addr  Code            Source

  847:	  02D1	46 52 45 45		DB	'FREE'
  848:					;
  849:	  02D5	C2			DB	T_ULAST+4	;LEN TOKEN
  850:	  02D6	4C 45 4E		DB	'LEN'
  851:					;
  852:		N      00C3	T_XTAL	EQU	T_ULAST+5	;CRYSTAL TOKEN
  853:	  02D9	C3			DB	T_XTAL
  854:	  02DA	58 54 41 4C		DB	'XTAL'
  855:					;
  856:		N      00C4	T_MTOP	EQU	T_ULAST+6	;MTOP
  857:	  02DE	C4			DB	T_MTOP
  858:	  02DF	4D 54 4F 50		DB	'MTOP'
  859:					;
  860:		N      00C6	T_IE	EQU	T_ULAST+8	;IE REGISTER
  861:	  02E3	C6			DB	T_IE
  862:	  02E4	49 45			DB	'IE'
  863:					;
  864:		N      00C7	T_IP	EQU	T_ULAST+9	;IP REGISTER
  865:	  02E6	C7			DB	T_IP
  866:	  02E7	49 50			DB	'IP'
  867:					;
  868:		N      00C8	TMR0	EQU	T_ULAST+10	;TIMER 0
  869:	  02E9	C8			DB	TMR0
  870:	  02EA	54 49 4D 45		DB	'TIMER0'
	  02EE	52 30
  871:					;
  872:		N      00C9	TMR1	EQU	T_ULAST+11	;TIMER 1
  873:	  02F0	C9			DB	TMR1
  874:	  02F1	54 49 4D 45		DB	'TIMER1'
	  02F5	52 31
  875:					;
  876:		N      00CA	TMR2	EQU	T_ULAST+12	;TIMER 2
  877:	  02F7	CA			DB	TMR2
  878:	  02F8	54 49 4D 45		DB	'TIMER2'
	  02FC	52 32
  879:					;
  880:		N      00C5	T_TIME	EQU	T_ULAST+7	;TIME
  881:	  02FE	C5			DB	T_TIME
  882:	  02FF	54 49 4D 45		DB	'TIME'
  883:					;
  884:		N      00CB	TT2C	EQU	T_ULAST+13	;T2CON
  885:	  0303	CB			DB	TT2C
  886:	  0304	54 32 43 4F		DB	'T2CON'
	  0308	4E
  887:					;
  888:		N      00CC	TTC	EQU	T_ULAST+14	;TCON
  889:	  0309	CC			DB	TTC
  890:	  030A	54 43 4F 4E		DB	'TCON'
  891:					;
  892:		N      00CD	TTM	EQU	T_ULAST+15	;TMOD
  893:	  030E	CD			DB	TTM
  894:	  030F	54 4D 4F 44		DB	'TMOD'
  895:					;
  896:		N      00CE	TRC2	EQU	T_ULAST+16	;RCAP2
  897:	  0313	CE			DB	TRC2
  898:	  0314	52 43 41 50		DB	'RCAP2'

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 23



 Line  I  Addr  Code            Source

	  0318	32
  899:					;
  900:		N      00CF	T_P1	EQU	T_ULAST+17	;P1
  901:	  0319	CF			DB	T_P1
  902:	  031A	50 4F 52 54		DB	'PORT1'
	  031E	31
  903:					;
  904:		N      00D0	T_PC	EQU	T_ULAST+18	;PCON
  905:	  031F	D0			DB	T_PC
  906:	  0320	50 43 4F 4E		DB	'PCON'
  907:					;
  908:		N      00D1	T_ASC	EQU	T_ULAST+19	;ASC TOKEN
  909:	  0324	D1			DB	T_ASC
  910:	  0325	41 53 43 28		DB	'ASC('
  911:					;
  912:		N      00D2	T_USE	EQU	T_ULAST+20	;USING TOKEN
  913:	  0329	D2			DB	T_USE
  914:	  032A	55 53 49 4E		DB	'USING('
	  032E	47 28
  915:	  0330	D2			DB	T_USE
  916:	  0331	55 2E 28		DB	'U.('
  917:					;
  918:		N      00D3	T_CHR	EQU	T_ULAST+21	;CHR TOKEN
  919:	  0334	D3			DB	T_CHR
  920:	  0335	43 48 52 28		DB	'CHR('
  921:					;
  922:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 24



 Line  I  Addr  Code            Source

  923:		N      00F0	T_CMND	EQU	0F0H		;COMMAND BASE
  924:					;
  925:	  0339	F0			DB	0F0H		;RUN TOKEN
  926:	  033A	52 55 4E		DB	'RUN'
  927:					;
  928:	  033D	F1			DB	0F1H		;LIST TOKEN
  929:	  033E	4C 49 53 54		DB	'LIST'
  930:					;
  931:	  0342	F2			DB	0F2H		;NULL TOKEN
  932:	  0343	4E 55 4C 4C		DB	'NULL'
  933:					;
  934:	  0347	F3			DB	0F3H		;NEW TOKEN
  935:	  0348	4E 45 57		DB	'NEW'
  936:					;
  937:	  034B	F4			DB	0F4H		;CONTINUE TOKEN
  938:	  034C	43 4F 4E 54		DB	'CONT'
  939:					;
  940:	  0350	F5			DB	0F5H		;PROGRAM TOKEN
  941:	  0351	50 52 4F 47		DB	'PROG'
  942:					;
  943:	  0355	F6			DB	0F6H		;TRANSFER TOKEN
  944:	  0356	58 46 45 52		DB	'XFER'
  945:					;
  946:	  035A	F7			DB	0F7H		;RAM MODE
  947:	  035B	52 41 4D		DB	'RAM'
  948:					;
  949:	  035E	F8			DB	0F8H		;ROM MODE
  950:	  035F	52 4F 4D		DB	'ROM'
  951:					;
  952:	  0362	F9			DB	0F9H		;INTELLIGENT PROM PROGRAMMING
  953:	  0363	46 50 52 4F		DB	'FPROG'
	  0367	47
  954:					;
  955:	  0368	FF			DB	0FFH		;END OF TABLE
  956:					;
  957:
  958:				; END OF INCLUDE LOOK52
  959:				;$INCLUDE(:F2:LOOK52.SRC)
  960:					;
  961:	  0369	45 58 54 52	EIG:	DB	'EXTRA IGNORED"'
	  036D	41 20 49 47
	  0371	4E 4F 52 45
	  0375	44 22
  962:					;
  963:	  0377	41 2D 53 54	EXA:	DB	'A-STACK"'
	  037B	41 43 4B 22
  964:					;
  965:	  037F	43 2D 53 54	EXC:	DB	'C-STACK"'
	  0383	41 43 4B 22
  966:					;
  967:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 25



 Line  I  Addr  Code            Source

  968:				;$INCLUDE(:F2:BAS52.RST)
  969:				; BEGINNING
  970:
  971:					;**************************************************************
  972:					;
  973:	  0387			CRST:	; This performs system initialzation, it was moved here so the
  974:					; new power on reset functions could be tested in an 8751.
  975:					;
  976:					;**************************************************************
  977:					;
  978:					; First, initialize SFR's
  979:					;
  980:	  0387	75 98 5A		MOV	SCON,#5AH	;INITIALIZE SFR'S
  981:	  038A	75 89 10		MOV	TMOD,#10H
  982:	  038D	75 88 54		MOV	TCON,#54H
  983:	  0390	75			DB	75H		;MOV DIRECT, # OP CODE
  984:	  0391	C8			DB	0C8H		;T2CON LOCATION
  985:	  0392	34			DB	34H		;CONFIGURATION BYTE
  986:					;
  987:	  0393	90 20 01		MOV	DPTR,#2001H	;READ CODE AT 2001H
  988:	  0396	E4			CLR	A
  989:	  0397	93			MOVC	A,@A+DPTR
  990:	  0398	B4 AA 03		CJNE	A,#0AAH,$+6	;IF IT IS AN AAH, DO USER RESET
  991:	  039B	12 20 90		LCALL	2090H
  992:					;
  993:	  039E	78 FF			MOV	R0,#IRAMTOP	;PUT THE TOP OF RAM IN R0
  994:	  03A0	E4			CLR	A		;ZERO THE ACC
  995:					;
  996:	  03A1	F6			MOV	@R0,A		;CLEAR INTERNAL MEMORY
  997:	  03A2	D8 FD			DJNZ	R0,$-1		;LOOP TIL DONE
  998:					;
  999:					; Now, test the external memory
 1000:					;
 1001:	  03A4	75 3E 4D		MOV	SPSAV,#CMNDSP	;SET UP THE STACK
 1002:	  03A7	85 3E 81		MOV	SP,SPSAV
 1003:					;
 1004:	  03AA	75 13 80		MOV	BOFAH,#HIGH ROMADR
 1005:	  03AD	75 14 11		MOV	BOFAL,#LOW ROMADR+17
 1006:	  03B0	90 80 00		MOV	DPTR,#ROMADR	;GET THE BYTE AT 8000H
 1007:	  03B3	E0			MOVX	A,@DPTR
 1008:	  03B4	C3			CLR	C
 1009:	  03B5	94 31			SUBB	A,#31H		;FOR BIAS
 1010:	  03B7	F5 45			MOV	MT1,A		;SAVE IN DIRECT MATH LOC
 1011:	  03B9	C2 E2			CLR	ACC.2		;SAVE FOR RESET
 1012:	  03BB	FF			MOV	R7,A		;SAVE IT IN R7
 1013:	  03BC	A3			INC	DPTR
 1014:	  03BD	B1 B2			ACALL	L31DPI		;SAVE BAUD RATE
 1015:	  03BF	12 08 89		LCALL	RCL
 1016:	  03C2	A3			INC	DPTR		;GET MEMTOP
 1017:	  03C3	B1 B2			ACALL	L31DPI
 1018:	  03C5	90 00 5F		MOV	DPTR,#5FH	;READ THE EXTERNAL BYTE
 1019:	  03C8	E0			MOVX	A,@DPTR
 1020:	  03C9	90 00 00		MOV	DPTR,#0		;ESTABLISH BASE FOR CLEAR
 1021:	  03CC	B4 A5 08		CJNE	A,#0A5H,CRS
 1022:	  03CF	E5 45			MOV	A,MT1
 1023:	  03D1	C2 E0			CLR	ACC.0		;CLEAR BIT ONE

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 26



 Line  I  Addr  Code            Source

 1024:	  03D3	64 04			XRL	A,#4H
 1025:	  03D5	60 29			JZ	CR2
 1026:					;
 1027:	  03D7	BF 02 02	CRS:	CJNE	R7,#2,$+5
 1028:	  03DA	80 03			SJMP	$+5
 1029:	  03DC	BF 03 04		CJNE	R7,#3,$+7
 1030:	  03DF	D1 75			ACALL	CL_1
 1031:	  03E1	80 11			SJMP	CR1
 1032:					;
 1033:	  03E3	AB 83		CR0:	MOV	R3,DPH		;SAVE THE DPTR
 1034:	  03E5	A9 82			MOV	R1,DPL
 1035:	  03E7	A3			INC	DPTR
 1036:	  03E8	74 5A			MOV	A,#5AH
 1037:	  03EA	F0			MOVX	@DPTR,A
 1038:	  03EB	E0			MOVX	A,@DPTR
 1039:	  03EC	B4 5A 05		CJNE	A,#5AH,CR1
 1040:	  03EF	E4			CLR	A
 1041:	  03F0	F0			MOVX	@DPTR,A
 1042:	  03F1	BB E0 EF		CJNE	R3,#0E0H,CR0
 1043:					;
 1044:	  03F4	BB 03 00	CR1:	CJNE	R3,#03H,$+3	;NEED THIS MUCH RAM
 1045:	  03F7	40 8E			JC	CRST
 1046:	  03F9	90 01 0A		MOV	DPTR,#MEMTOP	;SAVE MEMTOP
 1047:	  03FC	B1 FB			ACALL	S31DP2		;SAVE MEMTOP AND SEED RCELL
 1048:	  03FE	D1 54			ACALL	CNEW		;CLEAR THE MEMORY AND SET UP POINTERS
 1049:					;
 1050:	  0400	D1 67		CR2:	ACALL	RC1		;SET UP STACKS IF NOT DONE
 1051:					;
 1052:	  0402	12 16 40		LCALL	AXTAL0		;DO THE CRYSTAL
 1053:	  0405	E5 45			MOV	A,MT1		;GET THE RESET BYTE
 1054:	  0407	B4 05 03		CJNE	A,#5,$+6
 1055:	  040A	12 40 39		LCALL	4039H
 1056:	  040D	50 0D			JNC	BG1		;CHECK FOR 0,1,2,3, OR 4
 1057:	  040F	30 E0 25		JNB	ACC.0,BG3	;NO RUN IF WRONG TYPE
 1058:	  0412	90 80 10		MOV	DPTR,#ROMADR+16
 1059:	  0415	E0			MOVX	A,@DPTR		;READ THE BYTE
 1060:	  0416	B4 55 1E		CJNE	A,#55H,BG3
 1061:	  0419	02 08 06		LJMP	CRUN
 1062:					;
 1063:	  041C	E4		BG1:	CLR	A		;DO BAUD RATE
 1064:	  041D	FB			MOV	R3,A
 1065:	  041E	F9			MOV	R1,A
 1066:	  041F	78 04			MOV	R0,#4
 1067:	  0421	20 B0 FD		JB	RXD,$		;LOOP UNTIL A CHARACTER IS RECEIVED
 1068:					;
 1069:	  0424	D8 FE		BG2:	DJNZ	R0,$		;FOUR CLOCKS, IN LOOP
 1070:	  0426	12 15 78		CALL	DEC3210+4	;NINE CLOCKS
 1071:	  0429	78 02			MOV	R0,#2		;ONE CLOCK
 1072:	  042B	30 B0 F6		JNB	RXD,BG2		;TWO CLOCKS, LOOP UNTIL DONE
 1073:	  042E	20 B0 FD		JB	RXD,$		;WAIT FOR STOP CHARACTER TO END
 1074:	  0431	30 B0 FD		JNB	RXD,$
 1075:	  0434	12 08 89		CALL	RCL		;LOAD THE TIMER
 1076:					;
 1077:	  0437	90 1F D3	BG3:	MOV	DPTR,#S_N	;GET THE MESSAGE
 1078:	  043A	D1 A5			ACALL	CRP		;PRINT IT
 1079:	  043C	02 17 74		LJMP	CRAM

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 27



 Line  I  Addr  Code            Source

 1080:
 1081:				; END
 1082:				;$INCLUDE(:F2:BAS52.RST)
 1083:					;
 1084:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 28



 Line  I  Addr  Code            Source

 1085:					;***************************************************************
 1086:					;
 1087:					; CIPROG AND CPROG - Program a prom
 1088:					;
 1089:					;***************************************************************
 1090:					;
 1091:				;$INCLUDE(:F2:BAS52.PGM)
 1092:				;BEGINNING
 1093:
 1094:	  043F	7F 00		PG8:	MOV	R7,#00H		;PROGRAM ONE BYTE AT A TIME
 1095:	  0441	7E 01			MOV	R6,#01H
 1096:	  0443	7A 7F			MOV	R2,#HIGH ROMADR-1
 1097:	  0445	78 FF			MOV	R0,#LOW ROMADR-1;LOAD PROM ADDRESS
 1098:	  0447	91 98			ACALL	PG1+3
 1099:	  0449	0E			INC	R6
 1100:	  044A	E5			DB	0E5H		;MOV A DIRECT OP CODE
 1101:	  044B	CB			DB	0CBH		;ADDRESS OF R2CAP HIGH
 1102:	  044C	91 98			ACALL	PG1+3
 1103:	  044E	E5			DB	0E5H		;MOV A, DIRECT OP CODE
 1104:	  044F	CA			DB	0CAH		;R2CAP LOW
 1105:	  0450	7E 03			MOV	R6,#3
 1106:	  0452	79 09			MOV	R1,#LOW MEMTOP-1
 1107:	  0454	7B 01			MOV	R3,#HIGH MEMTOP
 1108:	  0456	91 98			ACALL	PG1+3		;SAVE MEMTOP
 1109:	  0458	80 37			SJMP	PGR
 1110:					;
 1111:	  045A	90 01 2A	CIPROG:	MOV	DPTR,#IPROGS	;LOAD IPROG LOCATION
 1112:	  045D	D2 33			SETB	INTELB
 1113:	  045F	80 05			SJMP	$+7		;GO DO PROG
 1114:					;
 1115:	  0461	90 01 28	CPROG:	MOV	DPTR,#PROGS	;LOAD PROG LOCATION
 1116:	  0464	C2 33			CLR	INTELB
 1117:					;
 1118:	  0466	B1 7A			ACALL	LD_T		;LOAD THE TIMER
 1119:	  0468	C2 95			CLR	PROMV		;TURN ON THE PROM VOLTAGE
 1120:	  046A	12 0E E2		CALL	DELTST		;SEE IF A CR
 1121:	  046D	70 D0			JNZ	PG8		;SAVE TIMER IF SO
 1122:	  046F	7C FE			MOV	R4,#0FEH
 1123:	  0471	D2 1D			SETB	INBIT
 1124:	  0473	B1 53			ACALL	ROMFD		;GET THE ROM ADDRESS OF THE LAST LOCATION
 1125:	  0475	12 18 4C		CALL	TEMPD		;SAVE THE ADDRESS
 1126:	  0478	EC			MOV	A,R4		;GET COUNT
 1127:	  0479	F4			CPL	A
 1128:	  047A	12 14 9A		CALL	TWO_R2		;PUT IT ON THE STACK
 1129:	  047D	12 19 A1		CALL	FP_BASE+14	;OUTPUT IT
 1130:	  0480	B1 16			ACALL	CCAL		;GET THE PROGRAM
 1131:	  0482	D1 9D			ACALL	CRLF		;DO CRLF
 1132:	  0484	A8 0E			MOV	R0,TEMP4	;GET ADDRESS
 1133:	  0486	AA 0F			MOV	R2,TEMP5
 1134:	  0488	74 55			MOV	A,#55H		;LOAD SIGNIFIER
 1135:	  048A	0E			INC	R6		;LOAD LEN + 1
 1136:	  048B	BE 00 01		CJNE	R6,#00,$+4
 1137:	  048E	0F			INC	R7
 1138:	  048F	91 9B			ACALL	PG2-2
 1139:					;
 1140:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 29



 Line  I  Addr  Code            Source

 1141:	  0491	D2 95		PGR:	SETB	PROMV
 1142:	  0493	A1 3A			AJMP	C_K
 1143:					;
 1144:	  0495	8B A0		PG1:	MOV	P2,R3		;GET THE BYTE TO PROGRAM
 1145:	  0497	E3			MOVX	A,@R1
 1146:	  0498	12 15 5F		LCALL	INC3210		;BUMP POINTERS
 1147:	  049B	7D 01			MOV	R5,#1		;SET UP INTELLIGENT COUMTER
 1148:					;
 1149:	  049D	FC		PG2:	MOV	R4,A		;SAVE THE BYTE IN R4
 1150:	  049E	91 D6			ACALL	PG7		;PROGRAM THE BYTE
 1151:	  04A0	91 F0			ACALL	PG9
 1152:	  04A2	20 33 0C		JB	INTELB,PG4	;SEE IF INTELLIGENT PROGRAMMING
 1153:					;
 1154:	  04A5	6C		PG3:	XRL	A,R4
 1155:	  04A6	70 20			JNZ	PG6		;ERROR IF NOT THE SAME
 1156:	  04A8	12 16 30		CALL	DEC76		;BUMP THE COUNTERS
 1157:	  04AB	70 E8			JNZ	PG1		;LOOP IF NOT DONE
 1158:	  04AD	53 D0 E7		ANL	PSW,#11100111B	;INSURE RB0
 1159:	  04B0	22			RET
 1160:					;
 1161:	  04B1	6C		PG4:	XRL	A,R4		;SEE IF PROGRAMMED
 1162:	  04B2	70 0F			JNZ	PG5		;JUMP IF NOT
 1163:	  04B4	EC			MOV	A,R4		;GET THE DATA BACK
 1164:	  04B5	91 D6			ACALL	PG7		;PROGRAM THE LOCATION
 1165:	  04B7	91 E0			ACALL	ZRO		;AGAIN
 1166:	  04B9	91 E0			ACALL	ZRO		;AND AGAIN
 1167:	  04BB	91 E0			ACALL	ZRO		;AND AGAIN
 1168:	  04BD	DD F8			DJNZ	R5,$-6		;KEEP DOING IT
 1169:	  04BF	91 F0			ACALL	PG9		;RESET PROG
 1170:	  04C1	80 E2			SJMP	PG3		;FINISH THE LOOP
 1171:					;
 1172:	  04C3	0D		PG5:	INC	R5		;BUMP THE COUNTER
 1173:	  04C4	EC			MOV	A,R4		;GET THE BYTE
 1174:	  04C5	BD 19 D5		CJNE	R5,#25,PG2	;SEE IF TRIED 25 TIMES
 1175:					;
 1176:	  04C8	D2 95		PG6:	SETB	PROMV		;TURN OFF PROM VOLTAGE
 1177:	  04CA	75 D0 00		MOV	PSW,#0		;INSURE RB0
 1178:	  04CD	30 2F E0		JNB	DIRF,PG4-1	;EXIT IF IN RUN MODE
 1179:	  04D0	90 1F 9A		MOV	DPTR,#E16X	;PROGRAMMING ERROR
 1180:					;
 1181:	  04D3	02 18 87	ERRLK:	LJMP	ERROR		;PROCESS THE ERROR
 1182:					;
 1183:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 30



 Line  I  Addr  Code            Source

 1184:	  04D6	88 80		PG7:	MOV	P0,R0		;SET UP THE PORTS
 1185:	  04D8	8A A0			MOV	P2,R2		;LATCH LOW ORDER ADDRESS
 1186:	  04DA	B1 05			ACALL	PG11		;DELAY FOR 8748/9
 1187:	  04DC	C2 93			CLR	ALED
 1188:	  04DE	F5 80			MOV	P0,A		;PUT DATA ON THE PORT
 1189:					;
 1190:	  04E0	00		ZRO:	NOP			;SETTLEING TIME + FP ZERO
 1191:	  04E1	00			NOP
 1192:	  04E2	00			NOP
 1193:	  04E3	00			NOP
 1194:	  04E4	00			NOP
 1195:	  04E5	00			NOP
 1196:	  04E6	B1 05			ACALL	PG11		;DELAY A WHILE
 1197:	  04E8	C2 94			CLR	PROMP		;START PROGRAMMING
 1198:	  04EA	B1 27			ACALL	TIMER_LOAD	;START THE TIMER
 1199:	  04EC	30 8F FD		JNB	TF1,$		;WAIT FOR PART TO PROGRAM
 1200:	  04EF	22			RET			;EXIT
 1201:					;
 1202:	  04F0	D2 94		PG9:	SETB	PROMP
 1203:	  04F2	B1 05			ACALL	PG11		;DELAY FOR A WHILE
 1204:	  04F4	30 B2 FD		JNB	P3.2,$		;LOOP FOR EEPROMS
 1205:	  04F7	75 80 FF		MOV	P0,#0FFH
 1206:	  04FA	C2 B7			CLR	P3.7		;LOWER READ
 1207:	  04FC	B1 05			ACALL	PG11
 1208:	  04FE	E5 80			MOV	A,P0		;READ THE PORT
 1209:	  0500	D2 B7			SETB	P3.7
 1210:	  0502	D2 93			SETB	ALED
 1211:	  0504	22			RET
 1212:					;
 1213:	  0505	75 0F 0C	PG11:	MOV	TEMP5,#12	;DELAY 30uS AT 12 MHZ
 1214:	  0508	D5 0F FD		DJNZ	TEMP5,$
 1215:	  050B	22			RET
 1216:					;
 1217:
 1218:				;END
 1219:				;$INCLUDE(:F2:BAS52.PGM)
 1220:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 31



 Line  I  Addr  Code            Source

 1221:					;**************************************************************
 1222:					;
 1223:	  050C			PGU:	;PROGRAM A PROM FOR THE USER
 1224:					;
 1225:					;**************************************************************
 1226:					;
 1227:	  050C	C2 95			CLR	PROMV		;TURN ON THE VOLTAGE
 1228:	  050E	75 D0 18		MOV	PSW,#00011000B	;SELECT RB3
 1229:	  0511	91 95			ACALL	PG1		;DO IT
 1230:	  0513	D2 95			SETB	PROMV		;TURN IT OFF
 1231:	  0515	22			RET
 1232:					;
 1233:					;
 1234:					;*************************************************************
 1235:					;
 1236:	  0516			CCAL:	; Set up for prom moves
 1237:					; R3:R1 gets source
 1238:					; R7:R6 gets # of bytes
 1239:					;
 1240:					;*************************************************************
 1241:					;
 1242:	  0516	B1 82			ACALL	GETEND		;GET THE LAST LOCATION
 1243:	  0518	A3			INC	DPTR		;BUMP TO LOAD EOF
 1244:	  0519	AB 13			MOV	R3,BOFAH
 1245:	  051B	A9 14			MOV	R1,BOFAL	;RESTORE START
 1246:	  051D	C3			CLR	C		;PREPARE FOR SUBB
 1247:	  051E	E5 82			MOV	A,DPL		;SUB DPTR - BOFA > R7:R6
 1248:	  0520	99			SUBB	A,R1
 1249:	  0521	FE			MOV	R6,A
 1250:	  0522	E5 83			MOV	A,DPH
 1251:	  0524	9B			SUBB	A,R3
 1252:	  0525	FF			MOV	R7,A
 1253:	  0526	22			RET
 1254:					;
 1255:					;
 1256:				;$INCLUDE(:F2:BAS52.TL)
 1257:				;BEGINNING
 1258:
 1259:					;**************************************************************
 1260:					;
 1261:	  0527			TIMER_LOAD:; Load the timer
 1262:					;
 1263:					;*************************************************************
 1264:					;
 1265:	  0527	B1 26			ACALL	$-1		;DELAY FOUR CLOCKS
 1266:	  0529	C2 8E			CLR	TR1		;STOP IT WHILE IT'S LOADED
 1267:	  052B	85 40 8D		MOV	TH1,T_HH
 1268:	  052E	85 41 8B		MOV	TL1,T_LL
 1269:	  0531	C2 8F			CLR	TF1		;CLEAR THE OVERFLOW FLAG
 1270:	  0533	D2 8E			SETB	TR1		;START IT NOW
 1271:	  0535	22			RET
 1272:					;
 1273:
 1274:				;END
 1275:				;$INCLUDE(:F2:BAS52.TL)
 1276:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 32



 Line  I  Addr  Code            Source

 1277:					;***************************************************************
 1278:					;
 1279:	  0536			CROM:	; The command action routine - ROM - Run out of rom
 1280:					;
 1281:					;***************************************************************
 1282:					;
 1283:	  0536	C2 17			CLR	CONB		;CAN'T CONTINUE IF MODE CHANGE
 1284:	  0538	B1 3D			ACALL	RO1		;DO IT
 1285:					;
 1286:	  053A	02 10 75	C_K:	LJMP	CL3		;EXIT
 1287:					;
 1288:	  053D	12 0F 36	RO1:	CALL	INTGER		;SEE IF INTGER PRESENT
 1289:	  0540	AC 00			MOV	R4,R0B0		;SAVE THE NUMBER
 1290:	  0542	50 02			JNC	$+4
 1291:	  0544	7C 01			MOV	R4,#01H		;ONE IF NO INTEGER PRESENT
 1292:	  0546	B1 53			ACALL	ROMFD		;FIND THE PROGRAM
 1293:	  0548	BC 00 11		CJNE	R4,#0,RFX	;EXIT IF R4 <> 0
 1294:	  054B	A3			INC	DPTR		;BUMP PAST TAG
 1295:	  054C	85 83 13		MOV	BOFAH,DPH	;SAVE THE ADDRESS
 1296:	  054F	85 82 14		MOV	BOFAL,DPL
 1297:	  0552	22			RET
 1298:					;
 1299:	  0553	90 80 10	ROMFD:	MOV	DPTR,#ROMADR+16	;START OF USER PROGRAM
 1300:					;
 1301:	  0556	E0		RF1:	MOVX	A,@DPTR		;GET THE BYTE
 1302:	  0557	B4 55 09		CJNE	A,#55H,RF3	;SEE IF PROPER TAG
 1303:	  055A	DC 01			DJNZ	R4,RF2		;BUMP COUNTER
 1304:					;
 1305:	  055C	22		RFX:	RET			;DPTR HAS THE START ADDRESS
 1306:					;
 1307:	  055D	A3		RF2:	INC	DPTR		;BUMP PAST TAG
 1308:	  055E	B1 A4			ACALL	G5
 1309:	  0560	A3			INC	DPTR		;BUMP TO NEXT PROGRAM
 1310:	  0561	80 F3			SJMP	RF1		;DO IT AGAIN
 1311:					;
 1312:	  0563	10 1D F6	RF3:	JBC	INBIT,RFX	;EXIT IF SET
 1313:					;
 1314:	  0566	90 1F C9	NOGO:	MOV	DPTR,#NOROM
 1315:	  0569	81 D3			AJMP	ERRLK
 1316:					;
 1317:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 33



 Line  I  Addr  Code            Source

 1318:					;***************************************************************
 1319:					;
 1320:	  056B			L20DPI:	; load R2:R0 with the location the DPTR is pointing to
 1321:					;
 1322:					;***************************************************************
 1323:					;
 1324:	  056B	E0			MOVX	A,@DPTR
 1325:	  056C	FA			MOV	R2,A
 1326:	  056D	A3			INC	DPTR
 1327:	  056E	E0			MOVX	A,@DPTR
 1328:	  056F	F8			MOV	R0,A
 1329:	  0570	22			RET			;DON'T BUMP DPTR
 1330:					;
 1331:					;***************************************************************
 1332:					;
 1333:	  0571			X31DP:	; swap R3:R1 with DPTR
 1334:					;
 1335:					;***************************************************************
 1336:					;
 1337:	  0571	CB			XCH	A,R3
 1338:	  0572	C5 83			XCH	A,DPH
 1339:	  0574	CB			XCH	A,R3
 1340:	  0575	C9			XCH	A,R1
 1341:	  0576	C5 82			XCH	A,DPL
 1342:	  0578	C9			XCH	A,R1
 1343:	  0579	22			RET
 1344:					;
 1345:					;***************************************************************
 1346:					;
 1347:	  057A			LD_T:	; Load the timer save location with the value the DPTR is
 1348:					; pointing to.
 1349:					;
 1350:					;****************************************************************
 1351:					;
 1352:	  057A	E0			MOVX	A,@DPTR
 1353:	  057B	F5 40			MOV	T_HH,A
 1354:	  057D	A3			INC	DPTR
 1355:	  057E	E0			MOVX	A,@DPTR
 1356:	  057F	F5 41			MOV	T_LL,A
 1357:	  0581	22			RET
 1358:					;
 1359:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 34



 Line  I  Addr  Code            Source

 1360:					;
 1361:					;***************************************************************
 1362:					;
 1363:					;GETLIN - FIND THE LOCATION OF THE LINE NUMBER IN R3:R1
 1364:					;         IF ACC = 0 THE LINE WAS NOT FOUND I.E. R3:R1
 1365:					;         WAS TOO BIG, ELSE ACC <> 0 AND THE DPTR POINTS
 1366:					;         AT THE LINE THAT IS GREATER THAN OR EQUAL TO THE
 1367:					;         VALUE IN R3:R1.
 1368:					;
 1369:					;***************************************************************
 1370:					;
 1371:	  0582	D2 29		GETEND:	SETB	ENDBIT		;GET THE END OF THE PROGRAM
 1372:					;
 1373:	  0584	12 0E 9C	GETLIN:	CALL	DP_B		;GET BEGINNING ADDRESS
 1374:					;
 1375:	  0587	12 0A A5	G1:	CALL	B_C
 1376:	  058A	60 12			JZ	G3		;EXIT WITH A ZERO IN A IF AT END
 1377:	  058C	A3			INC	DPTR		;POINT AT THE LINE NUMBER
 1378:	  058D	20 29 0A		JB	ENDBIT,G2	;SEE IF WE WANT TO FIND THE END
 1379:	  0590	B1 C4			ACALL	DCMPX		;SEE IF (DPTR) = R3:R1
 1380:	  0592	B1 BA			ACALL	DECDP		;POINT AT LINE COUNT
 1381:	  0594	E0			MOVX	A,@DPTR		;PUT LINE LENGTH INTO ACC
 1382:	  0595	20 2A 06		JB	UBIT,G3		;EXIT IF EQUAL
 1383:	  0598	40 04			JC	G3		;SEE IF LESS THAN OR ZERO
 1384:					;
 1385:	  059A	B1 D6		G2:	ACALL	ADDPTR		;ADD IT TO DPTR
 1386:	  059C	80 E9			SJMP	G1		;LOOP
 1387:					;
 1388:	  059E	C2 29		G3:	CLR	ENDBIT		;RESET ENDBIT
 1389:	  05A0	22			RET			;EXIT
 1390:					;
 1391:	  05A1	90 02 00	G4:	MOV	DPTR,#PSTART	;DO RAM
 1392:					;
 1393:	  05A4	D2 29		G5:	SETB	ENDBIT
 1394:	  05A6	80 DF			SJMP	G1		;NOW DO TEST
 1395:					;
 1396:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 35



 Line  I  Addr  Code            Source

 1397:					;***************************************************************
 1398:					;
 1399:					; LDPTRI - Load the DATA POINTER with the value it is pointing
 1400:					;          to - DPH = (DPTR) , DPL = (DPTR+1)
 1401:					;
 1402:					; acc gets wasted
 1403:					;
 1404:					;***************************************************************
 1405:					;
 1406:	  05A8	E0		LDPTRI:	MOVX	A,@DPTR		;GET THE HIGH BYTE
 1407:	  05A9	C0 E0			PUSH	ACC		;SAVE IT
 1408:	  05AB	A3			INC	DPTR		;BUMP THE POINTER
 1409:	  05AC	E0			MOVX	A,@DPTR		;GET THE LOW BYTE
 1410:	  05AD	F5 82			MOV	DPL,A		;PUT IT IN DPL
 1411:	  05AF	D0 83			POP	DPH		;GET THE HIGH BYTE
 1412:	  05B1	22			RET			;GO BACK
 1413:					;
 1414:					;***************************************************************
 1415:					;
 1416:					;L31DPI - LOAD R3 WITH (DPTR) AND R1 WITH (DPTR+1)
 1417:					;
 1418:					;ACC GETS CLOBBERED
 1419:					;
 1420:					;***************************************************************
 1421:					;
 1422:	  05B2	E0		L31DPI:	MOVX	A,@DPTR		;GET THE HIGH BYTE
 1423:	  05B3	FB			MOV	R3,A		;PUT IT IN THE REG
 1424:	  05B4	A3			INC	DPTR		;BUMP THE POINTER
 1425:	  05B5	E0			MOVX	A,@DPTR		;GET THE NEXT BYTE
 1426:	  05B6	F9			MOV	R1,A		;SAVE IT
 1427:	  05B7	22			RET
 1428:					;
 1429:					;***************************************************************
 1430:					;
 1431:					;DECDP - DECREMENT THE DATA POINTER - USED TO SAVE SPACE
 1432:					;
 1433:					;***************************************************************
 1434:					;
 1435:	  05B8	B1 BA		DECDP2:	ACALL	DECDP
 1436:					;
 1437:	  05BA	C5 82		DECDP:	XCH	A,DPL		;GET DPL
 1438:	  05BC	70 02			JNZ	$+4		;BUMP IF ZERO
 1439:	  05BE	15 83			DEC	DPH
 1440:	  05C0	14			DEC	A		;DECREMENT IT
 1441:	  05C1	C5 82			XCH	A,DPL		;GET A BACK
 1442:	  05C3	22			RET			;EXIT
 1443:					;
 1444:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 36



 Line  I  Addr  Code            Source

 1445:					;***************************************************************
 1446:					;
 1447:					;DCMPX - DOUBLE COMPARE - COMPARE (DPTR) TO R3:R1
 1448:					;R3:R1 - (DPTR) = SET CARRY FLAG
 1449:					;
 1450:					;IF R3:R1 > (DPTR) THEN C = 0
 1451:					;IF R3:R1 < (DPTR) THEN C = 1
 1452:					;IF R3:R1 = (DPTR) THEN C = 0
 1453:					;
 1454:					;***************************************************************
 1455:					;
 1456:	  05C4	C2 2A		DCMPX:	CLR	UBIT		;ASSUME NOT EQUAL
 1457:	  05C6	E0			MOVX	A,@DPTR		;GET THE BYTE
 1458:	  05C7	B5 03 0A		CJNE	A,R3B0,D1	;IF A IS GREATER THAN R3 THEN NO CARRY
 1459:								;WHICH IS R3<@DPTR = NO CARRY AND
 1460:								;R3>@DPTR CARRY IS SET
 1461:	  05CA	A3			INC	DPTR		;BUMP THE DATA POINTER
 1462:	  05CB	E0			MOVX	A,@DPTR		;GET THE BYTE
 1463:	  05CC	B1 BA			ACALL	DECDP		;PUT DPTR BACK
 1464:	  05CE	B5 01 03		CJNE	A,R1B0,D1	;DO THE COMPARE
 1465:	  05D1	B3			CPL	C		;FLIP CARRY
 1466:					;
 1467:	  05D2	B2 2A			CPL	UBIT		;SET IT
 1468:	  05D4	B3		D1:	CPL	C		;GET THE CARRY RIGHT
 1469:	  05D5	22			RET			;EXIT
 1470:					;
 1471:					;***************************************************************
 1472:					;
 1473:					; ADDPTR - Add acc to the dptr
 1474:					;
 1475:					; acc gets wasted
 1476:					;
 1477:					;***************************************************************
 1478:					;
 1479:	  05D6	25 82		ADDPTR:	ADD	A,DPL		;ADD THE ACC TO DPL
 1480:	  05D8	F5 82			MOV	DPL,A		;PUT IT IN DPL
 1481:	  05DA	50 02			JNC	$+4		;JUMP IF NO CARRY
 1482:	  05DC	05 83			INC	DPH		;BUMP DPH
 1483:	  05DE	22			RET			;EXIT
 1484:					;
 1485:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 37



 Line  I  Addr  Code            Source

 1486:					;*************************************************************
 1487:					;
 1488:	  05DF			LCLR:	; Set up the storage allocation
 1489:					;
 1490:					;*************************************************************
 1491:					;
 1492:	  05DF	D1 92			ACALL	ICLR		;CLEAR THE INTERRUPTS
 1493:	  05E1	B1 A1			ACALL	G4		;PUT END ADDRESS INTO DPTR
 1494:	  05E3	74 06			MOV	A,#6		;ADJUST MATRIX SPACE
 1495:	  05E5	B1 D6			ACALL	ADDPTR		;ADD FOR PROPER BOUNDS
 1496:	  05E7	B1 71			ACALL	X31DP		;PUT MATRIX BOUNDS IN R3:R1
 1497:	  05E9	90 01 08		MOV	DPTR,#MT_ALL	;SAVE R3:R1 IN MATRIX FREE SPACE
 1498:	  05EC	B1 FD			ACALL	S31DP		;DPTR POINTS TO MEMTOP
 1499:	  05EE	B1 B2			ACALL	L31DPI		;LOAD MEMTOP INTO R3:R1
 1500:	  05F0	90 01 22		MOV	DPTR,#STR_AL	;GET MEMORY ALLOCATED FOR STRINGS
 1501:	  05F3	B1 A8			ACALL	LDPTRI
 1502:	  05F5	12 0A 03		CALL	DUBSUB		;R3:R1 = MEMTOP - STRING ALLOCATION
 1503:	  05F8	90 01 04		MOV	DPTR,#VARTOP	;SAVE R3:R1 IN VARTOP
 1504:					;
 1505:					; FALL THRU TO S31DP2
 1506:					;
 1507:					;***************************************************************
 1508:					;
 1509:					;S31DP - STORE R3 INTO (DPTR) AND R1 INTO (DPTR+1)
 1510:					;
 1511:					;ACC GETS CLOBBERED
 1512:					;
 1513:					;***************************************************************
 1514:					;
 1515:	  05FB	B1 FD		S31DP2:	ACALL	S31DP		;DO IT TWICE
 1516:					;
 1517:	  05FD	EB		S31DP:	MOV	A,R3		;GET R3 INTO ACC
 1518:	  05FE	F0			MOVX	@DPTR,A		;STORE IT
 1519:	  05FF	A3			INC	DPTR		;BUMP DPTR
 1520:	  0600	E9			MOV	A,R1		;GET R1
 1521:	  0601	F0			MOVX	@DPTR,A		;STORE IT
 1522:	  0602	A3			INC	DPTR		;BUMP IT AGAIN TO SAVE PROGRAM SPACE
 1523:	  0603	22			RET			;GO BACK
 1524:					;
 1525:					;
 1526:					;***************************************************************
 1527:					;
 1528:	  0604			STRING:	; Allocate memory for strings
 1529:					;
 1530:					;***************************************************************
 1531:					;
 1532:	  0604	12 0E 86		LCALL	TWO		;R3:R1 = NUMBER, R2:R0 = LEN
 1533:	  0607	90 01 22		MOV	DPTR,#STR_AL	;SAVE STRING ALLOCATION
 1534:	  060A	B1 FD			ACALL	S31DP
 1535:	  060C	0E			INC	R6		;BUMP
 1536:	  060D	8E 3F			MOV	S_LEN,R6	;SAVE STRING LENGTH
 1537:	  060F	C1 5C			AJMP	RCLEAR		;CLEAR AND SET IT UP
 1538:					;
 1539:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 38



 Line  I  Addr  Code            Source

 1540:					;***************************************************************
 1541:					;
 1542:					; F_VAR - Find  the variable in symbol table
 1543:					;         R7:R6 contain the variable name
 1544:					;         If not found create a zero entry and set the carry
 1545:					;         R2:R0 has the address of variable on return
 1546:					;
 1547:					;***************************************************************
 1548:					;
 1549:	  0611	90 01 04	F_VAR:	MOV	DPTR,#VARTOP	;PUT VARTOP IN DPTR
 1550:	  0614	B1 A8			ACALL	LDPTRI
 1551:	  0616	B1 B8			ACALL	DECDP2		;ADJUST DPTR FOR LOOKUP
 1552:					;
 1553:	  0618	E0		F_VAR0:	MOVX	A,@DPTR		;LOAD THE VARIABLE
 1554:	  0619	60 20			JZ	F_VAR2		;TEST IF AT THE END OF THE TABLE
 1555:	  061B	A3			INC	DPTR		;BUMP FOR NEXT BYTE
 1556:	  061C	B5 07 0F		CJNE	A,R7B0,F_VAR1	;SEE IF MATCH
 1557:	  061F	E0			MOVX	A,@DPTR		;LOAD THE NAME
 1558:	  0620	B5 06 0B		CJNE	A,R6B0,F_VAR1
 1559:					;
 1560:					; Found the variable now adjust and put in R2:R0
 1561:					;
 1562:	  0623	E5 82		DLD:	MOV	A,DPL		;R2:R0 = DPTR-2
 1563:	  0625	94 02			SUBB	A,#2
 1564:	  0627	F8			MOV	R0,A
 1565:	  0628	E5 83			MOV	A,DPH
 1566:	  062A	94 00			SUBB	A,#0		;CARRY IS CLEARED
 1567:	  062C	FA			MOV	R2,A
 1568:	  062D	22			RET
 1569:					;
 1570:	  062E	E5 82		F_VAR1:	MOV	A,DPL		;SUBTRACT THE STACK SIZE+ADJUST
 1571:	  0630	C3			CLR	C
 1572:	  0631	94 09			SUBB	A,#STESIZ
 1573:	  0633	F5 82			MOV	DPL,A		;RESTORE DPL
 1574:	  0635	50 E1			JNC	F_VAR0
 1575:	  0637	15 83			DEC	DPH
 1576:	  0639	80 DD			SJMP	F_VAR0		;CONTINUE COMPARE
 1577:					;
 1578:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 39



 Line  I  Addr  Code            Source

 1579:					;
 1580:					; Add the entry to the symbol table
 1581:					;
 1582:	  063B	12 0D F0	F_VAR2:	LCALL	R76S		;SAVE R7 AND R6
 1583:	  063E	C3			CLR	C
 1584:	  063F	D1 23			ACALL	DLD		;BUMP THE POINTER TO GET ENTRY ADDRESS
 1585:					;
 1586:					; Adjust pointer and save storage allocation
 1587:					; and make sure we aren't wiping anything out
 1588:					; First calculate new storage allocation
 1589:					;
 1590:	  0641	E8			MOV	A,R0
 1591:	  0642	94 06			SUBB	A,#STESIZ-3	;NEED THIS MUCH RAM
 1592:	  0644	F9			MOV	R1,A
 1593:	  0645	EA			MOV	A,R2
 1594:	  0646	94 00			SUBB	A,#0
 1595:	  0648	FB			MOV	R3,A
 1596:					;
 1597:					; Now save the new storage allocation
 1598:					;
 1599:	  0649	90 01 06		MOV	DPTR,#ST_ALL
 1600:	  064C	B1 FD			CALL	S31DP		;SAVE STORAGE ALLOCATION
 1601:					;
 1602:					; Now make sure we didn't blow it, by wiping out MT_ALL
 1603:					;
 1604:	  064E	B1 C4			ACALL	DCMPX		;COMPARE STORAGE ALLOCATION
 1605:	  0650	40 32			JC	CCLR3		;ERROR IF CARRY
 1606:	  0652	D3			SETB	C		;DID NOT FIND ENTRY
 1607:	  0653	22			RET			;EXIT IF TEST IS OK
 1608:					;
 1609:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 40



 Line  I  Addr  Code            Source

 1610:					;***************************************************************
 1611:					;
 1612:					; Command action routine - NEW
 1613:					;
 1614:					;***************************************************************
 1615:					;
 1616:	  0654	90 02 00	CNEW:	MOV	DPTR,#PSTART	;SAVE THE START OF PROGRAM
 1617:	  0657	74 01			MOV	A,#EOF		;END OF FILE
 1618:	  0659	F0			MOVX	@DPTR,A		;PUT IT IN MEMORY
 1619:					;
 1620:					; falls thru
 1621:					;
 1622:					;*****************************************************************
 1623:					;
 1624:					; The statement action routine - CLEAR
 1625:					;
 1626:					;*****************************************************************
 1627:					;
 1628:	  065A	C2 15			CLR	LINEB		;SET UP FOR RUN AND GOTO
 1629:					;
 1630:	  065C	B1 DF		RCLEAR:	ACALL	LCLR		;CLEAR THE INTERRUPTS, SET UP MATRICES
 1631:	  065E	90 01 0A		MOV	DPTR,#MEMTOP	;PUT MEMTOP IN R3:R1
 1632:	  0661	B1 B2			ACALL	L31DPI
 1633:	  0663	B1 A1			ACALL	G4		;DPTR GETS END ADDRESS
 1634:	  0665	D1 75			ACALL	CL_1		;CLEAR THE MEMORY
 1635:					;
 1636:	  0667	90 00 FE	RC1:	MOV	DPTR,#STACKTP	;POINT AT CONTROL STACK TOP
 1637:	  066A	E4			CLR	A		;CONTROL UNDERFLOW
 1638:					;
 1639:	  066B	F0		RC2:	MOVX	@DPTR,A		;SAVE IN MEMORY
 1640:	  066C	75 11 FE		MOV	CSTKA,#STACKTP
 1641:	  066F	75 09 FE		MOV	ASTKA,#STACKTP
 1642:	  0672	C2 17			CLR	CONB		;CAN'T CONTINUE
 1643:	  0674	22			RET
 1644:					;
 1645:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 41



 Line  I  Addr  Code            Source

 1646:					;***************************************************************
 1647:					;
 1648:					; Loop until the memory is cleared
 1649:					;
 1650:					;***************************************************************
 1651:					;
 1652:	  0675	A3		CL_1:	INC	DPTR		;BUMP MEMORY POINTER
 1653:	  0676	E4			CLR	A		;CLEAR THE MEMORY
 1654:	  0677	F0			MOVX	@DPTR,A		;CLEAR THE RAM
 1655:	  0678	E0			MOVX	A,@DPTR		;READ IT
 1656:	  0679	70 09			JNZ	CCLR3		;MAKE SURE IT IS CLEARED
 1657:	  067B	EB			MOV	A,R3		;GET POINTER FOR COMPARE
 1658:	  067C	B5 83 F6		CJNE	A,DPH,CL_1	;SEE TO LOOP
 1659:	  067F	E9			MOV	A,R1		;NOW TEST LOW BYTE
 1660:	  0680	B5 82 F2		CJNE	A,DPL,CL_1
 1661:					;
 1662:	  0683	22		CL_2:	RET
 1663:					;
 1664:	  0684	02 15 9E	CCLR3:	JMP	TB		;ALLOCATED MEMORY DOESN'T EXSIST
 1665:					;
 1666:					;**************************************************************
 1667:					;
 1668:	  0687			SCLR:	;Entry point for clear return
 1669:					;
 1670:					;**************************************************************
 1671:					;
 1672:	  0687	12 0E E2		CALL	DELTST		;TEST FOR A CR
 1673:	  068A	50 D0			JNC	RCLEAR
 1674:	  068C	12 0E D8		CALL	GCI1		;BUMP THE TEST POINTER
 1675:	  068F	B4 49 D5		CJNE	A,#'I',RC1	;SEE IF I, ELSE RESET THE STACK
 1676:					;
 1677:					;**************************************************************
 1678:					;
 1679:	  0692			ICLR:	; Clear interrupts and system garbage
 1680:					;
 1681:					;**************************************************************
 1682:					;
 1683:	  0692	30 12 02		JNB	INTBIT,$+5	;SEE IF BASIC HAS INTERRUPTS
 1684:	  0695	C2 AA			CLR	EX1		;IF SO, CLEAR INTERRUPTS
 1685:	  0697	53 22 20		ANL	34,#00100000B	;SET INTERRUPTS + CONTINUE
 1686:	  069A	32			RETI
 1687:					;
 1688:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 42



 Line  I  Addr  Code            Source

 1689:					;***************************************************************
 1690:					;
 1691:					;OUTPUT ROUTINES
 1692:					;
 1693:					;***************************************************************
 1694:					;
 1695:	  069B	D1 9D		CRLF2:	ACALL	CRLF		;DO TWO CRLF'S
 1696:					;
 1697:	  069D	7D 0D		CRLF:	MOV	R5,#CR		;LOAD THE CR
 1698:	  069F	F1 09			ACALL	TEROT		;CALL TERMINAL OUT
 1699:	  06A1	7D 0A			MOV	R5,#LF		;LOAD THE LF
 1700:	  06A3	E1 09			AJMP	TEROT		;OUTPUT IT AND RETURN
 1701:					;
 1702:					;PRINT THE MESSAGE ADDRESSED IN ROM OR RAM BY THE DPTR
 1703:					;ENDS WITH THE CHARACTER IN R4
 1704:					;DPTR HAS THE ADDRESS OF THE TERMINATOR
 1705:					;
 1706:	  06A5	D1 9D		CRP:	ACALL	CRLF		;DO A CR THEN PRINT ROM
 1707:					;
 1708:	  06A7	E4		ROM_P:	CLR	A		;CLEAR A FOR LOOKUP
 1709:	  06A8	93			MOVC	A,@A+DPTR	;GET THE CHARACTER
 1710:	  06A9	C2 E7			CLR	ACC.7		;CLEAR MS BIT
 1711:	  06AB	B4 22 01		CJNE	A,#'"',$+4	;EXIT IF TERMINATOR
 1712:	  06AE	22			RET
 1713:	  06AF	D2 34			SETB	C0ORX1
 1714:					;
 1715:	  06B1	FD		PN1:	MOV	R5,A		;OUTPUT THE CHARACTER
 1716:	  06B2	F1 09			ACALL	TEROT
 1717:	  06B4	A3			INC	DPTR		;BUMP THE POINTER
 1718:	  06B5	80 04			SJMP	PN0
 1719:					;
 1720:	  06B7	B1 71		UPRNT:	ACALL	X31DP
 1721:					;
 1722:	  06B9	7C 0D		PRNTCR:	MOV	R4,#CR		;OUTPUT UNTIL A CR
 1723:					;
 1724:	  06BB	10 34 E9	PN0:	JBC	C0ORX1,ROM_P
 1725:	  06BE	E0			MOVX	A,@DPTR		;GET THE RAM BYTE
 1726:	  06BF	60 03			JZ	$+5
 1727:	  06C1	B5 04 01		CJNE	A,R4B0,$+4	;SEE IF THE SAME AS TERMINATOR
 1728:	  06C4	22			RET			;EXIT IF THE SAME
 1729:	  06C5	B4 0D E9		CJNE	A,#CR,PN1	;NEVER PRINT A CR IN THIS ROUTINE
 1730:	  06C8	02 18 7D		LJMP	E1XX		;BAD SYNTAX
 1731:					;
 1732:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 43



 Line  I  Addr  Code            Source

 1733:					;***************************************************************
 1734:					;
 1735:					; INLINE - Input a line to IBUF, exit when a CR is received
 1736:					;
 1737:					;***************************************************************
 1738:					;
 1739:	  06CB	B4 04 16	INL2:	CJNE 	A,#CNTRLD,INL2B	;SEE IF A CONTROL D
 1740:					;
 1741:	  06CE	D1 9D		INL0:	ACALL	CRLF		;DO A CR
 1742:					;
 1743:	  06D0	75 A0 00	INLINE:	MOV	P2,#HIGH IBUF	;IBUF IS IN THE ZERO PAGE
 1744:	  06D3	78 07			MOV	R0,#LOW IBUF	;POINT AT THE INPUT BUFFER
 1745:					;
 1746:	  06D5	F1 89		INL1:	ACALL	INCHAR		;GET A CHARACTER
 1747:	  06D7	FD			MOV	R5,A		;SAVE IN R5 FOR OUTPUT
 1748:	  06D8	B4 7F F0		CJNE	A,#7FH,INL2	;SEE IF A DELETE CHARACTER
 1749:	  06DB	B8 07 18		CJNE	R0,#LOW IBUF,INL6
 1750:	  06DE	7D 07			MOV	R5,#BELL	;OUTPUT A BELL
 1751:					;
 1752:	  06E0	F1 09		INLX:	ACALL	TEROT		;OUTPUT CHARACTER
 1753:	  06E2	80 F1			SJMP	INL1		;DO IT AGAIN
 1754:					;
 1755:	  06E4	F2		INL2B:	MOVX	@R0,A		;SAVE THE CHARACTER
 1756:	  06E5	B4 0D 02		CJNE	A,#CR,$+5	;IS IT A CR
 1757:	  06E8	C1 9D			AJMP	CRLF		;OUTPUT A CRLF AND EXIT
 1758:	  06EA	B4 20 00		CJNE	A,#20H,$+3
 1759:	  06ED	40 F1			JC	INLX		;ONLY ECHO CONTROL CHARACTERS
 1760:	  06EF	08			INC	R0		;BUMP THE POINTER
 1761:	  06F0	B8 56 ED		CJNE	R0,#IBUF+79,INLX
 1762:	  06F3	18			DEC	R0		;FORCE 79
 1763:	  06F4	80 E8			SJMP	INLX-2		;OUTPUT A BELL
 1764:					;
 1765:	  06F6	18		INL6:	DEC	R0		;DEC THE RAM POINTER
 1766:	  06F7	7D 08			MOV	R5,#BS		;OUTPUT A BACK SPACE
 1767:	  06F9	F1 09			ACALL	TEROT
 1768:	  06FB	F1 07			ACALL	STEROT		;OUTPUT A SPACE
 1769:	  06FD	7D 08			MOV	R5,#BS		;ANOTHER BACK SPACE
 1770:	  06FF	80 DF			SJMP	INLX		;OUTPUT IT
 1771:					;
 1772:	  0701	7E		PTIME:	DB	128-2		; PROM PROGRAMMER TIMER
 1773:	  0702	00			DB	00H
 1774:	  0703	00			DB	00H
 1775:	  0704	50			DB	50H
 1776:	  0705	67			DB	67H
 1777:	  0706	41			DB	41H
 1778:					;
 1779:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 44



 Line  I  Addr  Code            Source

 1780:				;$INCLUDE(:F2:BAS52.OUT)
 1781:				;BEGINNING
 1782:					;***************************************************************
 1783:					;
 1784:					; TEROT - Output a character to the system console
 1785:					;         update PHEAD position.
 1786:					;
 1787:					;***************************************************************
 1788:					;
 1789:	  0707	7D 20		STEROT:	MOV	R5,#' '		;OUTPUT A SPACE
 1790:					;
 1791:	  0709	C0 E0		TEROT:	PUSH	ACC		;SAVE THE ACCUMULATOR
 1792:	  070B	C0 83			PUSH	DPH		;SAVE THE DPTR
 1793:	  070D	C0 82			PUSH	DPL
 1794:	  070F	30 35 04		JNB	CNT_S,$+7	;WAIT FOR A CONTROL Q
 1795:	  0712	F1 85			ACALL	BCK		;GET SERIAL STATUS
 1796:	  0714	80 F9			SJMP	$-5
 1797:	  0716	ED			MOV	A,R5		;PUT OUTPUT BYTE IN A
 1798:	  0717	30 2C 05		JNB	BO,$+8		;CHECK FOR MONITOR
 1799:	  071A	12 20 40		LCALL	2040H		;DO THE MONITOR
 1800:	  071D	E1 5E			AJMP	TEROT1		;CLEAN UP
 1801:	  071F	30 1C 05		JNB	COUB,$+8	;SEE IF USER WANTS OUTPUT
 1802:	  0722	12 40 30		LCALL	4030H
 1803:	  0725	E1 5E			AJMP	TEROT1
 1804:	  0727	30 27 08		JNB	UPB,T_1		;NO AT IF NO XBIT
 1805:	  072A	30 19 05		JNB	LPB,T_1		;AT PRINT
 1806:	  072D	12 40 3C		LCALL	403CH		;CALL AT LOCATION
 1807:	  0730	E1 5E			AJMP	TEROT1		;FINISH OFF OUTPUT
 1808:					;
 1809:	  0732	30 1B 22	T_1:	JNB	COB,TXX		;SEE IF LIST SET
 1810:	  0735	90 01 24		MOV	DPTR,#SPV	;LOAD BAUD RATE
 1811:	  0738	B1 7A			ACALL	LD_T
 1812:	  073A	C2 97			CLR	LP		;OUTPUT START BIT
 1813:	  073C	B1 27			ACALL	TIMER_LOAD	;LOAD AND START THE TIMER
 1814:	  073E	ED			MOV	A,R5		;GET THE OUTPUT BYTE
 1815:	  073F	D3			SETB	C		;SET CARRY FOR LAST OUTPUT
 1816:	  0740	7D 09			MOV	R5,#9		;LOAD TIMER COUNTDOWN
 1817:					;
 1818:	  0742	13		LTOUT1:	RRC	A		;ROTATE A
 1819:	  0743	30 8F FD		JNB	TF1,$		;WAIT TILL TIMER READY
 1820:	  0746	92 97			MOV	LP,C		;OUTPUT THE BIT
 1821:	  0748	B1 27			ACALL	TIMER_LOAD	;DO THE NEXT BIT
 1822:	  074A	DD F6			DJNZ	R5,LTOUT1	;LOOP UNTIL DONE
 1823:	  074C	30 8F FD		JNB	TF1,$		;FIRST STOP BIT
 1824:	  074F	B1 27			ACALL	TIMER_LOAD
 1825:	  0751	30 8F FD		JNB	TF1,$		;SECOND STOP BIT
 1826:	  0754	FD			MOV	R5,A		;RESTORE R5
 1827:	  0755	80 07			SJMP	TEROT1		;BACK TO TEROT
 1828:					;
 1829:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 45



 Line  I  Addr  Code            Source

 1830:	  0757	30 99 FD	TXX:	JNB	TI,$		;WAIT FOR TRANSMIT READY
 1831:	  075A	C2 99			CLR	TI
 1832:	  075C	8D 99			MOV	SBUF,R5		;SEND OUT THE CHARACTER
 1833:					;
 1834:	  075E	BD 0D 03	TEROT1:	CJNE	R5,#CR,$+6	;SEE IF A CR
 1835:	  0761	75 16 00		MOV	PHEAD,#00H	;IF A CR, RESET PHEAD AND
 1836:					;
 1837:	  0764	BD 0A 0B		CJNE	R5,#LF,NLC	;SEE IF A LF
 1838:	  0767	E5 15			MOV	A,NULLCT	;GET THE NULL COUNT
 1839:	  0769	60 07			JZ	NLC		;NO NULLS IF ZERO
 1840:					;
 1841:	  076B	7D 00		TEROT2:	MOV	R5,#NULL	;PUT THE NULL IN THE OUTPUT REGISTER
 1842:	  076D	F1 09			ACALL	TEROT		;OUTPUT THE NULL
 1843:	  076F	14			DEC	A		;DECREMENT NULL COUNT
 1844:	  0770	70 F9			JNZ	TEROT2		;LOOP UNTIL DONE
 1845:					;
 1846:	  0772	BD 08 02	NLC:	CJNE	R5,#BS,$+5	;DEC PHEAD IF A BACKSPACE
 1847:	  0775	15 16			DEC	PHEAD
 1848:	  0777	BD 20 00		CJNE	R5,#20H,$+3	;IS IT A PRINTABLE CHARACTER?
 1849:	  077A	40 02			JC	$+4		;DON'T INCREMENT PHEAD IF NOT PRINTABLE
 1850:	  077C	05 16			INC	PHEAD		;BUMP PRINT HEAD
 1851:	  077E	D0 82			POP	DPL		;RESTORE DPTR
 1852:	  0780	D0 83			POP	DPH
 1853:	  0782	D0 E0			POP	ACC		;RESTORE ACC
 1854:	  0784	22			RET			;EXIT
 1855:					;
 1856:
 1857:				;END
 1858:				;$INCLUDE(:F2:BAS52.OUT)
 1859:					;
 1860:	  0785	F1 C4		BCK:	ACALL	CSTS		;CHECK STATUS
 1861:	  0787	50 32			JNC	CI_RET+1	;EXIT IF NO CHARACTER
 1862:					;
 1863:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 46



 Line  I  Addr  Code            Source

 1864:					;***************************************************************
 1865:					;
 1866:					;INPUTS A CHARACTER FROM THE SYSTEM CONSOLE.
 1867:					;
 1868:					;***************************************************************
 1869:					;
 1870:	  0789	30 32 05	INCHAR:	JNB	BI,$+8		;CHECK FOR MONITOR (BUBBLE)
 1871:	  078C	12 20 60		LCALL	2060H
 1872:	  078F	80 11			SJMP	INCH1
 1873:	  0791	30 1E 05		JNB	CIUB,$+8	;CHECK FOR USER
 1874:	  0794	12 40 33		LCALL	4033H
 1875:	  0797	80 09			SJMP	INCH1
 1876:	  0799	30 98 FD		JNB	RI,$		;WAIT FOR RECEIVER READY.
 1877:	  079C	E5 99			MOV	A,SBUF
 1878:	  079E	C2 98			CLR	RI		;RESET READY
 1879:	  07A0	C2 E7			CLR	ACC.7		;NO BIT 7
 1880:					;
 1881:	  07A2	B4 13 02	INCH1:	CJNE	A,#13H,$+5
 1882:	  07A5	D2 35			SETB	CNT_S
 1883:	  07A7	B4 11 02		CJNE	A,#11H,$+5
 1884:	  07AA	C2 35			CLR	CNT_S
 1885:	  07AC	B4 03 04		CJNE	A,#CNTRLC,$+7
 1886:	  07AF	30 30 26		JNB	NO_C,C_EX	;TRAP NO CONTROL C
 1887:	  07B2	22			RET
 1888:					;
 1889:	  07B3	C2 28			CLR	JKBIT
 1890:	  07B5	B4 17 02		CJNE	A,#17H,CI_RET	;CONTROL W
 1891:	  07B8	D2 28			SETB	JKBIT
 1892:					;
 1893:	  07BA	D3		CI_RET:	SETB	C		;CARRY SET IF A CHARACTER
 1894:	  07BB	22			RET			;EXIT
 1895:					;
 1896:					;*************************************************************
 1897:					;
 1898:					;RROM - The Statement Action Routine RROM
 1899:					;
 1900:					;*************************************************************
 1901:					;
 1902:	  07BC	D2 1D		RROM:	SETB	INBIT		;SO NO ERRORS
 1903:	  07BE	B1 3D			ACALL	RO1		;FIND THE LINE NUMBER
 1904:	  07C0	10 1D 43		JBC	INBIT,CRUN
 1905:	  07C3	22			RET			;EXIT
 1906:					;
 1907:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 47



 Line  I  Addr  Code            Source

 1908:					;***************************************************************
 1909:					;
 1910:	  07C4			CSTS:	;	RETURNS CARRY = 1 IF THERE IS A CHARACTER WAITING FROM
 1911:					;       THE SYSTEM CONSOLE. IF NO CHARACTER THE READY CHARACTER
 1912:					;       WILL BE CLEARED
 1913:					;
 1914:					;***************************************************************
 1915:					;
 1916:	  07C4	30 32 03		JNB	BI,$+6		;BUBBLE STATUS
 1917:	  07C7	02 20 68		LJMP	2068H
 1918:	  07CA	30 1E 03		JNB	CIUB,$+6	;SEE IF EXTERNAL CONSOLE
 1919:	  07CD	02 40 36		LJMP	4036H
 1920:	  07D0	A2 98			MOV	C,RI
 1921:	  07D2	22			RET
 1922:					;
 1923:	  07D3	90 19 60		MOV	DPTR,#WB	;EGO MESSAGE
 1924:	  07D6	D1 A7			ACALL	ROM_P
 1925:					;
 1926:	  07D8	C2 35		C_EX:	CLR	CNT_S		;NO OUTPUT STOP
 1927:	  07DA	12 0C 32		LCALL	SPRINT+4	;ASSURE CONSOLE
 1928:	  07DD	D1 9D			ACALL	CRLF
 1929:	  07DF	10 28 F1		JBC	JKBIT,C_EX-5
 1930:					;
 1931:	  07E2	30 2F 7F		JNB	DIRF,SSTOP0
 1932:	  07E5	A1 3A			AJMP	C_K		;CLEAR COB AND EXIT
 1933:					;
 1934:	  07E7	E5 48		T_CMP:	MOV	A,TVH		;COMPARE TIMER TO SP_H AND SP_L
 1935:	  07E9	A9 49			MOV	R1,TVL
 1936:	  07EB	B5 48 F9		CJNE	A,TVH,T_CMP
 1937:	  07EE	C9			XCH	A,R1
 1938:	  07EF	95 4C			SUBB	A,SP_L
 1939:	  07F1	E9			MOV	A,R1
 1940:	  07F2	95 4B			SUBB	A,SP_H
 1941:	  07F4	22			RET
 1942:					;
 1943:					;*************************************************************
 1944:					;
 1945:	  07F5			BR0:	; Trap the timer interrupt
 1946:					;
 1947:					;*************************************************************
 1948:					;
 1949:	  07F5	F1 E7			CALL	T_CMP		;COMPARE TIMER
 1950:	  07F7	40 40			JC	BCHR+6		;EXIT IF TEST FAILS
 1951:	  07F9	D2 14			SETB	OTI		;DOING THE TIMER INTERRUPT
 1952:	  07FB	C2 10			CLR	OTS		;CLEAR TIMER BIT
 1953:	  07FD	A2 11			MOV	C,INPROG	;SAVE IN PROGRESS
 1954:	  07FF	92 2B			MOV	ISAV,C
 1955:	  0801	90 01 26		MOV	DPTR,#TIV
 1956:	  0804	80 3C			SJMP	BR2
 1957:					;
 1958:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 48



 Line  I  Addr  Code            Source

 1959:					;***************************************************************
 1960:					;
 1961:					; The command action routine - RUN
 1962:					;
 1963:					;***************************************************************
 1964:					;
 1965:	  0806	12 06 5A	CRUN:	LCALL	RCLEAR-2	;CLEAR THE STORAGE ARRAYS
 1966:	  0809	71 D1			ACALL	SRESTR+2	;GET THE STARTING ADDRESS
 1967:	  080B	51 A5			ACALL	B_C
 1968:	  080D	60 4A			JZ	CMNDLK		;IF NULL GO TO COMMAND MODE
 1969:					;
 1970:	  080F	D1 B9			ACALL	T_DP
 1971:	  0811	F1 24			ACALL	B_TXA		;BUMP TO STARTING LINE
 1972:					;
 1973:	  0813	91 3D		CILOOP:	ACALL	SP0		;DO A CR AND A LF
 1974:	  0815	C2 2F			CLR	DIRF		;NOT IN DIRECT MODE
 1975:					;
 1976:					;INTERPERTER DRIVER
 1977:					;
 1978:	  0817	85 3E 81	ILOOP:	MOV	SP,SPSAV	;RESTORE THE STACK EACH TIME
 1979:	  081A	20 2F 06		JB	DIRF,$+9	;NO INTERRUPTS IF IN DIRECT MODE
 1980:	  081D	85 0A 42		MOV	INTXAH,TXAH	;SAVE THE TEXT POINTER
 1981:	  0820	85 08 43		MOV	INTXAL,TXAL
 1982:	  0823	12 07 85		LCALL	BCK		;GET CONSOLE STATUS
 1983:	  0826	20 2F 24		JB	DIRF,I_L	;DIRECT MODE
 1984:	  0829	B0 18			ANL	C,/GTRD		;SEE IF CHARACTER READY
 1985:	  082B	50 06			JNC	BCHR		;NO CHARACTER = NO CARRY
 1986:					;
 1987:					; DO TRAP OPERATION
 1988:					;
 1989:	  082D	90 01 00		MOV	DPTR,#GTB	;SAVE TRAP CHARACTER
 1990:	  0830	F0			MOVX	@DPTR,A
 1991:	  0831	D2 18			SETB	GTRD		;SAYS READ A BYTE
 1992:					;
 1993:	  0833	20 14 17	BCHR:	JB	OTI,I_L		;EXIT IF TIMER INTERRUPT IN PROGRESS
 1994:	  0836	20 10 BC		JB	OTS,BR0		;TEST TIMER VALUE IF SET
 1995:	  0839	30 16 11		JNB	INTPEN,I_L	;SEE IF INTERRUPT PENDING
 1996:	  083C	20 11 0E		JB	INPROG,I_L	;DON'T DO IT AGAIN IF IN PROGRESS
 1997:	  083F	90 01 20		MOV	DPTR,#INTLOC	;POINT AT INTERRUPT LOCATION
 1998:					;
 1999:	  0842	7C 02		BR2:	MOV	R4,#GTYPE	;SETUP FOR A FORCED GOSUB
 2000:	  0844	71 36			ACALL	SGS1		;PUT TXA ON STACK
 2001:	  0846	D2 11			SETB	INPROG		;INTERRUPT IN PROGRESS
 2002:					;
 2003:	  0848	12 05 6B	ERL4:	CALL	L20DPI
 2004:	  084B	41 F9			AJMP	D_L1		;GET THE LINE NUMBER
 2005:					;
 2006:	  084D	11 F9		I_L:	ACALL	ISTAT		;LOOP
 2007:	  084F	F1 18			ACALL	CLN_UP		;FINISH IT OFF
 2008:	  0851	50 C4			JNC	ILOOP		;LOOP ON THE DRIVER
 2009:	  0853	30 2F 03		JNB	DIRF,CMNDLK	;CMND1 IF IN RUN MODE
 2010:	  0856	02 17 92		LJMP	CMNDR		;DON'T PRINT READY
 2011:					;
 2012:	  0859	02 17 7C	CMNDLK:	JMP	CMND1		;DONE
 2013:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 49



 Line  I  Addr  Code            Source

 2014:					;**************************************************************
 2015:					;
 2016:					; The Statement Action Routine - STOP
 2017:					;
 2018:					;**************************************************************
 2019:					;
 2020:	  085C	F1 18		SSTOP:	ACALL	CLN_UP		;FINISH OFF THIS LINE
 2021:	  085E	85 0A 42		MOV	INTXAH,TXAH	;SAVE TEXT POINTER FOR CONT
 2022:	  0861	85 08 43		MOV	INTXAL,TXAL
 2023:					;
 2024:	  0864	D2 17		SSTOP0:	SETB	CONB		;CONTINUE WILL WORK
 2025:	  0866	90 00 EC		MOV	DPTR,#STP	;PRINT THE STOP MESSAGE
 2026:	  0869	D2 20			SETB	STOPBIT		;SET FOR ERROR ROUTINE
 2027:	  086B	02 18 A5		JMP	ERRS		;JUMP TO ERROR ROUTINE
 2028:					;
 2029:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 50



 Line  I  Addr  Code            Source

 2030:					;**************************************************************
 2031:					;
 2032:					; ITRAP - Trap special function register operators
 2033:					;
 2034:					;**************************************************************
 2035:					;
 2036:	  086E	B4 C8 05	ITRAP:	CJNE	A,#TMR0,$+8	;TIMER 0
 2037:	  0871	8B 8C			MOV	TH0,R3
 2038:	  0873	89 8A			MOV	TL0,R1
 2039:	  0875	22			RET
 2040:					;
 2041:	  0876	B4 C9 05		CJNE	A,#TMR1,$+8	;TIMER 1
 2042:	  0879	8B 8D			MOV	TH1,R3
 2043:	  087B	89 8B			MOV	TL1,R1
 2044:	  087D	22			RET
 2045:					;
 2046:	  087E	B4 CA 05		CJNE	A,#TMR2,$+8	;TIMER 2
 2047:	  0881	8B			DB	8BH		;MOV R3 DIRECT OP CODE
 2048:	  0882	CD			DB	0CDH		;T2H LOCATION
 2049:	  0883	89			DB	89H		;MOV R1 DIRECT OP CODE
 2050:	  0884	CC			DB	0CCH		;T2L LOCATION
 2051:	  0885	22			RET
 2052:					;
 2053:	  0886	B4 CE 05		CJNE	A,#TRC2,$+8	;RCAP2 TOKEN
 2054:	  0889	8B		RCL:	DB	8BH		;MOV R3 DIRECT OP CODE
 2055:	  088A	CB			DB	0CBH		;RCAP2H LOCATION
 2056:	  088B	89			DB	89H		;MOV R1 DIRECT OP CODE
 2057:	  088C	CA			DB	0CAH		;RCAP2L LOCATION
 2058:	  088D	22			RET
 2059:					;
 2060:	  088E	31 D6			ACALL	R3CK		;MAKE SURE THAT R3 IS ZERO
 2061:	  0890	B4 CB 03		CJNE	A,#TT2C,$+6
 2062:	  0893	89			DB	89H		;MOV R1 DIRECT OP CODE
 2063:	  0894	C8			DB	0C8H		;T2CON LOCATION
 2064:	  0895	22			RET
 2065:					;
 2066:	  0896	B4 C6 03		CJNE	A,#T_IE,$+6	;IE TOKEN
 2067:	  0899	89 A8			MOV	IE,R1
 2068:	  089B	22			RET
 2069:					;
 2070:	  089C	B4 C7 03		CJNE	A,#T_IP,$+6	;IP TOKEN
 2071:	  089F	89 B8			MOV	IP,R1
 2072:	  08A1	22			RET
 2073:					;
 2074:	  08A2	B4 CC 03		CJNE	A,#TTC,$+6	;TCON TOKEN
 2075:	  08A5	89 88			MOV	TCON,R1
 2076:	  08A7	22			RET
 2077:					;
 2078:	  08A8	B4 CD 03		CJNE	A,#TTM,$+6	;TMOD TOKEN
 2079:	  08AB	89 89			MOV	TMOD,R1
 2080:	  08AD	22			RET
 2081:					;
 2082:	  08AE	B4 CF 2F		CJNE	A,#T_P1,T_T2	;P1 TOKEN
 2083:	  08B1	89 90			MOV	P1,R1
 2084:	  08B3	22			RET
 2085:					;

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 51



 Line  I  Addr  Code            Source

 2086:					;***************************************************************
 2087:					;
 2088:					; T_TRAP - Trap special operators
 2089:					;
 2090:					;***************************************************************
 2091:					;
 2092:	  08B4	F5 0F		T_T:	MOV	TEMP5,A		;SAVE THE TOKEN
 2093:	  08B6	D1 D8			ACALL	GCI1		;BUMP POINTER
 2094:	  08B8	31 C9			ACALL	SLET2		;EVALUATE AFTER =
 2095:	  08BA	E5 0F			MOV	A,TEMP5		;GET THE TOKEN BACK
 2096:	  08BC	B4 C3 03		CJNE	A,#T_XTAL,$+6
 2097:	  08BF	02 16 45		LJMP	AXTAL1		;SET UP CRYSTAL
 2098:					;
 2099:	  08C2	D1 91			ACALL	IFIXL		;R3:R1 HAS THE TOS
 2100:	  08C4	E5 0F			MOV	A,TEMP5		;GET THE TOKEN AGAIN
 2101:	  08C6	B4 C4 09		CJNE	A,#T_MTOP,T_T1	;SEE IF MTOP TOKEN
 2102:	  08C9	90 01 0A		MOV	DPTR,#MEMTOP
 2103:	  08CC	12 05 FD		CALL	S31DP
 2104:	  08CF	02 06 5C		JMP	RCLEAR		;CLEAR THE MEMORY
 2105:					;
 2106:	  08D2	B4 C5 99	T_T1:	CJNE	A,#T_TIME,ITRAP	;SEE IF A TIME TOKEN
 2107:	  08D5	A2 AF			MOV	C,EA		;SAVE INTERRUPTS
 2108:	  08D7	C2 AF			CLR	EA		;NO TIMER 0 INTERRUPTS DURING LOAD
 2109:	  08D9	8B 48			MOV	TVH,R3		;SAVE THE TIME
 2110:	  08DB	89 49			MOV	TVL,R1
 2111:	  08DD	92 AF			MOV	EA,C		;RESTORE INTERRUPTS
 2112:	  08DF	22			RET			;EXIT
 2113:					;
 2114:	  08E0	B4 D0 56	T_T2:	CJNE	A,#T_PC,INTERX	;PCON TOKEN
 2115:	  08E3	89			DB	89H		;MOV DIRECT, R1 OP CODE
 2116:	  08E4	87			DB	87H		;ADDRESS OF PCON
 2117:	  08E5	22			RET			;EXIT
 2118:					;
 2119:	  08E6	B4 D1 CB	T_TRAP:	CJNE	A,#T_ASC,T_T	;SEE IF ASC TOKEN
 2120:	  08E9	D1 CC			ACALL	IGC		;EAT IT AND GET THE NEXT CHARACTER
 2121:	  08EB	B4 24 4B		CJNE	A,#'$',INTERX	;ERROR IF NOT A STRING
 2122:	  08EE	51 1F			ACALL	CSY		;CALCULATE ADDRESS
 2123:	  08F0	B1 AE			ACALL	X3120
 2124:	  08F2	12 14 9D		CALL	TWO_EY
 2125:	  08F5	31 DE			ACALL	SPEOP+4		;EVALUATE AFTER EQUALS
 2126:	  08F7	21 22			AJMP	ISTAX1		;SAVE THE CHARACTER
 2127:					;
 2128:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 52



 Line  I  Addr  Code            Source

 2129:					;**************************************************************
 2130:					;
 2131:					;INTERPERT THE STATEMENT POINTED TO BY TXAL AND TXAH
 2132:					;
 2133:					;**************************************************************
 2134:					;
 2135:	  08F9	D1 CE		ISTAT:	ACALL	GC		;GET THR FIRST CHARACTER
 2136:	  08FB	30 2D 0E		JNB	XBIT,IAT	;TRAP TO EXTERNAL RUN PACKAGE
 2137:	  08FE	B4 20 00		CJNE	A,#20H,$+3
 2138:	  0901	50 09			JNC	IAT
 2139:	  0903	12 20 70		LCALL	2070H		;LET THE USER SET UP THE DPTR
 2140:	  0906	D1 D8			ACALL	GCI1
 2141:	  0908	54 0F			ANL	A,#0FH		;STRIP OFF BIAS
 2142:	  090A	80 51			SJMP	ISTA1
 2143:					;
 2144:	  090C	B4 C3 00	IAT:	CJNE	A,#T_XTAL,$+3
 2145:	  090F	50 D5			JNC	T_TRAP
 2146:	  0911	30 E7 5B		JNB	ACC.7,SLET	;IMPLIED LET IF BIT 7 NOT SET
 2147:	  0914	B4 BC 06		CJNE	A,#T_UOP+12,ISTAX	;DBYTE TOKEN
 2148:	  0917	31 DA			ACALL	SPEOP		;EVALUATE SPECIAL OPERATOR
 2149:	  0919	31 D6			ACALL	R3CK		;CHECK LOCATION
 2150:	  091B	F7			MOV	@R1,A		;SAVE IT
 2151:	  091C	22			RET
 2152:					;
 2153:	  091D	B4 BD 06	ISTAX:	CJNE	A,#T_UOP+13,ISTAY	;XBYTE TOKEN
 2154:	  0920	31 DA			ACALL	SPEOP
 2155:					;
 2156:	  0922	8B A0		ISTAX1:	MOV	P2,R3
 2157:	  0924	F3			MOVX	@R1,A
 2158:	  0925	22			RET
 2159:					;
 2160:	  0926	B4 AB 00	ISTAY:	CJNE	A,#T_CR+1,$+3	;TRAP NEW OPERATORS
 2161:	  0929	40 09			JC	I_S
 2162:	  092B	B4 B0 00		CJNE	A,#0B0H,$+3	;SEE IF TOO BIG
 2163:	  092E	50 09			JNC	INTERX
 2164:	  0930	24 F9			ADD	A,#0F9H		;BIAS FOR LOOKUP TABLE
 2165:	  0932	80 1D			SJMP	ISTA0		;DO THE OPERATION
 2166:					;
 2167:	  0934	B4 A4 00	I_S:	CJNE	A,#T_LAST,$+3	;MAKE SURE AN INITIAL RESERVED WORD
 2168:	  0937	40 03			JC	$+5		;ERROR IF NOT
 2169:					;
 2170:	  0939	02 18 7D	INTERX:	LJMP	E1XX		;SYNTAX ERROR
 2171:					;
 2172:	  093C	30 2F 12		JNB	DIRF,ISTA0	;EXECUTE ALL STATEMENTS IF IN RUN MODE
 2173:	  093F	B4 90 00		CJNE	A,#T_DIR,$+3	;SEE IF ON TOKEN
 2174:	  0942	40 0D			JC	ISTA0		;OK IF DIRECT
 2175:	  0944	B4 A0 02		CJNE	A,#T_GOSB+1,$+5	;SEE IF FOR
 2176:	  0947	80 08			SJMP	ISTA0		;FOR IS OK
 2177:	  0949	B4 97 02		CJNE	A,#T_REM+1,$+5	;NEXT IS OK
 2178:	  094C	80 03			SJMP	ISTA0
 2179:	  094E	B4 96 E8		CJNE	A,#T_STOP+6,INTERX	;SO IS REM
 2180:					;
 2181:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 53



 Line  I  Addr  Code            Source

 2182:	  0951	D1 D8		ISTA0:	ACALL	GCI1		;ADVANCE THE TEXT POINTER
 2183:	  0953	90 01 21		MOV	DPTR,#STATD	;POINT DPTR TO LOOKUP TABLE
 2184:	  0956	B4 80 02		CJNE	A,#T_GOTO-3,$+5	;SEE IF LET TOKEN
 2185:	  0959	80 9E			SJMP	ISTAT		;WASTE LET TOKEN
 2186:	  095B	54 3F			ANL	A,#3FH		;STRIP OFF THE GARBAGE
 2187:					;
 2188:	  095D	23		ISTA1:	RL	A		;ROTATE FOR OFFSET
 2189:	  095E	25 82			ADD	A,DPL		;BUMP
 2190:	  0960	F5 82			MOV	DPL,A		;SAVE IT
 2191:	  0962	E4			CLR	A
 2192:	  0963	93			MOVC	A,@A+DPTR	;GET HIGH BYTE
 2193:	  0964	C0 E0			PUSH	ACC		;SAVE IT
 2194:	  0966	A3			INC	DPTR
 2195:	  0967	E4			CLR	A
 2196:	  0968	93			MOVC	A,@A+DPTR	;GET LOW BYTE
 2197:	  0969	D0 83			POP	DPH
 2198:	  096B	F5 82			MOV	DPL,A
 2199:					;
 2200:	  096D	E4		AC1:	CLR	A
 2201:	  096E	73			JMP	@A+DPTR		;GO DO IT
 2202:					;
 2203:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 54



 Line  I  Addr  Code            Source

 2204:					;***************************************************************
 2205:					;
 2206:					; The statement action routine - LET
 2207:					;
 2208:					;***************************************************************
 2209:					;
 2210:	  096F	D1 C0		SLET:	ACALL	S_C		;CHECK FOR POSSIBLE STRING
 2211:	  0971	40 50			JC	SLET0		;NO STRING
 2212:	  0973	C2 15			CLR	LINEB		;USED STRINGS
 2213:					;
 2214:	  0975	12 05 71		CALL	X31DP		;PUT ADDRESS IN DPTR
 2215:	  0978	7F EA			MOV	R7,#T_EQU	;WASTE =
 2216:	  097A	91 E6			ACALL	EATC
 2217:	  097C	D1 CE			ACALL	GC		;GET THE NEXT CHARACTER
 2218:	  097E	B4 22 11		CJNE	A,#'"',S_3	;CHECK FOR A "
 2219:	  0981	AF 3F			MOV	R7,S_LEN	;GET THE STRING LENGTH
 2220:					;
 2221:	  0983	D1 D8		S_0:	ACALL	GCI1		;BUMP PAST "
 2222:	  0985	D1 E2			ACALL	DELTST		;CHECK FOR DELIMITER
 2223:	  0987	60 B0			JZ	INTERX		;EXIT IF CARRIAGE RETURN
 2224:	  0989	F0			MOVX	@DPTR,A		;SAVE THE CHARACTER
 2225:	  098A	B4 22 26		CJNE	A,#'"',S_1	;SEE IF DONE
 2226:					;
 2227:	  098D	74 0D		S_E:	MOV	A,#CR		;PUT A CR IN A
 2228:	  098F	F0			MOVX	@DPTR,A		;SAVE CR
 2229:	  0990	C1 D8			AJMP	GCI1
 2230:					;
 2231:	  0992	C0 83		S_3:	PUSH	DPH
 2232:	  0994	C0 82			PUSH	DPL		;SAVE DESTINATION
 2233:	  0996	D1 C0			ACALL	S_C		;CALCULATE SOURCE
 2234:	  0998	40 9F			JC	INTERX		;ERROR IF CARRY
 2235:	  099A	D0 00			POP	R0B0		;GET DESTINATION BACK
 2236:	  099C	D0 02			POP	R2B0
 2237:					;
 2238:	  099E	AF 3F		SSOOP:	MOV	R7,S_LEN	;SET UP COUNTER
 2239:					;
 2240:	  09A0	12 15 7F	S_4:	CALL	TBYTE		;TRANSFER THE BYTE
 2241:	  09A3	B4 0D 01		CJNE	A,#CR,$+4	;EXIT IF A CR
 2242:	  09A6	22			RET
 2243:	  09A7	DF 05			DJNZ	R7,S_5		;BUMP COUNTER
 2244:	  09A9	74 0D			MOV	A,#CR		;SAVE A CR
 2245:	  09AB	F2			MOVX	@R0,A
 2246:	  09AC	C1 4F			AJMP	EIGP		;PRINT EXTRA IGNORED
 2247:					;
 2248:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 55



 Line  I  Addr  Code            Source

 2249:					;
 2250:	  09AE	12 15 5F	S_5:	CALL	INC3210		;BUMP POINTERS
 2251:	  09B1	80 ED			SJMP	S_4		;LOOP
 2252:					;
 2253:	  09B3	DF 06		S_1:	DJNZ	R7,$+8		;SEE IF DONE
 2254:	  09B5	31 8D			ACALL	S_E
 2255:	  09B7	D1 4F			ACALL	EIGP		;PRINT EXTRA IGNORED
 2256:	  09B9	C1 ED			AJMP	FINDCR		;GO FIND THE END
 2257:	  09BB	A3			INC	DPTR		;BUMP THE STORE POINTER
 2258:	  09BC	80 C5			SJMP	S_0		;CONTINUE TO LOOP
 2259:					;
 2260:	  09BE	90 18 20	E3XX:	MOV	DPTR,#E3X	;BAD ARG ERROR
 2261:	  09C1	81 0F			AJMP	EK
 2262:					;
 2263:	  09C3	31 C7		SLET0:	ACALL	SLET1
 2264:	  09C5	E1 D4			AJMP	POPAS		;COPY EXPRESSION TO VARIABLE
 2265:					;
 2266:	  09C7	F1 02		SLET1:	ACALL	VAR_ER		;CHECK FOR A"VARIABLE"
 2267:					;
 2268:	  09C9	C0 02		SLET2:	PUSH	R2B0		;SAVE THE VARIABLE ADDRESS
 2269:	  09CB	C0 00			PUSH	R0B0
 2270:	  09CD	7F EA			MOV	R7,#T_EQU	;GET EQUAL TOKEN
 2271:	  09CF	F1 42			ACALL	WE
 2272:	  09D1	D0 01			POP	R1B0		;POP VARIABLE TO R3:R1
 2273:	  09D3	D0 03			POP	R3B0
 2274:	  09D5	22			RET			;EXIT
 2275:					;
 2276:	  09D6	BB 00 E5	R3CK:	CJNE	R3,#00H,E3XX	;CHECK TO SEE IF R3 IS ZERO
 2277:	  09D9	22			RET
 2278:					;
 2279:	  09DA	D1 D8		SPEOP:	ACALL	GCI1		;BUMP TXA
 2280:	  09DC	91 E0			ACALL	P_E		;EVALUATE PAREN
 2281:	  09DE	31 C9			ACALL	SLET2		;EVALUATE AFTER =
 2282:	  09E0	12 14 8A		CALL	TWOL		;R7:R6 GETS VALUE, R3:R1 GETS LOCATION
 2283:	  09E3	EE			MOV	A,R6		;SAVE THE VALUE
 2284:					;
 2285:	  09E4	BF 00 D7		CJNE	R7,#00H,E3XX	;R2 MUST BE = 0
 2286:	  09E7	22			RET
 2287:					;
 2288:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 56



 Line  I  Addr  Code            Source

 2289:					;**************************************************************
 2290:					;
 2291:					; ST_CAL - Calculate string Address
 2292:					;
 2293:					;**************************************************************
 2294:					;
 2295:	  09E8			IST_CAL:;
 2296:					;
 2297:	  09E8	D1 96			ACALL	I_PI		;BUMP TEXT, THEN EVALUATE
 2298:	  09EA	31 D6			ACALL	R3CK		;ERROR IF R3 <> 0
 2299:	  09EC	09			INC	R1		;BUMP FOR OFFSET
 2300:	  09ED	E9			MOV	A,R1		;ERROR IF R1 = 255
 2301:	  09EE	60 CE			JZ	E3XX
 2302:	  09F0	90 01 04		MOV	DPTR,#VARTOP	;GET TOP OF VARIABLE STORAGE
 2303:	  09F3	85 3F F0		MOV	B,S_LEN		;MULTIPLY FOR LOCATION
 2304:	  09F6	51 11			ACALL	VARD		;CALCULATE THE LOCATION
 2305:	  09F8	90 01 0A		MOV	DPTR,#MEMTOP	;SEE IF BLEW IT
 2306:	  09FB	12 15 99		CALL	FUL1
 2307:	  09FE	85 3F 82		MOV	DPL,S_LEN	;GET STRING LENGTH, DPH = 00H
 2308:	  0A01	15 83			DEC	DPH		;DPH = 0
 2309:					;
 2310:	  0A03	C3		DUBSUB:	CLR	C
 2311:	  0A04	E9			MOV	A,R1
 2312:	  0A05	95 82			SUBB	A,DPL
 2313:	  0A07	F9			MOV	R1,A
 2314:	  0A08	EB			MOV	A,R3
 2315:	  0A09	95 83			SUBB	A,DPH
 2316:	  0A0B	FB			MOV	R3,A
 2317:	  0A0C	49			ORL	A,R1
 2318:	  0A0D	22			RET
 2319:					;
 2320:					;***************************************************************
 2321:					;
 2322:					;VARD - Calculate the offset base
 2323:					;
 2324:					;***************************************************************
 2325:					;
 2326:	  0A0E	75 F0 06	VARB:	MOV	B,#FPSIZ	;SET UP FOR OPERATION
 2327:					;
 2328:	  0A11	12 05 A8	VARD:	CALL	LDPTRI		;LOAD DPTR
 2329:	  0A14	E9			MOV	A,R1		;MULTIPLY BASE
 2330:	  0A15	A4			MUL	AB
 2331:	  0A16	25 82			ADD	A,DPL
 2332:	  0A18	F9			MOV	R1,A
 2333:	  0A19	E5 F0			MOV	A,B
 2334:	  0A1B	35 83			ADDC	A,DPH
 2335:	  0A1D	FB			MOV	R3,A
 2336:	  0A1E	22			RET
 2337:					;
 2338:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 57



 Line  I  Addr  Code            Source

 2339:					;*************************************************************
 2340:					;
 2341:	  0A1F			CSY:	; Calculate a biased string address and put in R3:R1
 2342:					;
 2343:					;*************************************************************
 2344:					;
 2345:	  0A1F	31 E8			ACALL	IST_CAL		;CALCULATE IT
 2346:	  0A21	C0 03			PUSH	R3B0		;SAVE IT
 2347:	  0A23	C0 01			PUSH	R1B0
 2348:	  0A25	7F 2C			MOV	R7,#','		;WASTE THE COMMA
 2349:	  0A27	91 E6			ACALL	EATC
 2350:	  0A29	D1 8F			ACALL	ONE		;GET THE NEXT EXPRESSION
 2351:	  0A2B	E9			MOV	A,R1		;CHECK FOR BOUNDS
 2352:	  0A2C	B5 3F 00		CJNE	A,S_LEN,$+3
 2353:	  0A2F	50 8D			JNC	E3XX		;MUST HAVE A CARRY
 2354:	  0A31	19			DEC	R1		;BIAS THE POINTER
 2355:	  0A32	D0 E0			POP	ACC		;GET VALUE LOW
 2356:	  0A34	29			ADD	A,R1		;ADD IT TO BASE
 2357:	  0A35	F9			MOV	R1,A		;SAVE IT
 2358:	  0A36	D0 03			POP	R3B0		;GET HIGH ADDRESS
 2359:	  0A38	50 01			JNC	$+3		;PROPAGATE THE CARRY
 2360:	  0A3A	0B			INC	R3
 2361:	  0A3B	81 E4			AJMP	ERPAR		;WASTE THE RIGHT PAREN
 2362:					;
 2363:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 58



 Line  I  Addr  Code            Source

 2364:					;***************************************************************
 2365:					;
 2366:					; The statement action routine FOR
 2367:					;
 2368:					;***************************************************************
 2369:					;
 2370:	  0A3D	31 C7		SFOR:	ACALL	SLET1		;SET UP CONTROL VARIABLE
 2371:	  0A3F	C0 03			PUSH	R3B0		;SAVE THE CONTROL VARIABLE LOCATION
 2372:	  0A41	C0 01			PUSH	R1B0
 2373:	  0A43	F1 D4			ACALL	POPAS		;POP ARG STACK AND COPY CONTROL VAR
 2374:	  0A45	7F A6			MOV	R7,#T_TO	;GET TO TOKEN
 2375:	  0A47	F1 42			ACALL	WE
 2376:	  0A49	D1 CE			ACALL	GC		;GET NEXT CHARACTER
 2377:	  0A4B	B4 A7 06		CJNE	A,#T_STEP,SF2
 2378:	  0A4E	D1 D8			ACALL	GCI1		;EAT THE TOKEN
 2379:	  0A50	F1 44			ACALL	EXPRB		;EVALUATE EXPRESSION
 2380:	  0A52	80 03			SJMP	$+5		;JUMP OVER
 2381:					;
 2382:	  0A54	12 14 2C	SF2:	LCALL	PUSH_ONE	;PUT ONE ON THE STACK
 2383:					;
 2384:	  0A57	74 EF			MOV	A,#-FSIZE	;ALLOCATE FSIZE BYTES ON THE CONTROL STACK
 2385:	  0A59	71 B2			ACALL	PUSHCS		;GET CS IN R0
 2386:	  0A5B	71 BE			ACALL	CSC		;CHECK CONTROL STACK
 2387:	  0A5D	7B 00			MOV	R3,#CSTKAH	;IN CONTROL STACK
 2388:	  0A5F	A9 00			MOV	R1,R0B0		;STACK ADDRESS
 2389:	  0A61	F1 D4			ACALL	POPAS		;PUT STEP ON STACK
 2390:	  0A63	F1 D4			ACALL	POPAS		;PUT LIMIT ON STACK
 2391:	  0A65	D1 A3			ACALL	DP_T		;DPTR GETS TEXT
 2392:	  0A67	A8 01			MOV	R0,R1B0		;GET THE POINTER
 2393:	  0A69	71 3A			ACALL	T_X_S		;SAVE THE TEXT
 2394:	  0A6B	D0 08			POP	TXAL		;GET CONTROL VARIABLE
 2395:	  0A6D	D0 0A			POP	TXAH
 2396:	  0A6F	7C 01			MOV	R4,#FTYPE	;AND THE TYPE
 2397:	  0A71	71 3A			ACALL	T_X_S		;SAVE IT
 2398:					;
 2399:	  0A73	D1 B9		SF3:	ACALL	T_DP		;GET THE TEXT POINTER
 2400:	  0A75	01 17			AJMP	ILOOP		;CONTINUE TO PROCESS
 2401:					;
 2402:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 59



 Line  I  Addr  Code            Source

 2403:					;**************************************************************
 2404:					;
 2405:					; The statement action routines - PUSH and POP
 2406:					;
 2407:					;**************************************************************
 2408:					;
 2409:	  0A77	F1 44		SPUSH:	ACALL	EXPRB		;PUT EXPRESSION ON STACK
 2410:	  0A79	D1 C7			ACALL	C_TST		;SEE IF MORE TO DO
 2411:	  0A7B	50 FA			JNC	SPUSH		;IF A COMMA PUSH ANOTHER
 2412:	  0A7D	22			RET
 2413:					;
 2414:					;
 2415:	  0A7E	F1 02		SPOP:	ACALL	VAR_ER		;GET VARIABLE
 2416:	  0A80	F1 D2			ACALL	XPOP		;FLIP THE REGISTERS FOR POPAS
 2417:	  0A82	D1 C7			ACALL	C_TST		;SEE IF MORE TO DO
 2418:	  0A84	50 F8			JNC	SPOP
 2419:					;
 2420:	  0A86	22			RET
 2421:					;
 2422:					;***************************************************************
 2423:					;
 2424:					; The statement action routine - IF
 2425:					;
 2426:					;***************************************************************
 2427:					;
 2428:	  0A87	51 C8		SIF:	ACALL	RTST		;EVALUATE THE EXPRESSION
 2429:	  0A89	F9			MOV	R1,A		;SAVE THE RESULT
 2430:	  0A8A	D1 CE			ACALL	GC		;GET THE CHARACTER AFTER EXPR
 2431:	  0A8C	B4 A5 02		CJNE	A,#T_THEN,$+5	;SEE IF THEN TOKEN
 2432:	  0A8F	D1 D8			ACALL	GCI1		;WASTE THEN TOKEN
 2433:	  0A91	B9 00 0B		CJNE	R1,#0,T_F1	;CHECK R_OP RESULT
 2434:					;
 2435:	  0A94	7F A8		E_FIND:	MOV	R7,#T_ELSE	;FIND ELSE TOKEN
 2436:	  0A96	D1 EF			ACALL	FINDC
 2437:	  0A98	60 EC			JZ	SIF-1		;EXIT IF A CR
 2438:	  0A9A	D1 D8			ACALL	GCI1		;BUMP PAST TOKEN
 2439:	  0A9C	B4 A8 F5		CJNE	A,#T_ELSE,E_FIND;WASTE IF NO ELSE
 2440:					;
 2441:	  0A9F	F1 36		T_F1:	ACALL	INTGER		;SEE IF NUMBER
 2442:	  0AA1	50 56			JNC	D_L1		;EXECUTE LINE NUMBER
 2443:	  0AA3	01 F9			AJMP	ISTAT		;EXECUTE STATEMENT IN NOT
 2444:					;
 2445:	  0AA5	E0		B_C:	MOVX	A,@DPTR
 2446:	  0AA6	14			DEC	A
 2447:	  0AA7	20 E7 2E		JB	ACC.7,FL3-5
 2448:	  0AAA	22			RET
 2449:					;
 2450:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 60



 Line  I  Addr  Code            Source

 2451:					;***************************************************************
 2452:					;
 2453:					; The statement action routine - GOTO
 2454:					;
 2455:					;***************************************************************
 2456:					;
 2457:	  0AAB	51 F3		SGOTO:	ACALL	RLINE		;R2:R0 AND DPTR GET INTGER
 2458:					;
 2459:	  0AAD	D1 B9		SGT1:	ACALL	T_DP		;TEXT POINTER GETS DPTR
 2460:					;
 2461:	  0AAF	10 25 08		JBC	RETBIT,SGT2	;SEE IF RETI EXECUTED
 2462:					;
 2463:	  0AB2	30 15 03		JNB	LINEB,$+6	;SEE IF A LINE WAS EDITED
 2464:	  0AB5	12 06 5A		LCALL	RCLEAR-2	;CLEAR THE MEMORY IF SET
 2465:	  0AB8	01 15			AJMP	ILOOP-2		;CLEAR DIRF AND LOOP
 2466:					;
 2467:	  0ABA	10 14 05	SGT2:	JBC	OTI,$+8		;SEE IF TIMER INTERRUPT
 2468:	  0ABD	53 22 BD		ANL	34,#10111101B	;CLEAR INTERRUPTS
 2469:	  0AC0	01 17			AJMP	ILOOP		;EXECUTE
 2470:	  0AC2	A2 2B			MOV	C,ISAV
 2471:	  0AC4	92 11			MOV	INPROG,C
 2472:	  0AC6	01 17			AJMP	ILOOP		;RESTORE INTERRUPTS AND RET
 2473:					;
 2474:					;
 2475:					;*************************************************************
 2476:					;
 2477:	  0AC8			RTST:	; Test for ZERO
 2478:					;
 2479:					;*************************************************************
 2480:					;
 2481:	  0AC8	F1 44			ACALL	EXPRB		;EVALUATE EXPRESSION
 2482:	  0ACA	12 12 38		CALL	INC_ASTKA	;BUMP ARG STACK
 2483:	  0ACD	60 02			JZ	$+4		;EXIT WITH ZERO OR 0FFH
 2484:	  0ACF	74 FF			MOV	A,#0FFH
 2485:	  0AD1	22			RET
 2486:					;
 2487:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 61



 Line  I  Addr  Code            Source

 2488:					;
 2489:					;**************************************************************
 2490:					;
 2491:					; GLN - get the line number in R2:R0, return in DPTR
 2492:					;
 2493:					;**************************************************************
 2494:					;
 2495:	  0AD2	D1 9C		GLN:	ACALL	DP_B		;GET THE BEGINNING ADDRESS
 2496:					;
 2497:	  0AD4	E0		FL1:	MOVX	A,@DPTR		;GET THE LENGTH
 2498:	  0AD5	FF			MOV	R7,A		;SAVE THE LENGTH
 2499:	  0AD6	DF 05			DJNZ	R7,FL3		;SEE IF END OF FILE
 2500:					;
 2501:	  0AD8	90 1F B5		MOV	DPTR,#E10X	;NO LINE NUMBER
 2502:	  0ADB	81 0F			AJMP	EK		;HANDLE THE ERROR
 2503:					;
 2504:	  0ADD	20 E7 F8	FL3:	JB	ACC.7,$-5	;CHECK FOR BIT 7
 2505:	  0AE0	A3			INC	DPTR		;POINT AT HIGH BYTE
 2506:	  0AE1	E0			MOVX	A,@DPTR		;GET HIGH BYTE
 2507:	  0AE2	B5 02 08		CJNE	A,R2B0,FL2	;SEE IF MATCH
 2508:	  0AE5	A3			INC	DPTR		;BUMP TO LOW BYTE
 2509:	  0AE6	1F			DEC	R7		;ADJUST AGAIN
 2510:	  0AE7	E0			MOVX	A,@DPTR		;GET THE LOW BYTE
 2511:	  0AE8	B5 00 02		CJNE	A,R0B0,FL2	;SEE IF LOW BYTE MATCH
 2512:	  0AEB	A3			INC	DPTR		;POINT AT FIRST CHARACTER
 2513:	  0AEC	22			RET			;FOUND IT
 2514:					;
 2515:	  0AED	EF		FL2:	MOV	A,R7		;GET THE LENGTH COUNTER
 2516:	  0AEE	12 05 D6		CALL	ADDPTR		;ADD A TO DATA POINTER
 2517:	  0AF1	80 E1			SJMP	FL1		;LOOP
 2518:					;
 2519:					;
 2520:					;*************************************************************
 2521:					;
 2522:					;RLINE - Read in ASCII string, get line, and clean it up
 2523:					;
 2524:					;*************************************************************
 2525:					;
 2526:	  0AF3	F1 31		RLINE:	ACALL	INTERR		;GET THE INTEGER
 2527:					;
 2528:	  0AF5	51 D2		RL1:	ACALL	GLN
 2529:	  0AF7	E1 18			AJMP	CLN_UP
 2530:					;
 2531:					;
 2532:	  0AF9	51 D2		D_L1:	ACALL	GLN		;GET THE LINE
 2533:	  0AFB	41 AD			AJMP	SGT1		;EXECUTE THE LINE
 2534:					;
 2535:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 62



 Line  I  Addr  Code            Source

 2536:					;***************************************************************
 2537:					;
 2538:					; The statement action routines WHILE and UNTIL
 2539:					;
 2540:					;***************************************************************
 2541:					;
 2542:	  0AFD	51 C8		SWHILE:	ACALL	RTST		;EVALUATE RELATIONAL EXPRESSION
 2543:	  0AFF	F4			CPL	A
 2544:	  0B00	80 02			SJMP	S_WU
 2545:					;
 2546:	  0B02	51 C8		SUNTIL:	ACALL	RTST		;EVALUATE RELATIONAL EXPRESSION
 2547:					;
 2548:	  0B04	7C 03		S_WU:	MOV	R4,#DTYPE	;DO EXPECTED
 2549:	  0B06	FD			MOV	R5,A		;SAVE R_OP RESULT
 2550:	  0B07	80 0C			SJMP	SR0		;GO PROCESS
 2551:					;
 2552:					;
 2553:					;***************************************************************
 2554:					;
 2555:	  0B09			CNULL:	; The Command Action Routine - NULL
 2556:					;
 2557:					;***************************************************************
 2558:					;
 2559:	  0B09	F1 31			ACALL	INTERR		;GET AN INTEGER FOLLOWING NULL
 2560:	  0B0B	88 15			MOV	NULLCT,R0	;SAVE THE NULLCOUNT
 2561:	  0B0D	01 59			AJMP	CMNDLK		;JUMP TO COMMAND MODE
 2562:					;
 2563:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 63



 Line  I  Addr  Code            Source

 2564:					;***************************************************************
 2565:					;
 2566:					; The statement action routine - RETI
 2567:					;
 2568:					;***************************************************************
 2569:					;
 2570:	  0B0F	D2 25		SRETI:	SETB	RETBIT		;SAYS THAT RETI HAS BEEN EXECUTED
 2571:					;
 2572:					;***************************************************************
 2573:					;
 2574:					; The statement action routine - RETURN
 2575:					;
 2576:					;***************************************************************
 2577:					;
 2578:	  0B11	7C 02		SRETRN:	MOV	R4,#GTYPE	;MAKE SURE OF GOSUB
 2579:	  0B13	7D 55			MOV	R5,#55H		;TYPE RETURN TYPE
 2580:					;
 2581:	  0B15	71 4C		SR0:	ACALL	CSETUP		;SET UP CONTROL STACK
 2582:	  0B17	E2			MOVX	A,@R0		;GET RETURN TEXT ADDRESS
 2583:	  0B18	F5 83			MOV	DPH,A
 2584:	  0B1A	08			INC	R0
 2585:	  0B1B	E2			MOVX	A,@R0
 2586:	  0B1C	F5 82			MOV	DPL,A
 2587:	  0B1E	08			INC	R0		;POP CONTROL STACK
 2588:	  0B1F	E0			MOVX	A,@DPTR		;SEE IF GOSUB WAS THE LAST STATEMENT
 2589:	  0B20	B4 01 02		CJNE	A,#EOF,$+5
 2590:	  0B23	01 59			AJMP	CMNDLK
 2591:	  0B25	ED			MOV	A,R5		;GET TYPE
 2592:	  0B26	60 85			JZ	SGT1		;EXIT IF ZERO
 2593:	  0B28	88 11			MOV	CSTKA,R0	;POP THE STACK
 2594:	  0B2A	F4			CPL	A		;OPTION TEST, 00H, 55H, 0FFH, NOW 55H
 2595:	  0B2B	70 80			JNZ	SGT1		;MUST BE GOSUB
 2596:	  0B2D	22			RET			;NORMAL FALL THRU EXIT FOR NO MATCH
 2597:					;
 2598:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 64



 Line  I  Addr  Code            Source

 2599:					;***************************************************************
 2600:					;
 2601:					; The statement action routine - GOSUB
 2602:					;
 2603:					;***************************************************************
 2604:					;
 2605:	  0B2E	51 F3		SGOSUB:	ACALL	RLINE		;NEW TXA IN DPTR
 2606:					;
 2607:	  0B30	7C 02		SGS0:	MOV	R4,#GTYPE
 2608:	  0B32	71 36			ACALL	SGS1		;SET EVERYTHING UP
 2609:	  0B34	41 73			AJMP	SF3		;EXIT
 2610:					;
 2611:	  0B36	74 FD		SGS1:	MOV	A,#-3		;ALLOCATE 3 BYTES ON CONTROL STACK
 2612:	  0B38	71 B2			ACALL	PUSHCS
 2613:					;
 2614:	  0B3A	75 A0 00	T_X_S:	MOV	P2,#CSTKAH	;SET UP PORT FOR CONTROL STACK
 2615:	  0B3D	E5 08			MOV	A,TXAL		;GET RETURN ADDRESS AND SAVE IT
 2616:	  0B3F	F2			MOVX	@R0,A
 2617:	  0B40	18			DEC	R0
 2618:	  0B41	E5 0A			MOV	A,TXAH
 2619:	  0B43	F2			MOVX	@R0,A
 2620:	  0B44	18			DEC	R0
 2621:	  0B45	EC			MOV	A,R4		;GET TYPE
 2622:	  0B46	F2			MOVX	@R0,A		;SAVE TYPE
 2623:	  0B47	22			RET			;EXIT
 2624:					;
 2625:					;
 2626:	  0B48	74 03		CS1:	MOV	A,#3		;POP 3 BYTES
 2627:	  0B4A	71 B2			ACALL	PUSHCS
 2628:					;
 2629:	  0B4C	A8 11		CSETUP:	MOV	R0,CSTKA	;GET CONTROL STACK
 2630:	  0B4E	75 A0 00		MOV	P2,#CSTKAH
 2631:	  0B51	E2			MOVX	A,@R0		;GET BYTE
 2632:	  0B52	B5 04 02		CJNE	A,R4B0,$+5	;SEE IF TYPE MATCH
 2633:	  0B55	08			INC	R0
 2634:	  0B56	22			RET
 2635:	  0B57	60 69			JZ	E4XX		;EXIT IF STACK UNDERFLOW
 2636:	  0B59	B4 01 EC		CJNE	A,#FTYPE,CS1	;SEE IF FOR TYPE
 2637:	  0B5C	71 B0			ACALL	PUSHCS-2	;WASTE THE FOR TYPE
 2638:	  0B5E	80 EC			SJMP	CSETUP		;LOOP
 2639:					;
 2640:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 65



 Line  I  Addr  Code            Source

 2641:					;***************************************************************
 2642:					;
 2643:					; The statement action routine - NEXT
 2644:					;
 2645:					;***************************************************************
 2646:					;
 2647:	  0B60	7C 01		SNEXT:	MOV	R4,#FTYPE	;FOR TYPE
 2648:	  0B62	71 4C			ACALL	CSETUP		;SETUP CONTROL STACK
 2649:	  0B64	88 0F			MOV	TEMP5,R0	;SAVE CONTROL VARIABLE ADDRESS
 2650:	  0B66	79 0B			MOV	R1,#TEMP1	;SAVE VAR + RETURN IN TEMP1-4
 2651:					;
 2652:	  0B68	E2		XXI:	MOVX	A,@R0		;LOOP UNTIL DONE
 2653:	  0B69	F7			MOV	@R1,A
 2654:	  0B6A	09			INC	R1
 2655:	  0B6B	08			INC	R0
 2656:	  0B6C	B9 0F F9		CJNE	R1,#TEMP5,XXI
 2657:					;
 2658:	  0B6F	B1 66			ACALL	VAR		;SEE IF THE USER HAS A VARIABLE
 2659:	  0B71	50 04			JNC	$+6
 2660:	  0B73	AA 0B			MOV	R2,TEMP1
 2661:	  0B75	A8 0C			MOV	R0,TEMP2
 2662:	  0B77	EA			MOV	A,R2		;SEE IF VAR'S AGREE
 2663:	  0B78	B5 0B 47		CJNE	A,TEMP1,E4XX
 2664:	  0B7B	E8			MOV	A,R0
 2665:	  0B7C	B5 0C 43		CJNE	A,TEMP2,E4XX
 2666:	  0B7F	F1 DE			ACALL	PUSHAS		;PUT CONTROL VARIABLE ON STACK
 2667:	  0B81	74 0E			MOV	A,#FPSIZ+FPSIZ+2;COMPUTE ADDRESS TO STEP VALUE SIGN
 2668:	  0B83	25 0F			ADD	A,TEMP5		;ADD IT TO BASE OF STACK
 2669:	  0B85	F8			MOV	R0,A		;SAVE IN R0
 2670:	  0B86	7A 00			MOV	R2,#CSTKAH	;SET UP TO PUSH STEP VALUE
 2671:	  0B88	8A A0			MOV	P2,R2		;SET UP PORT
 2672:	  0B8A	E2			MOVX	A,@R0		;GET SIGN
 2673:	  0B8B	08			INC	R0		;BACK TO EXPONENT
 2674:	  0B8C	C0 E0			PUSH	ACC		;SAVE SIGN OF STEP
 2675:	  0B8E	F1 DE			ACALL	PUSHAS		;PUT STEP VALUE ON STACK
 2676:	  0B90	C0 00			PUSH	R0B0		;SAVE LIMIT VALUE LOCATION
 2677:	  0B92	12 17 36		CALL	AADD		;ADD STEP VALUE TO VARIABLE
 2678:	  0B95	12 14 15		CALL	CSTAKA		;COPY STACK
 2679:	  0B98	AB 0B			MOV	R3,TEMP1	;GET CONTROL VARIABLE
 2680:	  0B9A	A9 0C			MOV	R1,TEMP2
 2681:	  0B9C	F1 D4			ACALL	POPAS		;SAVE THE RESULT
 2682:	  0B9E	7A 00			MOV	R2,#CSTKAH	;RESTORE LIMIT LOCATION
 2683:	  0BA0	D0 00			POP	R0B0
 2684:	  0BA2	F1 DE			ACALL	PUSHAS		;PUT LIMIT ON STACK
 2685:	  0BA4	12 19 97		CALL	FP_BASE+4	;DO THE COMPARE
 2686:	  0BA7	D0 E0			POP	ACC		;GET LIMIT SIGN BACK
 2687:	  0BA9	60 01			JZ	$+3		;IF SIGN NEGATIVE, TEST "BACKWARDS"
 2688:	  0BAB	B3			CPL	C
 2689:	  0BAC	72 D5			ORL	C,F0		;SEE IF EQUAL
 2690:	  0BAE	40 17			JC	N4		;STILL SMALLER THAN LIMIT?
 2691:	  0BB0	74 11			MOV	A,#FSIZE	;REMOVE CONTROL STACK ENTRY
 2692:					;
 2693:					; Fall thru to PUSHCS
 2694:					;
 2695:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 66



 Line  I  Addr  Code            Source

 2696:					;***************************************************************
 2697:					;
 2698:					; PUSHCS - push frame onto control stack
 2699:					;          acc has - number of bytes, also test for overflow
 2700:					;
 2701:					;***************************************************************
 2702:					;
 2703:	  0BB2	25 11		PUSHCS:	ADD	A,CSTKA		;BUMP CONTROL STACK
 2704:	  0BB4	B4 61 00		CJNE	A,#CONVT+17,$+3	;SEE IF OVERFLOWED
 2705:	  0BB7	40 09			JC	E4XX		;EXIT IF STACK OVERFLOW
 2706:	  0BB9	C5 11			XCH	A,CSTKA		;STORE NEW CONTROL STACK VALUE, GET OLD
 2707:	  0BBB	14			DEC	A		;BUMP OLD VALUE
 2708:	  0BBC	F8			MOV	R0,A		;PUT OLD-1 IN R0
 2709:					;
 2710:	  0BBD	22			RET			;EXIT
 2711:					;
 2712:	  0BBE	F1 18		CSC:	ACALL	CLN_UP		;FINISH OFF THE LINE
 2713:	  0BC0	50 FB			JNC	CSC-1		;EXIT IF NO TERMINATOR
 2714:					;
 2715:	  0BC2	90 03 7F	E4XX:	MOV	DPTR,#EXC	;CONTROL STACK ERROR
 2716:	  0BC5	81 0F			AJMP	EK		;STACK ERROR
 2717:					;
 2718:	  0BC7	85 0D 0A	N4:	MOV	TXAH,TEMP3	;GET TEXT POINTER
 2719:	  0BCA	85 0E 08		MOV	TXAL,TEMP4
 2720:	  0BCD	01 17			AJMP	ILOOP		;EXIT
 2721:					;
 2722:					;***************************************************************
 2723:					;
 2724:					; The statement action routine - RESTORE
 2725:					;
 2726:					;***************************************************************
 2727:					;
 2728:	  0BCF	71 D7		SRESTR:	ACALL	X_TR		;SWAP POINTERS
 2729:	  0BD1	D1 9C			ACALL	DP_B		;GET THE STARTING ADDRESS
 2730:	  0BD3	D1 B9			ACALL	T_DP		;PUT STARTING ADDRESS IN TEXT POINTER
 2731:	  0BD5	F1 24			ACALL	B_TXA		;BUMP TXA
 2732:					;
 2733:					; Fall thru
 2734:					;
 2735:	  0BD7			X_TR:	;swap txa and rtxa
 2736:					;
 2737:	  0BD7	C5 0A			XCH	A,TXAH
 2738:	  0BD9	C5 12			XCH	A,RTXAH
 2739:	  0BDB	C5 0A			XCH	A,TXAH
 2740:	  0BDD	C5 08			XCH	A,TXAL
 2741:	  0BDF	C5 10			XCH	A,RTXAL
 2742:	  0BE1	C5 08			XCH	A,TXAL
 2743:	  0BE3	22			RET			;EXIT
 2744:					;
 2745:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 67



 Line  I  Addr  Code            Source

 2746:					;***************************************************************
 2747:					;
 2748:					; The statement action routine - READ
 2749:					;
 2750:					;***************************************************************
 2751:					;
 2752:	  0BE4	71 D7		SREAD:	ACALL	X_TR		;SWAP POINTERS
 2753:					;
 2754:	  0BE6	D1 C7		SRD0:	ACALL	C_TST		;CHECK FOR COMMA
 2755:	  0BE8	40 16			JC	SRD4		;SEE WHAT IT IS
 2756:					;
 2757:	  0BEA	F1 44		SRD:	ACALL	EXPRB		;EVALUATE THE EXPRESSION
 2758:	  0BEC	D1 CE			ACALL	GC		;GET THE CHARACTER AFTER EXPRESSION
 2759:	  0BEE	B4 2C 02		CJNE	A,#',',SRD1	;SEE IF MORE DATA
 2760:	  0BF1	80 02			SJMP	SRD2		;BYBASS CLEAN UP IF A COMMA
 2761:					;
 2762:	  0BF3	F1 18		SRD1:	ACALL	CLN_UP		;FINISH OFF THE LINE, IF AT END
 2763:					;
 2764:	  0BF5	71 D7		SRD2:	ACALL	X_TR		;RESTORE POINTERS
 2765:	  0BF7	F1 02			ACALL	VAR_ER		;GET VARIABLE ADDRESS
 2766:	  0BF9	F1 D2			ACALL	XPOP		;FLIP THE REGISTERS FOR POPAS
 2767:	  0BFB	D1 C7			ACALL	C_TST		;SEE IF A COMMA
 2768:	  0BFD	50 E5			JNC	SREAD		;READ AGAIN IF A COMMA
 2769:	  0BFF	22			RET			;EXIT IF NOT
 2770:					;
 2771:	  0C00	B4 9C 04	SRD4:	CJNE	A,#T_DATA,SRD5	;SEE IF DATA
 2772:	  0C03	D1 D8			ACALL	GCI1		;BUMP POINTER
 2773:	  0C05	80 E3			SJMP	SRD
 2774:					;
 2775:	  0C07	B4 01 08	SRD5:	CJNE	A,#EOF,SRD6	;SEE IF YOU BLEW IT
 2776:	  0C0A	71 D7			ACALL	X_TR		;GET THE TEXT POINTER BACK
 2777:	  0C0C	90 1F 81		MOV	DPTR,#E14X	;READ ERROR
 2778:					;
 2779:	  0C0F	02 18 87	EK:	LJMP	ERROR
 2780:					;
 2781:	  0C12	D1 ED		SRD6:	ACALL	FINDCR		;WASTE THIS LINE
 2782:	  0C14	F1 18			ACALL	CLN_UP		;CLEAN IT UP
 2783:	  0C16	40 F2			JC	SRD5+3		;ERROR IF AT END
 2784:	  0C18	80 CC			SJMP	SRD0
 2785:					;
 2786:	  0C1A	D1 CE		NUMC:	ACALL	GC		;GET A CHARACTER
 2787:	  0C1C	B4 23 04		CJNE	A,#'#',NUMC1	;SEE IF A #
 2788:	  0C1F	D2 1B			SETB	COB		;VALID LINE PRINT
 2789:	  0C21	C1 CC			AJMP	IGC		;BUMP THE TEXT POINTER
 2790:					;
 2791:	  0C23	B4 40 D9	NUMC1:	CJNE	A,#'@',SRD4-1	;EXIT IF NO GOOD
 2792:	  0C26	D2 19			SETB	LPB
 2793:	  0C28	C1 CC			AJMP	IGC
 2794:					;
 2795:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 68



 Line  I  Addr  Code            Source

 2796:					;***************************************************************
 2797:					;
 2798:					; The statement action routine - PRINT
 2799:					;
 2800:					;***************************************************************
 2801:					;
 2802:	  0C2A	D2 36		SPH0:	SETB	ZSURP		;NO ZEROS
 2803:					;
 2804:	  0C2C	D2 37		SPH1:	SETB	HMODE		;HEX MODE
 2805:					;
 2806:	  0C2E	91 1A		SPRINT:	ACALL	NUMC		;TEST FOR A LINE PRINT
 2807:	  0C30	91 39			ACALL	$+9		;PROCEED
 2808:	  0C32	53 23 F5		ANL	35,#11110101B	;CLEAR COB AND LPB
 2809:	  0C35	53 26 3F		ANL	38,#00111111B	;NO HEX MODE
 2810:					;
 2811:	  0C38	22			RET
 2812:					;
 2813:	  0C39	D1 E2			ACALL	DELTST		;CHECK FOR A DELIMITER
 2814:	  0C3B	40 07			JC	SP1
 2815:					;
 2816:	  0C3D	02 06 9D	SP0:	JMP	CRLF		;EXIT WITH A CR IF SO
 2817:					;
 2818:	  0C40	D1 C7		SP2:	ACALL	C_TST		;CHECK FOR A COMMA
 2819:	  0C42	40 F9			JC	SP0		;EXIT IF NO COMMA
 2820:					;
 2821:	  0C44	D1 AA		SP1:	ACALL	CPS		;SEE IF A STRING TO PRINT
 2822:	  0C46	50 F8			JNC	SP2		;IF A STRING, CHECK FOR A COMMA
 2823:					;
 2824:	  0C48	B4 A4 08	SP4:	CJNE	A,#T_TAB,SP6
 2825:	  0C4B	D1 96			ACALL	I_PI		;ALWAYS CLEARS CARRY
 2826:	  0C4D	95 16			SUBB	A,PHEAD		;TAKE DELTA BETWEEN TAB AND PHEAD
 2827:	  0C4F	40 EF			JC	SP2		;EXIT IF PHEAD > TAB
 2828:	  0C51	80 05			SJMP	SP7		;OUTPUT SPACES
 2829:					;
 2830:	  0C53	B4 A9 0A	SP6:	CJNE	A,#T_SPC,SM
 2831:	  0C56	D1 96			ACALL	I_PI		;SET UP PAREN VALUE
 2832:					;
 2833:	  0C58	60 E6		SP7:	JZ	SP2
 2834:	  0C5A	12 07 07		LCALL	STEROT		;OUTPUT A SPACE
 2835:	  0C5D	14			DEC	A		;DECREMENT COUNTER
 2836:	  0C5E	80 F8			SJMP	SP7		;LOOP
 2837:					;
 2838:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 69



 Line  I  Addr  Code            Source

 2839:	  0C60	B4 D3 13	SM:	CJNE	A,#T_CHR,SP8
 2840:	  0C63	D1 CC			ACALL	IGC
 2841:	  0C65	B4 24 06		CJNE	A,#'$',$+9
 2842:	  0C68	F1 FA			ACALL	CNX		;PUT THE CHARACTER ON THE STACK
 2843:	  0C6A	D1 91			ACALL	IFIXL		;PUT THE CHARACTER IN R1
 2844:	  0C6C	80 04			SJMP	$+6
 2845:	  0C6E	D1 8F			ACALL	ONE		;EVALUATE THE EXPRESSION, PUT IN R3:R1
 2846:	  0C70	91 E4			ACALL	ERPAR
 2847:	  0C72	AD 01			MOV	R5,R1B0		;BYTE TO OUTPUT
 2848:	  0C74	80 07			SJMP	SQ
 2849:					;
 2850:	  0C76	B4 AA 09	SP8:	CJNE	A,#T_CR,SX
 2851:	  0C79	D1 D8			ACALL	GCI1		;EAT THE TOKEN
 2852:	  0C7B	7D 0D			MOV	R5,#CR
 2853:					;
 2854:	  0C7D	12 07 09	SQ:	CALL	TEROT
 2855:	  0C80	80 BE			SJMP	SP2		;OUTPUT A CR AND DO IT AGAIN
 2856:					;
 2857:	  0C82	B4 D2 53	SX:	CJNE	A,#T_USE,SP9	;USING TOKEN
 2858:	  0C85	D1 CC			ACALL	IGC		;GE THE CHARACTER AFTER THE USING TOKEN
 2859:	  0C87	B4 46 16		CJNE	A,#'F',U4	;SEE IF FLOATING
 2860:	  0C8A	75 17 F0		MOV	FORMAT,#0F0H	;SET FLOATING
 2861:	  0C8D	D1 CC			ACALL	IGC		;BUMP THE POINTER AND GET THE CHARACTER
 2862:	  0C8F	D1 D8			ACALL	GCI1		;BUMP IT AGAIN
 2863:	  0C91	54 0F			ANL	A,#0FH		;STRIP OFF ASCII BIAS
 2864:	  0C93	60 07			JZ	U3		;EXIT IF ZERO
 2865:	  0C95	B4 03 00		CJNE	A,#3,$+3	;SEE IF AT LEAST A THREE
 2866:	  0C98	50 02			JNC	U3		;FORCE A THREE IF NOT A THREE
 2867:	  0C9A	74 03			MOV	A,#3
 2868:					;
 2869:	  0C9C	42 17		U3:	ORL	FORMAT,A	;PUT DIGIT IN FORMAT
 2870:	  0C9E	80 2A			SJMP	U8		;CLEAN UP END
 2871:					;
 2872:	  0CA0	B4 30 07	U4:	CJNE	A,#'0',U5
 2873:	  0CA3	75 17 00		MOV	FORMAT,#0	;FREE FORMAT
 2874:	  0CA6	D1 D8			ACALL	GCI1		;BUMP THE POINTER
 2875:	  0CA8	80 20			SJMP	U8
 2876:					;
 2877:	  0CAA	B4 23 1D	U5:	CJNE	A,#'#',U8	;SEE IF INTGER FORMAT
 2878:	  0CAD	91 CE			ACALL	U6
 2879:	  0CAF	8F 17			MOV	FORMAT,R7	;SAVE THE FORMAT
 2880:	  0CB1	B4 2E 11		CJNE	A,#'.',U8A	;SEE IF TERMINATOR WAS RADIX
 2881:	  0CB4	D1 CC			ACALL	IGC		;BUMP PAST .
 2882:	  0CB6	91 CE			ACALL	U6		;LOOP AGAIN
 2883:	  0CB8	EF			MOV	A,R7		;GET COUNT
 2884:	  0CB9	25 17			ADD	A,FORMAT	;SEE IF TOO BIG
 2885:	  0CBB	24 F7			ADD	A,#0F7H
 2886:	  0CBD	50 02			JNC	U5A
 2887:					;
 2888:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 70



 Line  I  Addr  Code            Source

 2889:	  0CBF	21 39		SE0:	AJMP	INTERX		;ERROR, BAD SYNTAX
 2890:					;
 2891:	  0CC1	EF		U5A:	MOV	A,R7		;GET THE COUNT BACK
 2892:	  0CC2	C4			SWAP	A		;ADJUST
 2893:	  0CC3	42 17			ORL	FORMAT,A	;GET THE COUNT
 2894:					;
 2895:	  0CC5	E5 17		U8A:	MOV	A,FORMAT
 2896:					;
 2897:	  0CC7	C4		U8B:	SWAP	A		;GET THE FORMAT RIGHT
 2898:	  0CC8	F5 17			MOV	FORMAT,A
 2899:					;
 2900:	  0CCA	91 E4		U8:	ACALL	ERPAR
 2901:	  0CCC	81 40			AJMP	SP2		;DONE
 2902:					;
 2903:	  0CCE	7F 00		U6:	MOV	R7,#0		;SET COUNTER
 2904:					;
 2905:	  0CD0	B4 23 0C	U7:	CJNE	A,#'#',SP9A	;EXIT IF NOT A #
 2906:	  0CD3	0F			INC	R7		;BUMP COUNTER
 2907:	  0CD4	D1 CC			ACALL	IGC		;GET THE NEXT CHARACTER
 2908:	  0CD6	80 F8			SJMP	U7		;LOOP
 2909:					;
 2910:	  0CD8	D1 E4		SP9:	ACALL	DELTST+2	;CHECK FOR DELIMITER
 2911:	  0CDA	50 03			JNC	SP9A		;EXIT IF A DELIMITER
 2912:					;
 2913:	  0CDC	B4 A8 34		CJNE	A,#T_ELSE,SS
 2914:					;
 2915:	  0CDF	22		SP9A:	RET			;EXIT IF ELSE TOKEN
 2916:					;
 2917:					;**************************************************************
 2918:					;
 2919:					; P_E - Evaluate an expression in parens ( )
 2920:					;
 2921:					;**************************************************************
 2922:					;
 2923:	  0CE0	7F E0		P_E:	MOV	R7,#T_LPAR
 2924:	  0CE2	F1 42			ACALL	WE
 2925:					;
 2926:	  0CE4	7F 29		ERPAR:	MOV	R7,#')'		;EAT A RIGHT PAREN
 2927:					;
 2928:	  0CE6	D1 D6		EATC:	ACALL	GCI		;GET THE CHARACTER
 2929:	  0CE8	B5 07 D4		CJNE	A,R7B0,SE0	;ERROR IF NOT THE SAME
 2930:	  0CEB	22			RET
 2931:					;
 2932:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 71



 Line  I  Addr  Code            Source

 2933:					;***************************************************************
 2934:					;
 2935:	  0CEC			S_ON:	; ON Statement
 2936:					;
 2937:					;***************************************************************
 2938:					;
 2939:	  0CEC	D1 8F			ACALL	ONE		;GET THE EXPRESSION
 2940:	  0CEE	D1 D6			ACALL	GCI		;GET THE NEXT CHARACTER
 2941:	  0CF0	B4 83 04		CJNE	A,#T_GOTO,C0
 2942:	  0CF3	91 FE			ACALL	C1		;EAT THE COMMAS
 2943:	  0CF5	41 73			AJMP	SF3		;DO GOTO
 2944:					;
 2945:	  0CF7	B4 9F C5	C0:	CJNE	A,#T_GOSB,SE0
 2946:	  0CFA	91 FE			ACALL	C1
 2947:	  0CFC	61 30			AJMP	SGS0		;DO GOSUB
 2948:					;
 2949:	  0CFE	B9 00 06	C1:	CJNE	R1,#0,C2
 2950:	  0D01	F1 31			ACALL	INTERR		;GET THE LINE NUMBER
 2951:	  0D03	D1 ED			ACALL	FINDCR
 2952:	  0D05	41 F5			AJMP	RL1		;FINISH UP THIS LINE
 2953:					;
 2954:	  0D07	7F 2C		C2:	MOV	R7,#','
 2955:	  0D09	D1 EF			ACALL	FINDC
 2956:	  0D0B	B4 2C B1		CJNE	A,#',',SE0	;ERROR IF NOT A COMMA
 2957:	  0D0E	19			DEC	R1
 2958:	  0D0F	D1 D8			ACALL	GCI1		;BUMP PAST COMMA
 2959:	  0D11	80 EB			SJMP	C1
 2960:					;
 2961:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 72



 Line  I  Addr  Code            Source

 2962:					;
 2963:	  0D13	D1 C0		SS:	ACALL	S_C		;SEE IF A STRING
 2964:	  0D15	40 05			JC	SA		;NO STRING IF CARRY IS SET
 2965:	  0D17	12 06 B7		LCALL	UPRNT		;PUT POINTER IN DPTR
 2966:	  0D1A	81 40			AJMP	SP2		;SEE IF MORE
 2967:					;
 2968:	  0D1C	F1 44		SA:	ACALL	EXPRB		;MUST BE AN EXPRESSION
 2969:	  0D1E	74 48			MOV	A,#72
 2970:	  0D20	B5 16 00		CJNE	A,PHEAD,$+3	;CHECK PHEAD POSITION
 2971:	  0D23	50 02			JNC	$+4
 2972:	  0D25	91 3D			ACALL	SP0		;FORCE A CRLF
 2973:	  0D27	30 37 14		JNB	HMODE,S13	;HEX MODE?
 2974:	  0D2A	12 11 EB		CALL	FCMP		;SEE IF TOS IS < 0FFFH
 2975:	  0D2D	40 0F			JC	S13		;EXIT IF GREATER
 2976:	  0D2F	12 13 78		CALL	AABS		;GET THE SIGN
 2977:	  0D32	70 07			JNZ	OOPS		;WASTE IF NEGATIVE
 2978:	  0D34	D1 91			ACALL	IFIXL
 2979:	  0D36	12 19 A9		CALL	FP_BASE+22	;PRINT HEXMODE
 2980:	  0D39	81 40			AJMP	SP2
 2981:	  0D3B	12 13 8A	OOPS:	CALL	ANEG		;MAKE IT NEGATIVE
 2982:					;
 2983:	  0D3E	12 19 A1	S13:	CALL	FP_BASE+14	;DO FP OUTPUT
 2984:	  0D41	74 01			MOV	A,#1		;OUTPUT A SPACE
 2985:	  0D43	81 58			AJMP	SP7
 2986:					;
 2987:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 73



 Line  I  Addr  Code            Source

 2988:					;***************************************************************
 2989:					;
 2990:					; ANU -  Get variable name from text - set carry if not found
 2991:					;        if succeeds returns variable in R7:R6
 2992:					;        R6 = 0 if no digit in name
 2993:					;
 2994:					;***************************************************************
 2995:					;
 2996:	  0D45	D1 CC		ANU:	ACALL	IGC		;INCREMENT AND GET CHARACTER
 2997:	  0D47	12 1F ED		LCALL	1FEDH		;CHECK FOR DIGIT
 2998:	  0D4A	40 0C			JC	$+14		;EXIT IF VALID DIGIT
 2999:	  0D4C	B4 5F 01		CJNE	A,#'_',$+4	;SEE IF A _
 3000:	  0D4F	22			RET
 3001:					;
 3002:	  0D50	B4 41 00	AL:	CJNE	A,#'A',$+3	;IS IT AN ASCII A?
 3003:	  0D53	40 04			JC	$+6		;EXIT IF CARRY IS SET
 3004:	  0D55	B4 5B 00		CJNE	A,#'Z'+1,$+3	;IS IT LESS THAN AN ASCII Z
 3005:	  0D58	B3			CPL	C		;FLIP CARRY
 3006:	  0D59	22			RET
 3007:					;
 3008:	  0D5A	30 D5 3E		JNB	F0,VAR2
 3009:					;
 3010:	  0D5D	90 17 56	SD0:	MOV	DPTR,#E6X
 3011:	  0D60	81 0F			AJMP	EK
 3012:					;
 3013:	  0D62	D2 D5		SDIMX:	SETB	F0		;SAYS DOING A DIMENSION
 3014:	  0D64	80 02			SJMP	VAR1
 3015:					;
 3016:	  0D66	C2 D5		VAR:	CLR	F0		;SAYS DOING A VARIABLE
 3017:					;
 3018:	  0D68	D1 CE		VAR1:	ACALL	GC		;GET THE CHARACTER
 3019:	  0D6A	B1 50			ACALL	AL		;CHECK FOR ALPHA
 3020:	  0D6C	50 04			JNC	$+6		;ERROR IF IN DIM
 3021:	  0D6E	20 D5 EC		JB	F0,SD0
 3022:	  0D71	22			RET
 3023:	  0D72	FF			MOV	R7,A		;SAVE ALPHA CHARACTER
 3024:	  0D73	E4			CLR	A		;ZERO IN CASE OF FAILURE
 3025:	  0D74	FD			MOV	R5,A		;SAVE IT
 3026:					;
 3027:	  0D75	FE		VY:	MOV	R6,A
 3028:	  0D76	B1 45			ACALL	ANU		;CHECK FOR ALPHA OR NUMBER
 3029:	  0D78	40 07			JC	VX		;EXIT IF NO ALPHA OR NUM
 3030:					;
 3031:	  0D7A	CF			XCH	A,R7
 3032:	  0D7B	2D			ADD	A,R5		;NUMBER OF CHARACTERS IN ALPHABET
 3033:	  0D7C	CF			XCH	A,R7		;PUT IT BACK
 3034:	  0D7D	7D 1A			MOV	R5,#26		;FOR THE SECOND TIME AROUND
 3035:	  0D7F	80 F4			SJMP	VY
 3036:					;
 3037:	  0D81	C2 15		VX:	CLR	LINEB		;TELL EDITOR A VARIABLE IS DECLARED
 3038:	  0D83	B4 E0 2F		CJNE	A,#T_LPAR,V4	;SEE IF A LEFT PAREN
 3039:					;
 3040:	  0D86	43 06 80		ORL	R6B0,#80H	;SET BIT 7 TO SIGINIFY MATRIX
 3041:	  0D89	12 06 11		CALL	F_VAR		;FIND THE VARIABLE
 3042:	  0D8C	C0 02			PUSH	R2B0		;SAVE THE LOCATION
 3043:	  0D8E	C0 00			PUSH	R0B0

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 74



 Line  I  Addr  Code            Source

 3044:	  0D90	50 C8			JNC	SD0-3		;DEFAULT IF NOT IN TABLE
 3045:	  0D92	20 D5 28		JB	F0,SDI		;NO DEFAULT FOR DIMENSION
 3046:	  0D95	79 0A			MOV	R1,#10
 3047:	  0D97	7B 00			MOV	R3,#0
 3048:	  0D99	B1 CD			ACALL	D_CHK
 3049:					;
 3050:	  0D9B	D1 98		VAR2:	ACALL	PAREN_INT	;EVALUATE INTEGER IN PARENS
 3051:	  0D9D	BB 00 BD		CJNE	R3,#0,SD0	;ERROR IF R3<>0
 3052:	  0DA0	D0 82			POP	DPL		;GET VAR FOR LOOKUP
 3053:	  0DA2	D0 83			POP	DPH
 3054:	  0DA4	E0			MOVX	A,@DPTR		;GET DIMENSION
 3055:	  0DA5	14			DEC	A		;BUMP OFFSET
 3056:	  0DA6	99			SUBB	A,R1		;A MUST BE > R1
 3057:	  0DA7	40 B4			JC	SD0
 3058:	  0DA9	12 05 B8		LCALL	DECDP2		;BUMP POINTER TWICE
 3059:	  0DAC	51 0E			ACALL	VARB		;CALCULATE THE BASE
 3060:					;
 3061:	  0DAE	C9		X3120:	XCH	A,R1		;SWAP R2:R0, R3:R1
 3062:	  0DAF	C8			XCH	A,R0
 3063:	  0DB0	C9			XCH	A,R1
 3064:	  0DB1	CB			XCH	A,R3
 3065:	  0DB2	CA			XCH	A,R2
 3066:	  0DB3	CB			XCH	A,R3
 3067:	  0DB4	22			RET
 3068:					;
 3069:	  0DB5	20 D5 A5	V4:	JB	F0,SD0		;ERROR IF NO LPAR FOR DIM
 3070:	  0DB8	12 06 11		LCALL	F_VAR		;GET SCALAR VARIABLE
 3071:	  0DBB	C3			CLR	C
 3072:	  0DBC	22			RET
 3073:					;
 3074:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 75



 Line  I  Addr  Code            Source

 3075:					;
 3076:	  0DBD	D1 98		SDI:	ACALL	PAREN_INT	;EVALUATE PAREN EXPRESSION
 3077:	  0DBF	BB 00 9B		CJNE	R3,#0,SD0	;ERROR IF NOT ZERO
 3078:	  0DC2	D0 00			POP	R0B0		;SET UP R2:R0
 3079:	  0DC4	D0 02			POP	R2B0
 3080:	  0DC6	B1 CD			ACALL	D_CHK		;DO DIM
 3081:	  0DC8	D1 C7			ACALL	C_TST		;CHECK FOR COMMA
 3082:	  0DCA	50 96			JNC	SDIMX		;LOOP IF COMMA
 3083:	  0DCC	22			RET			;RETURN IF NO COMMA
 3084:					;
 3085:	  0DCD	09		D_CHK:	INC	R1		;BUMP FOR TABLE LOOKUP
 3086:	  0DCE	E9			MOV	A,R1
 3087:	  0DCF	60 8C			JZ	SD0		;ERROR IF 0FFFFH
 3088:	  0DD1	FC			MOV	R4,A		;SAVE FOR LATER
 3089:	  0DD2	90 01 08		MOV	DPTR,#MT_ALL	;GET MATRIX ALLOCATION
 3090:	  0DD5	51 0E			ACALL	VARB		;DO THE CALCULATION
 3091:	  0DD7	AF 83			MOV	R7,DPH		;SAVE MATRIX ALLOCATION
 3092:	  0DD9	AE 82			MOV	R6,DPL
 3093:	  0DDB	90 01 06		MOV	DPTR,#ST_ALL	;SEE IF TOO MUCH MEMORY TAKEN
 3094:	  0DDE	12 15 99		CALL	FUL1		;ST_ALL SHOULD BE > R3:R1
 3095:	  0DE1	90 01 08		MOV	DPTR,#MT_ALL	;SAVE THE NEW MATRIX POINTER
 3096:	  0DE4	12 05 FD		CALL	S31DP
 3097:	  0DE7	88 82			MOV	DPL,R0		;GET VARIABLE ADDRESS
 3098:	  0DE9	8A 83			MOV	DPH,R2
 3099:	  0DEB	EC			MOV	A,R4		;DIMENSION SIZE
 3100:	  0DEC	F0			MOVX	@DPTR,A		;SAVE IT
 3101:	  0DED	12 05 B8		CALL	DECDP2		;SAVE TARGET ADDRESS
 3102:					;
 3103:	  0DF0	EF		R76S:	MOV	A,R7
 3104:	  0DF1	F0			MOVX	@DPTR,A
 3105:	  0DF2	A3			INC	DPTR
 3106:	  0DF3	EE			MOV	A,R6		;ELEMENT SIZE
 3107:	  0DF4	F0			MOVX	@DPTR,A
 3108:	  0DF5	22			RET			;R2:R0 STILL HAS SYMBOL TABLE ADDRESS
 3109:					;
 3110:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 76



 Line  I  Addr  Code            Source

 3111:					;***************************************************************
 3112:					;
 3113:					; The statement action routine - INPUT
 3114:					;
 3115:					;***************************************************************
 3116:					;
 3117:	  0DF6	D1 AA		SINPUT:	ACALL	CPS		;PRINT STRING IF THERE
 3118:					;
 3119:	  0DF8	D1 C7			ACALL	C_TST		;CHECK FOR A COMMA
 3120:	  0DFA	50 07			JNC	IN2A		;NO CRLF
 3121:	  0DFC	91 3D			ACALL	SP0		;DO A CRLF
 3122:					;
 3123:	  0DFE	7D 3F		IN2:	MOV	R5,#'?'		;OUTPUT A ?
 3124:	  0E00	12 07 09		CALL	TEROT
 3125:					;
 3126:	  0E03	D2 22		IN2A:	SETB	INP_B		;DOING INPUT
 3127:	  0E05	12 06 D0		CALL	INLINE		;INPUT THE LINE
 3128:	  0E08	C2 22			CLR	INP_B
 3129:	  0E0A	75 0F 00		MOV	TEMP5,#HIGH IBUF
 3130:	  0E0D	75 0E 07		MOV	TEMP4,#LOW IBUF
 3131:					;
 3132:	  0E10	D1 C0		IN3:	ACALL	S_C		;SEE IF A STRING
 3133:	  0E12	40 0D			JC	IN3A		;IF CARRY IS SET, NO STRING
 3134:	  0E14	B1 AE			ACALL	X3120		;FLIP THE ADDRESSES
 3135:	  0E16	AB 0F			MOV	R3,TEMP5
 3136:	  0E18	A9 0E			MOV	R1,TEMP4
 3137:	  0E1A	31 9E			ACALL	SSOOP
 3138:	  0E1C	D1 C7			ACALL	C_TST		;SEE IF MORE TO DO
 3139:	  0E1E	50 DE			JNC	IN2
 3140:	  0E20	22			RET
 3141:					;
 3142:	  0E21	12 18 45	IN3A:	CALL	DTEMP		;GET THE USER LOCATION
 3143:	  0E24	12 19 4C		CALL	GET_NUM		;GET THE USER SUPPLIED NUMBER
 3144:	  0E27	70 18			JNZ	IN5		;ERROR IF NOT ZERO
 3145:	  0E29	12 18 4C		CALL	TEMPD		;SAVE THE DATA POINTER
 3146:	  0E2C	F1 02			ACALL	VAR_ER		;GET THE VARIABLE
 3147:	  0E2E	F1 D2			ACALL	XPOP		;SAVE THE VARIABLE
 3148:	  0E30	12 18 45		CALL	DTEMP		;GET DPTR BACK FROM VAR_ER
 3149:	  0E33	D1 C7			ACALL	C_TST		;SEE IF MORE TO DO
 3150:	  0E35	40 13			JC	IN6		;EXIT IF NO COMMA
 3151:	  0E37	E0			MOVX	A,@DPTR		;GET INPUT TERMINATOR
 3152:	  0E38	B4 2C 06		CJNE	A,#',',IN5	;IF NOT A COMMA DO A CR AND TRY AGAIN
 3153:	  0E3B	A3			INC	DPTR		;BUMP PAST COMMA AND READ NEXT VALUE
 3154:	  0E3C	12 18 4C		CALL	TEMPD
 3155:	  0E3F	80 CF			SJMP	IN3
 3156:					;
 3157:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 77



 Line  I  Addr  Code            Source

 3158:					;
 3159:	  0E41	90 00 F1	IN5:	MOV	DPTR,#IAN	;PRINT INPUT A NUMBER
 3160:	  0E44	12 06 A5		CALL	CRP		;DO A CR, THEN, PRINT FROM ROM
 3161:	  0E47	02 18 3C		LJMP	CC1		;TRY IT AGAIN
 3162:					;
 3163:	  0E4A	E0		IN6:	MOVX	A,@DPTR
 3164:	  0E4B	B4 0D 01		CJNE	A,#CR,EIGP
 3165:	  0E4E	22			RET
 3166:					;
 3167:	  0E4F	90 03 69	EIGP:	MOV	DPTR,#EIG
 3168:	  0E52	12 06 A5		CALL	CRP		;PRINT THE MESSAGE AND EXIT
 3169:	  0E55	81 3D			AJMP	SP0		;EXIT WITH A CRLF
 3170:					;
 3171:					;***************************************************************
 3172:					;
 3173:	  0E57			SOT:	; On timer interrupt
 3174:					;
 3175:					;***************************************************************
 3176:					;
 3177:	  0E57	D1 86			ACALL	TWO		;GET THE NUMBERS
 3178:	  0E59	8B 4B			MOV	SP_H,R3
 3179:	  0E5B	89 4C			MOV	SP_L,R1
 3180:	  0E5D	90 01 26		MOV	DPTR,#TIV	;SAVE THE NUMBER
 3181:	  0E60	D2 10			SETB	OTS
 3182:	  0E62	A1 F0			AJMP	R76S		;EXIT
 3183:					;
 3184:					;
 3185:					;***************************************************************
 3186:					;
 3187:	  0E64			SCALL:	; Call a user rountine
 3188:					;
 3189:					;***************************************************************
 3190:					;
 3191:	  0E64	F1 31			ACALL	INTERR		;CONVERT INTEGER
 3192:	  0E66	BA 00 0A		CJNE	R2,#0,S_C_1	;SEE IF TRAP
 3193:	  0E69	E8			MOV	A,R0
 3194:	  0E6A	20 E7 06		JB	ACC.7,S_C_1
 3195:	  0E6D	28			ADD	A,R0
 3196:	  0E6E	90 41 00		MOV	DPTR,#4100H
 3197:	  0E71	F5 82			MOV	DPL,A
 3198:					;
 3199:	  0E73	31 6D		S_C_1:	ACALL	AC1		;JUMP TO USER PROGRAM
 3200:	  0E75	53 D0 E7		ANL	PSW,#11100111B	;BACK TO BANK 0
 3201:	  0E78	22			RET			;EXIT
 3202:					;
 3203:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 78



 Line  I  Addr  Code            Source

 3204:					;**************************************************************
 3205:					;
 3206:	  0E79			THREE:	; Save value for timer function
 3207:					;
 3208:					;**************************************************************
 3209:					;
 3210:	  0E79	D1 8F			ACALL	ONE		;GET THE FIRST INTEGER
 3211:	  0E7B	12 16 70		CALL	CBIAS		;BIAS FOR TIMER LOAD
 3212:	  0E7E	8B 40			MOV	T_HH,R3
 3213:	  0E80	89 41			MOV	T_LL,R1
 3214:	  0E82	7F 2C			MOV	R7,#','		;WASTE A COMMA
 3215:	  0E84	91 E6			ACALL	EATC		;FALL THRU TO TWO
 3216:					;
 3217:					;**************************************************************
 3218:					;
 3219:	  0E86			TWO:	; Get two values seperated by a comma off the stack
 3220:					;
 3221:					;**************************************************************
 3222:					;
 3223:	  0E86	F1 44			ACALL	EXPRB
 3224:	  0E88	7F 2C			MOV	R7,#','		;WASTE THE COMMA
 3225:	  0E8A	F1 42			ACALL	WE
 3226:	  0E8C	02 14 8A		JMP	TWOL		;EXIT
 3227:					;
 3228:					;*************************************************************
 3229:					;
 3230:	  0E8F			ONE:	; Evaluate an expression and get an integer
 3231:					;
 3232:					;*************************************************************
 3233:					;
 3234:	  0E8F	F1 44			ACALL	EXPRB		;EVALUATE EXPERSSION
 3235:					;
 3236:	  0E91	12 12 0C	IFIXL:	CALL	IFIX		;INTEGERS IN R3:R1
 3237:	  0E94	E9			MOV	A,R1
 3238:	  0E95	22			RET
 3239:					;
 3240:					;
 3241:					;*************************************************************
 3242:					;
 3243:	  0E96			I_PI:	; Increment text pointer then get an integer
 3244:					;
 3245:					;*************************************************************
 3246:					;
 3247:	  0E96	D1 D8			ACALL	GCI1		;BUMP TEXT, THEN GET INTEGER
 3248:					;
 3249:	  0E98			PAREN_INT:; Get an integer in parens ( )
 3250:					;
 3251:	  0E98	91 E0			ACALL	P_E
 3252:	  0E9A	80 F5			SJMP	IFIXL
 3253:					;
 3254:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 79



 Line  I  Addr  Code            Source

 3255:					;
 3256:	  0E9C	85 13 83	DP_B:	MOV	DPH,BOFAH
 3257:	  0E9F	85 14 82		MOV	DPL,BOFAL
 3258:	  0EA2	22			RET
 3259:					;
 3260:	  0EA3	85 0A 83	DP_T:	MOV	DPH,TXAH
 3261:	  0EA6	85 08 82		MOV	DPL,TXAL
 3262:	  0EA9	22			RET
 3263:					;
 3264:	  0EAA	D1 CE		CPS:	ACALL	GC		;GET THE CHARACTER
 3265:	  0EAC	B4 22 73		CJNE	A,#'"',NOPASS	;EXIT IF NO STRING
 3266:	  0EAF	D1 A3			ACALL	DP_T		;GET TEXT POINTER
 3267:	  0EB1	A3			INC	DPTR		;BUMP PAST "
 3268:	  0EB2	7C 22			MOV	R4,#'"'
 3269:	  0EB4	12 06 BB		CALL	PN0		;DO THE PRINT
 3270:	  0EB7	A3			INC	DPTR		;GO PAST QUOTE
 3271:	  0EB8	C3			CLR	C		;PASSED TEST
 3272:					;
 3273:	  0EB9	85 83 0A	T_DP:	MOV	TXAH,DPH	;TEXT POINTER GETS DPTR
 3274:	  0EBC	85 82 08		MOV	TXAL,DPL
 3275:	  0EBF	22			RET
 3276:					;
 3277:					;*************************************************************
 3278:					;
 3279:	  0EC0			S_C:	; Check for a string
 3280:					;
 3281:					;*************************************************************
 3282:					;
 3283:	  0EC0	D1 CE			ACALL	GC		;GET THE CHARACTER
 3284:	  0EC2	B4 24 5D		CJNE	A,#'$',NOPASS	;SET CARRY IF NOT A STRING
 3285:	  0EC5	21 E8			AJMP	IST_CAL		;CLEAR CARRY, CALCULATE OFFSET
 3286:					;
 3287:					;
 3288:					;
 3289:					;**************************************************************
 3290:					;
 3291:	  0EC7	D1 CE		C_TST:	ACALL	GC		;GET A CHARACTER
 3292:	  0EC9	B4 2C 56		CJNE	A,#',',NOPASS	;SEE IF A COMMA
 3293:					;
 3294:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 80



 Line  I  Addr  Code            Source

 3295:					;***************************************************************
 3296:					;
 3297:					;GC AND GCI - GET A CHARACTER FROM TEXT (NO BLANKS)
 3298:					;             PUT CHARACTER IN THE ACC
 3299:					;
 3300:					;***************************************************************
 3301:					;
 3302:	  0ECC	D1 D8		IGC:	ACALL	GCI1		;BUMP POINTER, THEN GET CHARACTER
 3303:					;
 3304:	  0ECE	D2 D3		GC:	SETB	RS0		;USE BANK 1
 3305:	  0ED0	8A A0			MOV	P2,R2		;SET UP PORT 2
 3306:	  0ED2	E2			MOVX	A,@R0		;GET EXTERNAL BYTE
 3307:	  0ED3	C2 D3			CLR	RS0		;BACK TO BANK 0
 3308:	  0ED5	22			RET			;EXIT
 3309:					;
 3310:	  0ED6	D1 CE		GCI:	ACALL	GC
 3311:					;
 3312:					; This routine bumps txa by one and always clears the carry
 3313:					;
 3314:	  0ED8	D2 D3		GCI1:	SETB	RS0		;BANK 1
 3315:	  0EDA	08			INC	R0		;BUMP TXA
 3316:	  0EDB	B8 00 01		CJNE	R0,#0,$+4
 3317:	  0EDE	0A			INC	R2
 3318:	  0EDF	C2 D3			CLR	RS0
 3319:	  0EE1	22			RET			;EXIT
 3320:					;
 3321:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 81



 Line  I  Addr  Code            Source

 3322:					;**************************************************************
 3323:					;
 3324:					; Check delimiters
 3325:					;
 3326:					;**************************************************************
 3327:					;
 3328:	  0EE2	D1 CE		DELTST:	ACALL	GC		;GET A CHARACTER
 3329:	  0EE4	B4 0D 02		CJNE	A,#CR,DT1	;SEE IF A CR
 3330:	  0EE7	E4			CLR	A
 3331:	  0EE8	22			RET
 3332:					;
 3333:	  0EE9	B4 3A 36	DT1:	CJNE	A,#':',NOPASS	;SET CARRY IF NO MATCH
 3334:					;
 3335:	  0EEC	22		L_RET:	RET
 3336:					;
 3337:					;
 3338:					;***************************************************************
 3339:					;
 3340:					; FINDC - Find the character in R7, update TXA
 3341:					;
 3342:					;***************************************************************
 3343:					;
 3344:	  0EED	7F 0D		FINDCR:	MOV	R7,#CR		;KILL A STATEMENT LINE
 3345:					;
 3346:	  0EEF	D1 E2		FINDC:	ACALL	DELTST
 3347:	  0EF1	50 F9			JNC	L_RET
 3348:					;
 3349:	  0EF3	B5 07 01		CJNE	A,R7B0,FNDCL2	;MATCH?
 3350:	  0EF6	22			RET
 3351:					;
 3352:	  0EF7	D1 D8		FNDCL2:	ACALL	GCI1
 3353:	  0EF9	80 F4			SJMP	FINDC		;LOOP
 3354:					;
 3355:	  0EFB	D1 D8			ACALL	GCI1
 3356:					;
 3357:	  0EFD	D1 E2		WCR:	ACALL	DELTST		;WASTE UNTIL A "REAL" CR
 3358:	  0EFF	70 FA			JNZ	WCR-2
 3359:	  0F01	22			RET
 3360:					;
 3361:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 82



 Line  I  Addr  Code            Source

 3362:					;***************************************************************
 3363:					;
 3364:					; VAR_ER - Check for a variable, exit if error
 3365:					;
 3366:					;***************************************************************
 3367:					;
 3368:	  0F02	B1 66		VAR_ER:	ACALL	VAR
 3369:	  0F04	80 2D			SJMP	INTERR+2
 3370:					;
 3371:					;
 3372:					;***************************************************************
 3373:					;
 3374:					; S_D0 - The Statement Action Routine DO
 3375:					;
 3376:					;***************************************************************
 3377:					;
 3378:	  0F06	71 BE		S_DO:	ACALL	CSC		;FINISH UP THE LINE
 3379:	  0F08	7C 03			MOV	R4,#DTYPE	;TYPE FOR STACK
 3380:	  0F0A	71 36			ACALL	SGS1		;SAVE ON STACK
 3381:	  0F0C	01 17			AJMP	ILOOP		;EXIT
 3382:					;
 3383:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 83



 Line  I  Addr  Code            Source

 3384:					;***************************************************************
 3385:					;
 3386:					; CLN_UP - Clean up the end of a statement, see if at end of
 3387:					;          file, eat character and line count after CR
 3388:					;
 3389:					;***************************************************************
 3390:					;
 3391:	  0F0E	B4 3A 02	C_2:	CJNE	A,#':',C_1	;SEE IF A TERMINATOR
 3392:	  0F11	C1 D8			AJMP	GCI1		;BUMP POINTER AND EXIT, IF SO
 3393:					;
 3394:	  0F13	B4 A8 6D	C_1:	CJNE	A,#T_ELSE,EP5
 3395:	  0F16	D1 FD			ACALL	WCR		;WASTE UNTIL A CR
 3396:					;
 3397:	  0F18	D1 CE		CLN_UP:	ACALL	GC		;GET THE CHARACTER
 3398:	  0F1A	B4 0D F1		CJNE	A,#CR,C_2	;SEE IF A CR
 3399:	  0F1D	D1 CC			ACALL	IGC		;GET THE NEXT CHARACTER
 3400:	  0F1F	B4 01 02		CJNE	A,#EOF,B_TXA	;SEE IF TERMINATOR
 3401:					;
 3402:	  0F22	D3		NOPASS:	SETB	C
 3403:	  0F23	22			RET
 3404:					;
 3405:	  0F24	C5 08		B_TXA:	XCH	A,TXAL		;BUMP TXA BY THREE
 3406:	  0F26	24 03			ADD	A,#3
 3407:	  0F28	C5 08			XCH	A,TXAL
 3408:	  0F2A	10 D7 01		JBC	CY,$+4
 3409:	  0F2D	22			RET
 3410:	  0F2E	05 0A			INC	TXAH
 3411:	  0F30	22			RET
 3412:					;
 3413:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 84



 Line  I  Addr  Code            Source

 3414:					;***************************************************************
 3415:					;
 3416:					;         Get an INTEGER from the text
 3417:					;         sets CARRY if not found
 3418:					;         returns the INTGER value in DPTR and R2:R0
 3419:					;         returns the terminator in ACC
 3420:					;
 3421:					;***************************************************************
 3422:					;
 3423:	  0F31	F1 36		INTERR:	ACALL	INTGER		;GET THE INTEGER
 3424:	  0F33	40 4E			JC	EP5		;ERROR IF NOT FOUND
 3425:	  0F35	22			RET			;EXIT IF FOUND
 3426:					;
 3427:	  0F36	D1 A3		INTGER:	ACALL	DP_T
 3428:	  0F38	12 19 A5		CALL	FP_BASE+18	;CONVERT THE INTEGER
 3429:	  0F3B	D1 B9			ACALL	T_DP
 3430:	  0F3D	8A 83			MOV	DPH,R2		;PUT THE RETURNED VALUE IN THE DPTR
 3431:	  0F3F	88 82			MOV	DPL,R0
 3432:					;
 3433:	  0F41	22		ITRET:	RET			;EXIT
 3434:					;
 3435:					;
 3436:	  0F42	91 E6		WE:	ACALL	EATC		;WASTE THE CHARACTER
 3437:					;
 3438:					; Fall thru to evaluate the expression
 3439:					;
 3440:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 85



 Line  I  Addr  Code            Source

 3441:					;***************************************************************
 3442:					;
 3443:					; EXPRB - Evaluate an expression
 3444:					;
 3445:					;***************************************************************
 3446:					;
 3447:	  0F44	7A CD		EXPRB:	MOV	R2,#LOW OPBOL	;BASE PRECEDENCE
 3448:					;
 3449:	  0F46	C0 02		EP1:	PUSH	R2B0		;SAVE OPERATOR PRECEDENCE
 3450:	  0F48	C2 24			CLR	ARGF		;RESET STACK DESIGNATOR
 3451:					;
 3452:	  0F4A	E5 81		EP2:	MOV	A,SP		;GET THE STACK POINTER
 3453:	  0F4C	24 0C			ADD	A,#12		;NEED AT LEAST 12 BYTES
 3454:	  0F4E	50 03			JNC	$+5
 3455:	  0F50	02 18 84		LJMP	ERROR-3
 3456:	  0F53	E5 09			MOV	A,ASTKA		;GET THE ARG STACK
 3457:	  0F55	94 38			SUBB	A,#LOW TM_TOP+12;NEED 12 BYTES ALSO
 3458:	  0F57	50 03			JNC	$+5
 3459:	  0F59	02 12 03		LJMP	E4YY
 3460:	  0F5C	20 24 13		JB	ARGF,EP4	;MUST BE AN OPERATOR, IF SET
 3461:	  0F5F	B1 66			ACALL	VAR		;IS THE VALUE A VARIABLE?
 3462:	  0F61	50 0D			JNC	EP3		;PUT VARIABLE ON STACK
 3463:					;
 3464:	  0F63	F1 F0			ACALL	CONST		;IS THE VALUE A NUMERIC CONSTANT?
 3465:	  0F65	50 0B			JNC	EP4		;IF SO, CONTINUE, IF NOT, SEE WHAT
 3466:	  0F67	D1 CE			CALL	GC		;GET THE CHARACTER
 3467:	  0F69	B4 E0 06		CJNE	A,#T_LPAR,EP4	;SEE IF A LEFT PAREN
 3468:	  0F6C	74 CE			MOV	A,#(LOW OPBOL+1)
 3469:	  0F6E	80 55			SJMP	XLPAR		;PROCESS THE LEFT PAREN
 3470:					;
 3471:	  0F70	F1 DE		EP3:	ACALL	PUSHAS		;SAVE VAR ON STACK
 3472:					;
 3473:	  0F72	D1 CE		EP4:	ACALL	GC		;GET THE OPERATOR
 3474:					;
 3475:	  0F74	B4 E0 00		CJNE	A,#T_LPAR,$+3	;IS IT AN OPERATOR
 3476:	  0F77	50 0E			JNC	XOP		;PROCESS OPERATOR
 3477:	  0F79	B4 B0 00		CJNE	A,#T_UOP,$+3	;IS IT A UNARY OPERATOR
 3478:	  0F7C	50 3B			JNC	XBILT		;PROCESS UNARY (BUILT IN) OPERATOR
 3479:	  0F7E	D0 02			POP	R2B0		;GET BACK PREVIOUS OPERATOR PRECEDENCE
 3480:	  0F80	20 24 BE		JB	ARGF,ITRET	;OK IF ARG FLAG IS SET
 3481:					;
 3482:	  0F83	C3		EP5:	CLR	C		;NO RECOVERY
 3483:	  0F84	02 18 7F		LJMP	E1XX+2
 3484:					;
 3485:					; Process the operator
 3486:					;
 3487:	  0F87	54 1F		XOP:	ANL	A,#1FH		;STRIP OFF THE TOKE BITS
 3488:	  0F89	20 24 05		JB	ARGF,XOP1	;IF ARG FLAG IS SET, PROCESS
 3489:	  0F8C	B4 05 3C		CJNE	A,#T_SUB-T_LPAR,XOP3
 3490:	  0F8F	74 09			MOV	A,#T_NEG-T_LPAR
 3491:					;
 3492:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 86



 Line  I  Addr  Code            Source

 3493:	  0F91	24 CE		XOP1:	ADD	A,#LOW OPBOL+1	;BIAS THE TABLE
 3494:	  0F93	FA			MOV	R2,A
 3495:	  0F94	90 00 00		MOV	DPTR,#00H
 3496:	  0F97	93			MOVC	A,@A+DPTR	;GET THE CURRENT PRECEDENCE
 3497:	  0F98	FC			MOV	R4,A
 3498:	  0F99	D0 E0			POP	ACC		;GET THE PREVIOUS PRECEDENCE
 3499:	  0F9B	FD			MOV	R5,A		;SAVE THE PREVIOUS PRECEDENCE
 3500:	  0F9C	93			MOVC	A,@A+DPTR	;GET IT
 3501:	  0F9D	B5 04 04		CJNE	A,R4B0,$+7	;SEE WHICH HAS HIGHER PRECEDENCE
 3502:	  0FA0	B4 0C 9E		CJNE	A,#12,ITRET	;SEE IF ANEG
 3503:	  0FA3	D3			SETB	C
 3504:	  0FA4	50 9B			JNC	ITRET		;PROCESS NON-INCREASING PRECEDENCE
 3505:					;
 3506:					; Save increasing precedence
 3507:					;
 3508:	  0FA6	C0 05			PUSH	R5B0		;SAVE OLD PRECEDENCE ADDRESS
 3509:	  0FA8	C0 02			PUSH	R2B0		;SAVE NEW PRECEDENCE ADDRESS
 3510:	  0FAA	D1 D8			ACALL	GCI1		;EAT THE OPERATOR
 3511:	  0FAC	F1 46			ACALL	EP1		;EVALUATE REMAINING EXPRESSION
 3512:	  0FAE	D0 E0			POP	ACC
 3513:					;
 3514:					; R2 has the action address, now setup and perform operation
 3515:					;
 3516:	  0FB0	90 00 57	XOP2:	MOV	DPTR,#OPTAB
 3517:	  0FB3	24 32			ADD	A,#LOW (NOT OPBOL)
 3518:	  0FB5	31 5D			CALL	ISTA1		;SET UP TO RETURN TO EP2
 3519:	  0FB7	E1 4A			AJMP	EP2		;JUMP TO EVALUATE EXPRESSION
 3520:					;
 3521:					; Built-in operator processing
 3522:					;
 3523:	  0FB9	D1 D8		XBILT:	ACALL	GCI1		;EAT THE TOKEN
 3524:	  0FBB	24 2E			ADD	A,#LOW (50H+LOW UOPBOL)
 3525:	  0FBD	20 24 C3		JB	ARGF,EP5	;XBILT MUST COME AFTER AN OPERATOR
 3526:	  0FC0	B4 EC 00		CJNE	A,#STP,$+3
 3527:	  0FC3	50 EB			JNC	XOP2
 3528:					;
 3529:	  0FC5	C0 E0		XLPAR:	PUSH	ACC		;PUT ADDRESS ON THE STACK
 3530:	  0FC7	91 E0			ACALL	P_E
 3531:	  0FC9	80 E3			SJMP	XOP2-2		;PERFORM OPERATION
 3532:					;
 3533:	  0FCB	B4 03 B5	XOP3:	CJNE	A,#T_ADD-T_LPAR,EP5
 3534:	  0FCE	D1 D8			ACALL	GCI1
 3535:	  0FD0	E1 4A			AJMP	EP2		;WASTE + SIGN
 3536:					;
 3537:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 87



 Line  I  Addr  Code            Source

 3538:	  0FD2	B1 AE		XPOP:	ACALL	X3120		;FLIP ARGS THEN POP
 3539:					;
 3540:					;***************************************************************
 3541:					;
 3542:					; POPAS - Pop arg stack and copy variable to R3:R1
 3543:					;
 3544:					;***************************************************************
 3545:					;
 3546:	  0FD4	12 12 38	POPAS:	LCALL	INC_ASTKA
 3547:	  0FD7	02 14 5B		JMP	VARCOP		;COPY THE VARIABLE
 3548:					;
 3549:	  0FDA	7A 01		AXTAL:	MOV	R2,#HIGH CXTAL
 3550:	  0FDC	78 13			MOV	R0,#LOW CXTAL
 3551:					;
 3552:					; fall thru
 3553:					;
 3554:					;***************************************************************
 3555:					;
 3556:	  0FDE			PUSHAS:	; Push the Value addressed by R2:R0 onto the arg stack
 3557:					;
 3558:					;***************************************************************
 3559:					;
 3560:	  0FDE	12 11 F4		CALL	DEC_ASTKA
 3561:	  0FE1	D2 24			SETB	ARGF		;SAYS THAT SOMTHING IS ON THE STACK
 3562:	  0FE3	02 14 5B		LJMP	VARCOP
 3563:					;
 3564:					;
 3565:					;***************************************************************
 3566:					;
 3567:	  0FE6			ST_A:	; Store at expression
 3568:					;
 3569:					;***************************************************************
 3570:					;
 3571:	  0FE6	D1 8F			ACALL	ONE		;GET THE EXPRESSION
 3572:	  0FE8	80 EA			SJMP	POPAS		;SAVE IT
 3573:					;
 3574:					;
 3575:					;***************************************************************
 3576:					;
 3577:	  0FEA			LD_A:	; Load at expression
 3578:					;
 3579:					;***************************************************************
 3580:					;
 3581:	  0FEA	D1 8F			ACALL	ONE		;GET THE EXPRESSION
 3582:	  0FEC	B1 AE			ACALL	X3120		;FLIP ARGS
 3583:	  0FEE	80 EE			SJMP	PUSHAS
 3584:					;
 3585:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 88



 Line  I  Addr  Code            Source

 3586:					;***************************************************************
 3587:					;
 3588:	  0FF0			CONST:	; Get a constant fron the text
 3589:					;
 3590:					;***************************************************************
 3591:					;
 3592:	  0FF0	D1 CE			CALL	GC		;FIRST SEE IF LITERAL
 3593:	  0FF2	B4 D1 13		CJNE	A,#T_ASC,C0C	;SEE IF ASCII TOKEN
 3594:	  0FF5	D1 CC			CALL	IGC		;GET THE CHARACTER AFTER TOKEN
 3595:	  0FF7	B4 24 05		CJNE	A,#'$',CN0	;SEE IF A STRING
 3596:					;
 3597:	  0FFA	51 1F		CNX:	CALL	CSY		;CALCULATE IT
 3598:	  0FFC	02 13 A9		JMP	AXBYTE+2	;SAVE IT ON THE STACK
 3599:					;
 3600:	  0FFF	12 14 9A	CN0:	CALL	TWO_R2		;PUT IT ON THE STACK
 3601:	  1002	12 0E D8		CALL	GCI1		;BUMP THE POINTER
 3602:	  1005	02 0C E4		JMP	ERPAR		;WASTE THE RIGHT PAREN
 3603:					;
 3604:					;
 3605:	  1008	12 0E A3	C0C:	CALL	DP_T		;GET THE TEXT POINTER
 3606:	  100B	12 19 4C		CALL	GET_NUM		;GET THE NUMBER
 3607:	  100E	B4 FF 02		CJNE	A,#0FFH,C1C	;SEE IF NO NUMBER
 3608:	  1011	D3			SETB	C
 3609:	  1012	22		C2C:	RET
 3610:					;
 3611:	  1013	70 06		C1C:	JNZ	FPTST
 3612:	  1015	C3			CLR	C
 3613:	  1016	D2 24			SETB	ARGF
 3614:					;
 3615:	  1018	02 0E B9	C3C:	JMP	T_DP
 3616:					;
 3617:	  101B	54 0B		FPTST:	ANL	A,#00001011B	;CHECK FOR ERROR
 3618:	  101D	60 F3			JZ	C2C		;EXIT IF ZERO
 3619:					;
 3620:					; Handle the error condition
 3621:					;
 3622:	  101F	90 17 46		MOV	DPTR,#E2X	;DIVIDE BY ZERO
 3623:	  1022	30 E0 03		JNB	ACC.0,$+6	;UNDERFLOW
 3624:	  1025	90 17 FC		MOV	DPTR,#E7X
 3625:	  1028	30 E1 03		JNB	ACC.1,$+6	;OVERFLOW
 3626:	  102B	90 1F 89		MOV	DPTR,#E11X
 3627:					;
 3628:	  102E	02 18 87	FPTS:	JMP	ERROR
 3629:					;
 3630:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 89



 Line  I  Addr  Code            Source

 3631:					;***************************************************************
 3632:					;
 3633:					; The Command action routine - LIST
 3634:					;
 3635:					;***************************************************************
 3636:					;
 3637:	  1031	12 0C 1A	CLIST:	CALL	NUMC		;SEE IF TO LINE PORT
 3638:	  1034	71 B4			ACALL	FSTK		;PUT 0FFFFH ON THE STACK
 3639:	  1036	12 0F 36		CALL	INTGER		;SEE IF USER SUPPLIES LN
 3640:	  1039	E4			CLR	A		;LN = 0 TO START
 3641:	  103A	FB			MOV	R3,A
 3642:	  103B	F9			MOV	R1,A
 3643:	  103C	40 14			JC	CL1		;START FROM ZERO
 3644:					;
 3645:	  103E	12 18 4C		CALL	TEMPD		;SAVE THE START ADDTESS
 3646:	  1041	12 0E D6		CALL	GCI		;GET THE CHARACTER AFTER LIST
 3647:	  1044	B4 E5 07		CJNE	A,#T_SUB,$+10	;CHECK FOR TERMINATION ADDRESS '-'
 3648:	  1047	51 38			ACALL	INC_ASTKA	;WASTE 0FFFFH
 3649:	  1049	12 0F 31		LCALL	INTERR		;GET TERMINATION ADDRESS
 3650:	  104C	91 9D			ACALL	TWO_EY		;PUT TERMINATION ON THE ARG STACK
 3651:	  104E	AB 0F			MOV	R3,TEMP5	;GET THE START ADDTESS
 3652:	  1050	A9 0E			MOV	R1,TEMP4
 3653:					;
 3654:	  1052	12 05 84	CL1:	CALL	GETLIN		;GET THE LINE NO IN R3:R1
 3655:	  1055	60 1E			JZ	CL3		;RET IF AT END
 3656:					;
 3657:	  1057	11 18		CL2:	ACALL	C3C		;SAVE THE ADDRESS
 3658:	  1059	A3			INC	DPTR		;POINT TO LINE NUMBER
 3659:	  105A	D1 3B			ACALL	PMTOP+3		;PUT LINE NUMBER ON THE STACK
 3660:	  105C	31 F1			ACALL	CMPLK		;COMPARE LN TO END ADDRESS
 3661:	  105E	40 15			JC	CL3		;EXIT IF GREATER
 3662:	  1060	12 07 85		CALL	BCK		;CHECK FOR A CONTROL C
 3663:	  1063	31 F4			ACALL	DEC_ASTKA	;SAVE THE COMPARE ADDRESS
 3664:	  1065	12 0E A3		CALL	DP_T		;RESTORE ADDRESS
 3665:	  1068	11 86			ACALL	UPPL		;UN-PROCESS THE LINE
 3666:	  106A	11 18			ACALL	C3C		;SAVE THE CR ADDRESS
 3667:	  106C	11 77			ACALL	CL6		;PRINT IT
 3668:	  106E	A3			INC	DPTR		;BUMP POINTER TO NEXT LINE
 3669:	  106F	E0			MOVX	A,@DPTR		;GET LIN LENGTH
 3670:	  1070	D5 E0 E4		DJNZ	ACC,CL2		;LOOP
 3671:	  1073	51 38			ACALL	INC_ASTKA	;WASTE THE COMPARE BYTE
 3672:					;
 3673:	  1075	E1 7C		CL3:	AJMP	CMND1		;BACK TO COMMAND PROCESSOR
 3674:					;
 3675:	  1077	90 00 07	CL6:	MOV	DPTR,#IBUF	;PRINT IBUF
 3676:	  107A	12 06 B9		CALL	PRNTCR		;PRINT IT
 3677:	  107D	12 0E A3		CALL	DP_T
 3678:					;
 3679:	  1080	02 06 9D	CL7:	JMP	CRLF
 3680:					;
 3681:	  1083	12 05 71		LCALL	X31DP
 3682:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 90



 Line  I  Addr  Code            Source

 3683:					;***************************************************************
 3684:					;
 3685:					;UPPL - UN PREPROCESS A LINE ADDRESSED BY DPTR INTO IBUF
 3686:					;       RETURN SOURCE ADDRESS OF CR IN DPTR ON RETURN
 3687:					;
 3688:					;***************************************************************
 3689:					;
 3690:	  1086	7B 00		UPPL:	MOV	R3,#HIGH IBUF	;POINT R3 AT HIGH IBUF
 3691:	  1088	79 07			MOV	R1,#LOW IBUF	;POINT R1 AT IBUF
 3692:	  108A	A3			INC	DPTR		;SKIP OVER LINE LENGTH
 3693:	  108B	11 18			ACALL	C3C		;SAVE THE DPTR (DP_T)
 3694:	  108D	12 05 6B		CALL	L20DPI		;PUT LINE NUMBER IN R2:R0
 3695:	  1090	12 19 A3		CALL	FP_BASE+16	;CONVERT R2:R0 TO INTEGER
 3696:	  1093	12 0E A3		CALL	DP_T
 3697:	  1096	A3			INC	DPTR		;BUMP DPTR PAST THE LINE NUMBER
 3698:					;
 3699:	  1097	B9 0D 00	UPP0:	CJNE	R1,#LOW IBUF+6,$+3
 3700:	  109A	40 22			JC	UPP1A-4		;PUT SPACES IN TEXT
 3701:	  109C	A3			INC	DPTR		;BUMP PAST LN HIGH
 3702:	  109D	E0			MOVX	A,@DPTR		;GET USER TEXT
 3703:	  109E	FE			MOV	R6,A		;SAVE A IN R6 FOR TOKE COMPARE
 3704:	  109F	20 E7 24		JB	ACC.7,UPP1	;IF TOKEN, PROCESS
 3705:	  10A2	B4 20 00		CJNE	A,#20H,$+3	;TRAP THE USER TOKENS
 3706:	  10A5	50 03			JNC	$+5
 3707:	  10A7	B4 0D 1C		CJNE	A,#CR,UPP1	;DO IT IF NOT A CR
 3708:	  10AA	B4 22 09		CJNE	A,#'"',UPP9	;SEE IF STRING
 3709:	  10AD	31 0A			ACALL	UPP7		;SAVE IT
 3710:	  10AF	31 0C			ACALL	UPP8		;GET THE NEXT CHARACTER AND SAVE IT
 3711:	  10B1	B4 22 FB		CJNE	A,#'"',$-2	;LOOP ON QUOTES
 3712:	  10B4	80 E1			SJMP	UPP0
 3713:					;
 3714:	  10B6	B4 3A 09	UPP9:	CJNE	A,#':',UPP1A	;PUT A SPACE IN DELIMITER
 3715:	  10B9	31 08			ACALL	UPP7A
 3716:	  10BB	EE			MOV	A,R6
 3717:	  10BC	31 0A			ACALL	UPP7
 3718:	  10BE	31 08			ACALL	UPP7A
 3719:	  10C0	80 D5			SJMP	UPP0
 3720:					;
 3721:	  10C2	31 0E		UPP1A:	ACALL	UPP8+2		;SAVE THE CHARACTER, UPDATE POINTER
 3722:	  10C4	80 D1			SJMP	UPP0		;EXIT IF A CR, ELSE LOOP
 3723:					;
 3724:	  10C6	11 18		UPP1:	ACALL	C3C		;SAVE THE TEXT POINTER
 3725:	  10C8	A2 2D			MOV	C,XBIT
 3726:	  10CA	92 D5			MOV	F0,C		;SAVE XBIT IN F0
 3727:	  10CC	90 01 73		MOV	DPTR,#TOKTAB	;POINT AT TOKEN TABLE
 3728:	  10CF	30 D5 03		JNB	F0,UPP2
 3729:	  10D2	12 20 78		LCALL	2078H		;SET UP DPTR FOR LOOKUP
 3730:					;
 3731:	  10D5	E4		UPP2:	CLR	A		;ZERO A FOR LOOKUP
 3732:	  10D6	93			MOVC	A,@A+DPTR	;GET TOKEN
 3733:	  10D7	A3			INC	DPTR		;ADVANCE THE TOKEN POINTER
 3734:	  10D8	B4 FF 05		CJNE	A,#0FFH,UP_2	;SEE IF DONE
 3735:	  10DB	10 D5 EE		JBC	F0,UPP2-9	;NOW DO NORMAL TABLE
 3736:	  10DE	E1 7C			AJMP	CMND1		;EXIT IF NOT FOUND
 3737:					;
 3738:	  10E0	B5 06 F2	UP_2:	CJNE	A,R6B0,UPP2	;LOOP UNTIL THE SAME

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 91



 Line  I  Addr  Code            Source

 3739:					;
 3740:	  10E3	B4 B0 00	UP_3:	CJNE	A,#T_UOP,$+3
 3741:	  10E6	50 02			JNC	UPP3
 3742:	  10E8	31 08			ACALL	UPP7A		;PRINT THE SPACE IF OK
 3743:					;
 3744:	  10EA	E4		UPP3:	CLR	A		;DO LOOKUP
 3745:	  10EB	93			MOVC	A,@A+DPTR
 3746:	  10EC	20 E7 07		JB	ACC.7,UPP4	;EXIT IF DONE, ELSE SAVE
 3747:	  10EF	60 05			JZ	UPP4		;DONE IF ZERO
 3748:	  10F1	31 0A			ACALL	UPP7		;SAVE THE CHARACTER
 3749:	  10F3	A3			INC	DPTR
 3750:	  10F4	80 F4			SJMP	UPP3		;LOOP
 3751:					;
 3752:	  10F6	12 0E A3	UPP4:	CALL	DP_T		;GET IT BACK
 3753:	  10F9	EE			MOV	A,R6		;SEE IF A REM TOKEN
 3754:	  10FA	64 96			XRL	A,#T_REM
 3755:	  10FC	70 04			JNZ	$+6
 3756:	  10FE	31 0C			ACALL	UPP8
 3757:	  1100	80 FC			SJMP	$-2
 3758:	  1102	50 93			JNC	UPP0		;START OVER AGAIN IF NO TOKEN
 3759:	  1104	31 08			ACALL	UPP7A		;PRINT THE SPACE IF OK
 3760:	  1106	80 8F			SJMP	UPP0		;DONE
 3761:					;
 3762:	  1108	74 20		UPP7A:	MOV	A,#' '		;OUTPUT A SPACE
 3763:					;
 3764:	  110A	C1 2D		UPP7:	AJMP	PPL9+1		;SAVE A
 3765:					;
 3766:	  110C	A3		UPP8:	INC	DPTR
 3767:	  110D	E0			MOVX	A,@DPTR
 3768:	  110E	B4 0D F9		CJNE	A,#CR,UPP7
 3769:	  1111	C1 19			AJMP	PPL7+1
 3770:					;
 3771:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 92



 Line  I  Addr  Code            Source

 3772:					;**************************************************************
 3773:					;
 3774:					; This table contains all of the floating point constants
 3775:					;
 3776:					; The constants in ROM are stored "backwards" from the way
 3777:					; basic normally treats floating point numbers. Instead of
 3778:					; loading from the exponent and decrementing the pointer,
 3779:					; ROM constants pointers load from the most significant
 3780:					; digits and increment the pointers. This is done to 1) make
 3781:					; arg stack loading faster and 2) compensate for the fact that
 3782:					; no decrement data pointer instruction exsist.
 3783:					;
 3784:					; The numbers are stored as follows:
 3785:					;
 3786:					; BYTE X+5    = MOST SIGNIFICANT DIGITS IN BCD
 3787:					; BYTE X+4    = NEXT MOST SIGNIFICANT DIGITS IN BCD
 3788:					; BYTE X+3    = NEXT LEAST SIGNIFICANT DIGITS IN BCD
 3789:					; BYTE X+2    = LEAST SIGNIFICANT DIGITS IN BCD
 3790:					; BYTE X+1    = SIGN OF THE ABOVE MANTISSA 0 = +, 1 = -
 3791:					; BYTE X      = EXPONENT IN TWO'S COMPLEMENT BINARY
 3792:					;               ZERO EXPONENT = THE NUMBER ZERO
 3793:					;
 3794:					;**************************************************************
 3795:					;
 3796:	  1113	7E		ATTAB:	DB	128-2		; ARCTAN LOOKUP
 3797:	  1114	00			DB	00H
 3798:	  1115	57			DB	57H
 3799:	  1116	22			DB	22H
 3800:	  1117	66			DB	66H
 3801:	  1118	28			DB	28H
 3802:					;
 3803:	  1119	7F			DB	128-1
 3804:	  111A	01			DB	01H
 3805:	  111B	37			DB	37H
 3806:	  111C	57			DB	57H
 3807:	  111D	16			DB	16H
 3808:	  111E	16			DB	16H
 3809:					;
 3810:	  111F	7F			DB	128-1
 3811:	  1120	00			DB	00H
 3812:	  1121	14			DB	14H
 3813:	  1122	96			DB	96H
 3814:	  1123	90			DB	90H
 3815:	  1124	42			DB	42H
 3816:					;
 3817:	  1125	7F			DB	128-1
 3818:	  1126	01			DB	01H
 3819:	  1127	40			DB	40H
 3820:	  1128	96			DB	96H
 3821:	  1129	28			DB	28H
 3822:	  112A	75			DB	75H
 3823:					;
 3824:	  112B	80			DB	128
 3825:	  112C	00			DB	00H
 3826:	  112D	64			DB	64H
 3827:	  112E	62			DB	62H

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 93



 Line  I  Addr  Code            Source

 3828:	  112F	65			DB	65H
 3829:	  1130	10			DB	10H
 3830:					;
 3831:	  1131	80			DB	128
 3832:	  1132	01			DB	01H
 3833:	  1133	99			DB	99H
 3834:	  1134	88			DB	88H
 3835:	  1135	20			DB	20H
 3836:	  1136	14			DB	14H
 3837:					;
 3838:	  1137	80			DB	128
 3839:	  1138	00			DB	00H
 3840:	  1139	51			DB	51H
 3841:	  113A	35			DB	35H
 3842:	  113B	99			DB	99H
 3843:	  113C	19			DB	19H
 3844:					;
 3845:	  113D	80			DB	128
 3846:	  113E	01			DB	01H
 3847:	  113F	45			DB	45H
 3848:	  1140	31			DB	31H
 3849:	  1141	33			DB	33H
 3850:	  1142	33			DB	33H
 3851:					;
 3852:	  1143	81			DB	129
 3853:	  1144	00			DB	00H
 3854:	  1145	00			DB	00H
 3855:	  1146	00			DB	00H
 3856:	  1147	00			DB	00H
 3857:	  1148	10			DB	10H
 3858:					;
 3859:	  1149	FF			DB	0FFH		;END OF TABLE
 3860:					;
 3861:	  114A	81		NTWO:	DB	129
 3862:	  114B	00			DB	0
 3863:	  114C	00			DB	0
 3864:	  114D	00			DB	0
 3865:	  114E	00			DB	0
 3866:	  114F	20			DB	20H
 3867:					;
 3868:	  1150	7C		TTIME:	DB	128-4		; CLOCK CALCULATION
 3869:	  1151	00			DB	00H
 3870:	  1152	00			DB	00H
 3871:	  1153	00			DB	00H
 3872:	  1154	04			DB	04H
 3873:	  1155	13			DB	13H
 3874:					;
 3875:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 94



 Line  I  Addr  Code            Source

 3876:					;***************************************************************
 3877:					;
 3878:					; COSINE - Add pi/2 to stack, then fall thru to SIN
 3879:					;
 3880:					;***************************************************************
 3881:					;
 3882:	  1156	31 7B		ACOS:	ACALL	POTWO		;PUT PI/2 ON THE STACK
 3883:	  1158	F1 36			ACALL	AADD		;TOS = TOS+PI/2
 3884:					;
 3885:					;***************************************************************
 3886:					;
 3887:					; SINE - use taylor series to calculate sin function
 3888:					;
 3889:					;***************************************************************
 3890:					;
 3891:	  115A	91 68		ASIN:	ACALL	PIPI		;PUT PI ON THE STACK
 3892:	  115C	31 9E			ACALL	RV		;REDUCE THE VALUE
 3893:	  115E	E5 46			MOV	A,MT2		;CALCULATE THE SIGN
 3894:	  1160	54 01			ANL	A,#01H		;SAVE LSB
 3895:	  1162	62 45			XRL	MT1,A		;SAVE SIGN IN MT1
 3896:	  1164	91 15			ACALL	CSTAKA		;NOW CONVERT TO ONE QUADRANT
 3897:	  1166	31 7B			ACALL	POTWO
 3898:	  1168	31 F1			ACALL	CMPLK		;DO COMPARE
 3899:	  116A	40 04			JC	$+6
 3900:	  116C	91 68			ACALL	PIPI
 3901:	  116E	F1 11			ACALL	ASUB
 3902:	  1170	71 78			ACALL	AABS
 3903:	  1172	90 16 C3		MOV	DPTR,#SINTAB	;SET UP LOOKUP TABLE
 3904:	  1175	31 84			ACALL	POLYC		;CALCULATE THE POLY
 3905:	  1177	31 C3			ACALL	STRIP
 3906:	  1179	21 E5			AJMP	SIN0
 3907:					;
 3908:					; Put PI/2 on the stack
 3909:					;
 3910:	  117B	91 68		POTWO:	ACALL	PIPI		;PUT PI ON THE STACK, NOW DIVIDE
 3911:					;
 3912:	  117D	90 11 4A	DBTWO:	MOV	DPTR,#NTWO
 3913:	  1180	91 1C			ACALL	PUSHC
 3914:					;MOV	A,#2		;BY TWO
 3915:					;ACALL	TWO_R2
 3916:	  1182	61 F3			AJMP	ADIV
 3917:					;
 3918:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 95



 Line  I  Addr  Code            Source

 3919:					;*************************************************************
 3920:					;
 3921:	  1184			POLYC:	; Expand a power series to calculate a polynomial
 3922:					;
 3923:					;*************************************************************
 3924:					;
 3925:	  1184	91 13			ACALL	CSTAKA2		;COPY THE STACK
 3926:	  1186	31 99			ACALL	AMUL		;SQUARE THE STACK
 3927:	  1188	91 31			ACALL	POP_T1		;SAVE X*X
 3928:	  118A	91 1C			ACALL	PUSHC		;PUT CONSTANT ON STACK
 3929:					;
 3930:	  118C	91 38		POLY1:	ACALL	PUSH_T1		;PUT COMPUTED VALUE ON STACK
 3931:	  118E	31 99			ACALL	AMUL		;MULTIPLY CONSTANT AND COMPUTED VALUE
 3932:	  1190	91 1C			ACALL	PUSHC		;PUT NEXT CONSTANT ON STACK
 3933:	  1192	F1 36			ACALL	AADD		;ADD IT TO THE OLD VALUE
 3934:	  1194	E4			CLR	A		;CHECK TO SEE IF DONE
 3935:	  1195	93			MOVC	A,@A+DPTR
 3936:	  1196	B4 FF F3		CJNE	A,#0FFH,POLY1	;LOOP UNTIL DONE
 3937:					;
 3938:	  1199	12 19 99	AMUL:	LCALL	FP_BASE+6
 3939:	  119C	01 1B			AJMP	FPTST
 3940:					;
 3941:					;*************************************************************
 3942:					;
 3943:	  119E			RV:	; Reduce a value for Trig and A**X functions
 3944:					;
 3945:					; value = (value/x - INT(value/x)) * x
 3946:					;
 3947:					;*************************************************************
 3948:					;
 3949:	  119E	91 55			ACALL	C_T2		;COPY TOS TO T2
 3950:	  11A0	71 F3			ACALL	ADIV		;TOS = TOS/TEMP2
 3951:	  11A2	71 78			ACALL	AABS		;MAKE THE TOS A POSITIVE NUMBER
 3952:	  11A4	F5 45			MOV	MT1,A		;SAVE THE SIGN
 3953:	  11A6	91 13			ACALL	CSTAKA2		;COPY THE STACK TWICE
 3954:	  11A8	51 0C			ACALL	IFIX		;PUT THE NUMBER IN R3:R1
 3955:	  11AA	C0 03			PUSH	R3B0		;SAVE R3
 3956:	  11AC	89 46			MOV	MT2,R1		;SAVE THE LS BYTE IN MT2
 3957:	  11AE	71 56			ACALL	AINT		;MAKE THE TOS AN INTEGER
 3958:	  11B0	F1 11			ACALL	ASUB		;TOS = TOS/T2 - INT(TOS/T2)
 3959:	  11B2	91 3F			ACALL	P_T2		;TOS = T2
 3960:	  11B4	31 99			ACALL	AMUL		;TOS = T2*(TOS/T2 - INT(TOS/T2)
 3961:	  11B6	D0 03			POP	R3B0		;RESTORE R3
 3962:	  11B8	22			RET			;EXIT
 3963:					;
 3964:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 96



 Line  I  Addr  Code            Source

 3965:					;**************************************************************
 3966:					;
 3967:					; TAN
 3968:					;
 3969:					;**************************************************************
 3970:					;
 3971:	  11B9	91 15		ATAN:	ACALL	CSTAKA		;DUPLACATE STACK
 3972:	  11BB	31 5A			ACALL	ASIN		;TOS = SIN(X)
 3973:	  11BD	91 43			ACALL	SWAP_ASTKA	;TOS = X
 3974:	  11BF	31 56			ACALL	ACOS		;TOS = COS(X)
 3975:	  11C1	61 F3			AJMP	ADIV		;TOS = SIN(X)/COS(X)
 3976:					;
 3977:	  11C3	51 3C		STRIP:	ACALL	SETREG		;SETUP R0
 3978:	  11C5	7B 01			MOV	R3,#1		;LOOP COUNT
 3979:	  11C7	61 6A			AJMP	AI2-1		;WASTE THE LSB
 3980:					;
 3981:					;************************************************************
 3982:					;
 3983:					; ARC TAN
 3984:					;
 3985:					;************************************************************
 3986:					;
 3987:	  11C9	71 78		AATAN:	ACALL	AABS
 3988:	  11CB	F5 45			MOV	MT1,A		;SAVE THE SIGN
 3989:	  11CD	51 3C			ACALL	SETREG		;GET THE EXPONENT
 3990:	  11CF	24 7F			ADD	A,#7FH		;BIAS THE EXPONENT
 3991:	  11D1	92 2A			MOV	UBIT,C		;SAVE CARRY STATUS
 3992:	  11D3	50 02			JNC	$+4		;SEE IF > 1
 3993:	  11D5	51 65			ACALL	RECIP		;IF > 1, TAKE RECIP
 3994:	  11D7	90 11 13		MOV	DPTR,#ATTAB	;SET UP TO CALCULATE THE POLY
 3995:	  11DA	31 84			ACALL	POLYC		;CALCULATE THE POLY
 3996:	  11DC	30 2A 06		JNB	UBIT,SIN0	;JUMP IF NOT SET
 3997:	  11DF	71 8A			ACALL	ANEG		;MAKE X POLY NEGATIVE
 3998:	  11E1	31 7B			ACALL	POTWO		;SUBTRACT PI/2
 3999:	  11E3	F1 36			ACALL	AADD
 4000:					;
 4001:	  11E5	E5 45		SIN0:	MOV	A,MT1		;GET THE SIGN
 4002:	  11E7	60 19			JZ	SRT
 4003:	  11E9	61 8A			AJMP	ANEG
 4004:					;
 4005:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 97



 Line  I  Addr  Code            Source

 4006:					;*************************************************************
 4007:					;
 4008:					; FCOMP - COMPARE 0FFFFH TO TOS
 4009:					;
 4010:					;*************************************************************
 4011:					;
 4012:	  11EB	91 15		FCMP:	ACALL	CSTAKA		;COPY THE STACK
 4013:	  11ED	71 B4			ACALL	FSTK		;MAKE THE TOS = 0FFFFH
 4014:	  11EF	91 43			ACALL	SWAP_ASTKA	;NOW COMPARE IS 0FFFFH - X
 4015:					;
 4016:	  11F1	02 19 97	CMPLK:	JMP	FP_BASE+4	;DO THE COMPARE
 4017:					;
 4018:					;*************************************************************
 4019:					;
 4020:	  11F4			DEC_ASTKA:	;Push ARG STACK and check for underflow
 4021:					;
 4022:					;*************************************************************
 4023:					;
 4024:	  11F4	74 FA			MOV	A,#-FPSIZ
 4025:	  11F6	25 09			ADD	A,ASTKA
 4026:	  11F8	B4 32 00		CJNE	A,#LOW TM_TOP+6,$+3
 4027:	  11FB	40 06			JC	E4YY
 4028:	  11FD	F5 09			MOV	ASTKA,A
 4029:	  11FF	F9			MOV	R1,A
 4030:	  1200	7B 01			MOV	R3,#ASTKAH
 4031:					;
 4032:	  1202	22		SRT:	RET
 4033:					;
 4034:	  1203	90 03 77	E4YY:	MOV	DPTR,#EXA
 4035:	  1206	01 2E			AJMP	FPTS		;ARG STACK ERROR
 4036:					;
 4037:					;
 4038:	  1208	91 1C		AXTAL3:	ACALL	PUSHC		;PUSH CONSTANT, THEN MULTIPLY
 4039:	  120A	31 99			ACALL	AMUL
 4040:					;
 4041:					; Fall thru to IFIX
 4042:					;
 4043:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 98



 Line  I  Addr  Code            Source

 4044:					;***************************************************************
 4045:					;
 4046:	  120C			IFIX:	; Convert a floating point number to an integer, put in R3:R1
 4047:					;
 4048:					;***************************************************************
 4049:					;
 4050:	  120C	E4			CLR	A		;RESET THE START
 4051:	  120D	FB			MOV	R3,A
 4052:	  120E	F9			MOV	R1,A
 4053:	  120F	A8 09			MOV	R0,ASTKA	;GET THE ARG STACK
 4054:	  1211	75 A0 01		MOV	P2,#ASTKAH
 4055:	  1214	E2			MOVX	A,@R0		;READ EXPONENT
 4056:	  1215	C3			CLR	C
 4057:	  1216	94 81			SUBB	A,#81H		;BASE EXPONENT
 4058:	  1218	FC			MOV	R4,A		;SAVE IT
 4059:	  1219	18			DEC	R0		;POINT AT SIGN
 4060:	  121A	E2			MOVX	A,@R0		;GET THE SIGN
 4061:	  121B	70 56			JNZ	SQ_ERR		;ERROR IF NEGATIVE
 4062:	  121D	40 19			JC	INC_ASTKA	;EXIT IF EXPONENT IS < 81H
 4063:	  121F	0C			INC	R4		;ADJUST LOOP COUNTER
 4064:	  1220	E8			MOV	A,R0		;BUMP THE POINTER REGISTER
 4065:	  1221	94 05			SUBB	A,#FPSIZ-1
 4066:	  1223	F8			MOV	R0,A
 4067:					;
 4068:	  1224	08		I2:	INC	R0		;POINT AT DIGIT
 4069:	  1225	E2			MOVX	A,@R0		;GET DIGIT
 4070:	  1226	C4			SWAP	A		;FLIP
 4071:	  1227	12 19 A7		CALL	FP_BASE+20	;ACCUMULATE
 4072:	  122A	40 47			JC	SQ_ERR
 4073:	  122C	DC 02			DJNZ	R4,$+4
 4074:	  122E	80 08			SJMP	INC_ASTKA
 4075:	  1230	E2			MOVX	A,@R0		;GET DIGIT
 4076:	  1231	12 19 A7		CALL	FP_BASE+20
 4077:	  1234	40 3D			JC	SQ_ERR
 4078:	  1236	DC EC			DJNZ	R4,I2
 4079:					;
 4080:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 99



 Line  I  Addr  Code            Source

 4081:					;************************************************************
 4082:					;
 4083:	  1238			INC_ASTKA:	; Pop the ARG STACK and check for overflow
 4084:					;
 4085:					;************************************************************
 4086:					;
 4087:	  1238	74 06			MOV	A,#FPSIZ	;NUMBER TO POP
 4088:	  123A	80 01			SJMP	SETREG+1
 4089:					;
 4090:	  123C	E4		SETREG:	CLR	A		;DON'T POP ANYTHING
 4091:	  123D	A8 09			MOV	R0,ASTKA
 4092:	  123F	7A 01			MOV	R2,#ASTKAH
 4093:	  1241	8A A0			MOV	P2,R2
 4094:	  1243	28			ADD	A,R0
 4095:	  1244	40 BD			JC	E4YY
 4096:	  1246	F5 09			MOV	ASTKA,A
 4097:	  1248	E2			MOVX	A,@R0
 4098:	  1249	22		A_D:	RET
 4099:					;
 4100:					;************************************************************
 4101:					;
 4102:					; EBIAS - Bias a number for E to the X calculations
 4103:					;
 4104:					;************************************************************
 4105:					;
 4106:	  124A	91 2C		EBIAS:	ACALL	PUSH_ONE
 4107:	  124C	31 9E			ACALL	RV
 4108:	  124E	BB 00 22		CJNE	R3,#00H,SQ_ERR	;ERROR IF R3 <> 0
 4109:	  1251	91 55			ACALL	C_T2		;TEMP 2 GETS FRACTIONS
 4110:	  1253	51 38			ACALL	INC_ASTKA
 4111:	  1255	91 31			ACALL	POP_T1
 4112:	  1257	91 2C			ACALL	PUSH_ONE
 4113:					;
 4114:	  1259	E5 46		AELP:	MOV	A,MT2
 4115:	  125B	70 0E			JNZ	AEL1
 4116:					;
 4117:	  125D	E5 45			MOV	A,MT1
 4118:	  125F	60 E8			JZ	A_D
 4119:	  1261	90 01 1E		MOV	DPTR,#FPT2-1
 4120:	  1264	F0			MOVX	@DPTR,A		;MAKE THE FRACTIONS NEGATIVE
 4121:					;
 4122:	  1265	91 2C		RECIP:	ACALL	PUSH_ONE
 4123:	  1267	91 43			ACALL	SWAP_ASTKA
 4124:	  1269	61 F3			AJMP	ADIV
 4125:					;
 4126:	  126B	15 46		AEL1:	DEC	MT2
 4127:	  126D	91 38			ACALL	PUSH_T1
 4128:	  126F	31 99			ACALL	AMUL
 4129:	  1271	80 E6			SJMP	AELP
 4130:					;
 4131:	  1273	02 09 BE	SQ_ERR:	LJMP	E3XX		;LINK TO BAD ARG
 4132:					;
 4133:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 100



 Line  I  Addr  Code            Source

 4134:					;************************************************************
 4135:					;
 4136:					; SQUARE ROOT
 4137:					;
 4138:					;************************************************************
 4139:					;
 4140:	  1276	71 78		ASQR:	ACALL	AABS		;GET THE SIGN
 4141:	  1278	70 F9			JNZ	SQ_ERR		;ERROR IF NEGATIVE
 4142:	  127A	91 55			ACALL	C_T2		;COPY VARIABLE TO T2
 4143:	  127C	91 31			ACALL	POP_T1		;SAVE IT IN T1
 4144:	  127E	78 19			MOV	R0,#LOW FPT1
 4145:	  1280	E2			MOVX	A,@R0		;GET EXPONENT
 4146:	  1281	60 24			JZ	ALN-2		;EXIT IF ZERO
 4147:	  1283	24 80			ADD	A,#128		;BIAS THE EXPONENT
 4148:	  1285	50 05			JNC	SQR1		;SEE IF < 80H
 4149:	  1287	03			RR	A
 4150:	  1288	54 7F			ANL	A,#127
 4151:	  128A	80 07			SJMP	SQR2
 4152:					;
 4153:	  128C	F4		SQR1:	CPL	A		;FLIP BITS
 4154:	  128D	04			INC	A
 4155:	  128E	03			RR	A
 4156:	  128F	54 7F			ANL	A,#127		;STRIP MSB
 4157:	  1291	F4			CPL	A
 4158:	  1292	04			INC	A
 4159:					;
 4160:	  1293	24 80		SQR2:	ADD	A,#128		;BIAS EXPONENT
 4161:	  1295	F2			MOVX	@R0,A		;SAVE IT
 4162:					;
 4163:					; NEWGUESS = ( X/OLDGUESS + OLDGUESS) / 2
 4164:					;
 4165:	  1296	91 3F		SQR4:	ACALL	P_T2		;TOS = X
 4166:	  1298	91 38			ACALL	PUSH_T1		;PUT NUMBER ON STACK
 4167:	  129A	71 F3			ACALL	ADIV		;TOS = X/GUESS
 4168:	  129C	91 38			ACALL	PUSH_T1		;PUT ON AGAIN
 4169:	  129E	F1 36			ACALL	AADD		;TOS = X/GUESS + GUESS
 4170:	  12A0	31 7D			ACALL	DBTWO		;TOS = ( X/GUESS + GUESS ) / 2
 4171:	  12A2	71 05			ACALL	TEMP_COMP	;SEE IF DONE
 4172:	  12A4	30 D5 EF		JNB	F0,SQR4
 4173:					;
 4174:	  12A7	81 38			AJMP	PUSH_T1		;PUT THE ANSWER ON THE STACK
 4175:					;
 4176:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 101



 Line  I  Addr  Code            Source

 4177:					;*************************************************************
 4178:					;
 4179:					; NATURAL LOG
 4180:					;
 4181:					;*************************************************************
 4182:					;
 4183:	  12A9	71 78		ALN:	ACALL	AABS		;MAKE SURE THAT NUM IS POSITIVE
 4184:	  12AB	70 C6			JNZ	SQ_ERR		;ERROR IF NOT
 4185:	  12AD	F5 46			MOV	MT2,A		;CLEAR FOR LOOP
 4186:	  12AF	08			INC	R0		;POINT AT EXPONENT
 4187:	  12B0	E2			MOVX	A,@R0		;READ THE EXPONENT
 4188:	  12B1	60 C0			JZ	SQ_ERR		;ERROR IF EXPONENT IS ZERO
 4189:	  12B3	B4 81 00		CJNE	A,#81H,$+3	;SEE IF NUM >= 1
 4190:	  12B6	92 2A			MOV	UBIT,C		;SAVE CARRY STATUS
 4191:	  12B8	40 02			JC	$+4		;TAKE RECIP IF >= 1
 4192:	  12BA	51 65			ACALL	RECIP
 4193:					;
 4194:					; Loop to reduce
 4195:					;
 4196:	  12BC	91 15		ALNL:	ACALL	CSTAKA		;COPY THE STACK FOR COMPARE
 4197:	  12BE	91 2C			ACALL	PUSH_ONE	;COMPARE NUM TO ONE
 4198:	  12C0	31 F1			ACALL	CMPLK
 4199:	  12C2	50 1D			JNC	ALNO		;EXIT IF DONE
 4200:	  12C4	51 3C			ACALL	SETREG		;GET THE EXPONENT
 4201:	  12C6	24 85			ADD	A,#85H		;SEE HOW BIG IT IS
 4202:	  12C8	50 0E			JNC	ALN11		;BUMP BY EXP(11) IF TOO SMALL
 4203:	  12CA	91 19			ACALL	PLNEXP		;PUT EXP(1) ON STACK
 4204:	  12CC	74 01			MOV	A,#1		;BUMP COUNT
 4205:					;
 4206:	  12CE	25 46		ALNE:	ADD	A,MT2
 4207:	  12D0	40 A1			JC	SQ_ERR
 4208:	  12D2	F5 46			MOV	MT2,A
 4209:	  12D4	31 99			ACALL	AMUL		;BIAS THE NUMBER
 4210:	  12D6	80 E4			SJMP	ALNL
 4211:					;
 4212:	  12D8	90 17 E4	ALN11:	MOV	DPTR,#EXP11	;PUT EXP(11) ON STACK
 4213:	  12DB	91 1C			ACALL	PUSHC
 4214:	  12DD	74 0B			MOV	A,#11
 4215:	  12DF	80 ED			SJMP	ALNE
 4216:					;
 4217:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 102



 Line  I  Addr  Code            Source

 4218:	  12E1	91 55		ALNO:	ACALL	C_T2		;PUT NUM IN TEMP 2
 4219:	  12E3	91 2C			ACALL	PUSH_ONE	;TOS = 1
 4220:	  12E5	F1 11			ACALL	ASUB		;TOS = X - 1
 4221:	  12E7	91 3F			ACALL	P_T2		;TOS = X
 4222:	  12E9	91 2C			ACALL	PUSH_ONE	;TOS = 1
 4223:	  12EB	F1 36			ACALL	AADD		;TOS = X + 1
 4224:	  12ED	71 F3			ACALL	ADIV		;TOS = (X-1)/(X+1)
 4225:	  12EF	90 16 9E		MOV	DPTR,#LNTAB	;LOG TABLE
 4226:	  12F2	31 84			ACALL	POLYC
 4227:	  12F4	A3			INC	DPTR		;POINT AT LN(10)
 4228:	  12F5	91 1C			ACALL	PUSHC
 4229:	  12F7	31 99			ACALL	AMUL
 4230:	  12F9	E5 46			MOV	A,MT2		;GET THE COUNT
 4231:	  12FB	91 9A			ACALL	TWO_R2		;PUT IT ON THE STACK
 4232:	  12FD	F1 11			ACALL	ASUB		;INT - POLY
 4233:	  12FF	31 C3			ACALL	STRIP
 4234:	  1301	30 2A 74		JNB	UBIT,AABS
 4235:					;
 4236:	  1304	22		LN_D:	RET
 4237:					;
 4238:					;*************************************************************
 4239:					;
 4240:	  1305			TEMP_COMP:	; Compare FPTEMP1 to TOS, FPTEMP1 gets TOS
 4241:					;
 4242:					;*************************************************************
 4243:					;
 4244:	  1305	91 38			ACALL	PUSH_T1		;SAVE THE TEMP
 4245:	  1307	91 43			ACALL	SWAP_ASTKA	;TRADE WITH THE NEXT NUMBER
 4246:	  1309	91 15			ACALL	CSTAKA		;COPY THE STACK
 4247:	  130B	91 31			ACALL	POP_T1		;SAVE THE NEW NUMBER
 4248:	  130D	02 19 97		JMP	FP_BASE+4	;DO THE COMPARE
 4249:					;
 4250:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 103



 Line  I  Addr  Code            Source

 4251:	  1310	91 19		AETOX:	ACALL	PLNEXP		;EXP(1) ON TOS
 4252:	  1312	91 43			ACALL	SWAP_ASTKA	;X ON TOS
 4253:					;
 4254:	  1314			AEXP:	;EXPONENTIATION
 4255:					;
 4256:	  1314	51 4A			ACALL	EBIAS		;T1=BASE,T2=FRACTIONS,TOS=INT MULTIPLIED
 4257:	  1316	90 01 1F		MOV	DPTR,#FPT2	;POINT AT FRACTIONS
 4258:	  1319	E0			MOVX	A,@DPTR		;READ THE EXP OF THE FRACTIONS
 4259:	  131A	60 E8			JZ	LN_D		;EXIT IF ZERO
 4260:	  131C	91 3F			ACALL	P_T2		;TOS = FRACTIONS
 4261:	  131E	91 38			ACALL	PUSH_T1		;TOS = BASE
 4262:	  1320	51 3C			ACALL	SETREG		;SEE IF BASE IS ZERO
 4263:	  1322	60 02			JZ	$+4
 4264:	  1324	51 A9			ACALL	ALN		;TOS = LN(BASE)
 4265:	  1326	31 99			ACALL	AMUL		;TOS = FRACTIONS * LN(BASE)
 4266:	  1328	91 19			ACALL	PLNEXP		;TOS = EXP(1)
 4267:	  132A	91 43			ACALL	SWAP_ASTKA	;TOS = FRACTIONS * LN(BASE)
 4268:	  132C	51 4A			ACALL	EBIAS		;T2 = FRACTIONS, TOS = INT MULTIPLIED
 4269:	  132E	75 46 00		MOV	MT2,#00H	;NOW CALCULATE E**X
 4270:	  1331	91 2C			ACALL	PUSH_ONE
 4271:	  1333	91 15			ACALL	CSTAKA
 4272:	  1335	91 31			ACALL	POP_T1		;T1 = 1
 4273:					;
 4274:	  1337	91 3F		AEXL:	ACALL	P_T2		;TOS = FRACTIONS
 4275:	  1339	31 99			ACALL	AMUL		;TOS = FRACTIONS * ACCUMLATION
 4276:	  133B	05 46			INC	MT2		;DO THE DEMONIATOR
 4277:	  133D	E5 46			MOV	A,MT2
 4278:	  133F	91 9A			ACALL	TWO_R2
 4279:	  1341	71 F3			ACALL	ADIV
 4280:	  1343	91 15			ACALL	CSTAKA		;SAVE THE ITERATION
 4281:	  1345	91 38			ACALL	PUSH_T1		;NOW ACCUMLATE
 4282:	  1347	F1 36			ACALL	AADD		;ADD ACCUMLATION
 4283:	  1349	71 05			ACALL	TEMP_COMP
 4284:	  134B	30 D5 E9		JNB	F0,AEXL		;LOOP UNTIL DONE
 4285:					;
 4286:	  134E	51 38			ACALL	INC_ASTKA
 4287:	  1350	91 38			ACALL	PUSH_T1
 4288:	  1352	31 99			ACALL	AMUL		;LAST INT MULTIPLIED
 4289:					;
 4290:	  1354	21 99		MU1:	AJMP	AMUL		;FIRST INT MULTIPLIED
 4291:					;
 4292:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 104



 Line  I  Addr  Code            Source

 4293:					;***************************************************************
 4294:					;
 4295:					; integer operator - INT
 4296:					;
 4297:					;***************************************************************
 4298:					;
 4299:	  1356	51 3C		AINT:	ACALL	SETREG		;SET UP THE REGISTERS, CLEAR CARRY
 4300:	  1358	94 81			SUBB	A,#129		;SUBTRACT EXPONENT BIAS
 4301:	  135A	50 07			JNC	AI1		;JUMP IF ACC > 81H
 4302:					;
 4303:					; Force the number to be a zero
 4304:					;
 4305:	  135C	51 38			ACALL	INC_ASTKA	;BUMP THE STACK
 4306:					;
 4307:	  135E	90 04 E0	P_Z:	MOV	DPTR,#ZRO	;PUT ZERO ON THE STACK
 4308:	  1361	81 1C			AJMP	PUSHC
 4309:					;
 4310:	  1363	94 07		AI1:	SUBB	A,#7
 4311:	  1365	50 10			JNC	AI3
 4312:	  1367	F4			CPL	A
 4313:	  1368	04			INC	A
 4314:	  1369	FB			MOV	R3,A
 4315:	  136A	18			DEC	R0		;POINT AT SIGN
 4316:					;
 4317:	  136B	18		AI2:	DEC	R0		;NOW AT LSB'S
 4318:	  136C	E2			MOVX	A,@R0		;READ BYTE
 4319:	  136D	54 F0			ANL	A,#0F0H		;STRIP NIBBLE
 4320:	  136F	F2			MOVX	@R0,A		;WRITE BYTE
 4321:	  1370	DB 01			DJNZ	R3,$+3
 4322:	  1372	22			RET
 4323:	  1373	E4			CLR	A
 4324:	  1374	F2			MOVX	@R0,A		;CLEAR THE LOCATION
 4325:	  1375	DB F4			DJNZ	R3,AI2
 4326:					;
 4327:	  1377	22		AI3:	RET			;EXIT
 4328:					;
 4329:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 105



 Line  I  Addr  Code            Source

 4330:					;***************************************************************
 4331:					;
 4332:	  1378			AABS:	; Absolute value - Make sign of number positive
 4333:					;                  return sign in ACC
 4334:					;
 4335:					;***************************************************************
 4336:					;
 4337:	  1378	71 8A			ACALL	ANEG		;CHECK TO SEE IF + OR -
 4338:	  137A	70 19			JNZ	ALPAR		;EXIT IF NON ZERO, BECAUSE THE NUM IS
 4339:	  137C	F2			MOVX	@R0,A		;MAKE A POSITIVE SIGN
 4340:	  137D	22			RET
 4341:					;
 4342:					;***************************************************************
 4343:					;
 4344:	  137E			ASGN:	; Returns the sign of the number 1 = +, -1 = -
 4345:					;
 4346:					;***************************************************************
 4347:					;
 4348:	  137E	51 38			ACALL	INC_ASTKA	;POP STACK, GET EXPONENT
 4349:	  1380	60 DC			JZ	P_Z		;EXIT IF ZERO
 4350:	  1382	18			DEC	R0		;BUMP TO SIGN
 4351:	  1383	E2			MOVX	A,@R0		;GET THE SIGN
 4352:	  1384	FF			MOV	R7,A		;SAVE THE SIGN
 4353:	  1385	91 2C			ACALL	PUSH_ONE	;PUT A ONE ON THE STACK
 4354:	  1387	EF			MOV	A,R7		;GET THE SIGN
 4355:	  1388	60 0B			JZ	ALPAR		;EXIT IF ZERO
 4356:					;
 4357:					; Fall thru to ANEG
 4358:					;
 4359:					;***************************************************************
 4360:					;
 4361:	  138A			ANEG:	; Flip the sign of the number on the tos
 4362:					;
 4363:					;***************************************************************
 4364:					;
 4365:	  138A	51 3C			ACALL	SETREG
 4366:	  138C	18			DEC	R0		;POINT AT THE SIGN OF THE NUMBER
 4367:	  138D	60 06			JZ	ALPAR		;EXIT IF ZERO
 4368:	  138F	E2			MOVX	A,@R0
 4369:	  1390	64 01			XRL	A,#01H		;FLIP THE SIGN
 4370:	  1392	F2			MOVX	@R0,A
 4371:	  1393	64 01			XRL	A,#01H		;RESTORE THE SIGN
 4372:					;
 4373:	  1395	22		ALPAR:	RET
 4374:					;
 4375:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 106



 Line  I  Addr  Code            Source

 4376:					;***************************************************************
 4377:					;
 4378:	  1396			ACBYTE:	; Read the ROM
 4379:					;
 4380:					;***************************************************************
 4381:					;
 4382:	  1396	51 0C			ACALL	IFIX		;GET EXPRESSION
 4383:	  1398	12 05 71		CALL	X31DP		;PUT R3:R1 INTO THE DP
 4384:	  139B	E4			CLR	A
 4385:	  139C	93			MOVC	A,@A+DPTR
 4386:	  139D	81 9A			AJMP	TWO_R2
 4387:					;
 4388:					;***************************************************************
 4389:					;
 4390:	  139F			ADBYTE:	; Read internal memory
 4391:					;
 4392:					;***************************************************************
 4393:					;
 4394:	  139F	51 0C			ACALL	IFIX		;GET THE EXPRESSION
 4395:	  13A1	12 09 D6		CALL	R3CK		;MAKE SURE R3 = 0
 4396:	  13A4	E7			MOV	A,@R1
 4397:	  13A5	81 9A			AJMP	TWO_R2
 4398:					;
 4399:					;***************************************************************
 4400:					;
 4401:	  13A7			AXBYTE: ; Read external memory
 4402:					;
 4403:					;***************************************************************
 4404:					;
 4405:	  13A7	51 0C			ACALL	IFIX		;GET THE EXPRESSION
 4406:	  13A9	8B A0			MOV	P2,R3
 4407:	  13AB	E3			MOVX	A,@R1
 4408:	  13AC	81 9A			AJMP	TWO_R2
 4409:					;
 4410:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 107



 Line  I  Addr  Code            Source

 4411:					;***************************************************************
 4412:					;
 4413:					; The relational operators - EQUAL                        (=)
 4414:					;                            GREATER THAN                 (>)
 4415:					;                            LESS THAN                    (<)
 4416:					;                            GREATER THAN OR EQUAL        (>=)
 4417:					;                            LESS THAN OR EQUAL           (<=)
 4418:					;                            NOT EQUAL                    (<>)
 4419:					;
 4420:					;***************************************************************
 4421:					;
 4422:	  13AE	31 F1		AGT:	ACALL	CMPLK
 4423:	  13B0	72 D5			ORL	C,F0		;SEE IF EITHER IS A ONE
 4424:	  13B2	40 AA			JC	P_Z
 4425:					;
 4426:	  13B4	90 13 B9	FSTK:	MOV	DPTR,#FS
 4427:	  13B7	81 1C			AJMP	PUSHC
 4428:					;
 4429:	  13B9	85		FS:	DB	85H
 4430:	  13BA	00			DB	00H
 4431:	  13BB	00			DB	00H
 4432:	  13BC	50			DB	50H
 4433:	  13BD	53			DB	53H
 4434:	  13BE	65			DB	65H
 4435:					;
 4436:	  13BF	31 F1		ALT:	ACALL	CMPLK
 4437:	  13C1	B3			CPL	C
 4438:	  13C2	80 EE			SJMP	AGT+4
 4439:					;
 4440:	  13C4	31 F1		AEQ:	ACALL	CMPLK
 4441:	  13C6	A2 D5			MOV	C,F0
 4442:	  13C8	80 F7			SJMP	ALT+2
 4443:					;
 4444:	  13CA	31 F1		ANE:	ACALL	CMPLK
 4445:	  13CC	B2 D5			CPL	F0
 4446:	  13CE	80 F6			SJMP	AEQ+2
 4447:					;
 4448:	  13D0	31 F1		AGE:	ACALL	CMPLK
 4449:	  13D2	80 DE			SJMP	AGT+4
 4450:					;
 4451:	  13D4	31 F1		ALE:	ACALL	CMPLK
 4452:	  13D6	72 D5			ORL	C,F0
 4453:	  13D8	80 E7			SJMP	ALT+2
 4454:					;
 4455:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 108



 Line  I  Addr  Code            Source

 4456:					;***************************************************************
 4457:					;
 4458:	  13DA			ARND:	; Generate a random number
 4459:					;
 4460:					;***************************************************************
 4461:					;
 4462:	  13DA	90 01 0C		MOV	DPTR,#RCELL	;GET THE BINARY SEED
 4463:	  13DD	12 05 B2		CALL	L31DPI
 4464:	  13E0	E9			MOV	A,R1
 4465:	  13E1	C3			CLR	C
 4466:	  13E2	13			RRC	A
 4467:	  13E3	F8			MOV	R0,A
 4468:	  13E4	74 06			MOV	A,#6
 4469:	  13E6	13			RRC	A
 4470:	  13E7	29			ADD	A,R1
 4471:	  13E8	C8			XCH	A,R0
 4472:	  13E9	3B			ADDC	A,R3
 4473:	  13EA	FA			MOV	R2,A
 4474:	  13EB	15 82			DEC	DPL		;SAVE THE NEW SEED
 4475:	  13ED	91 0D			ACALL	S20DP
 4476:	  13EF	91 9D			ACALL	TWO_EY
 4477:	  13F1	71 B4			ACALL	FSTK
 4478:					;
 4479:	  13F3	12 19 9B	ADIV:	LCALL	FP_BASE+8
 4480:	  13F6	01 1B			AJMP	FPTST
 4481:					;
 4482:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 109



 Line  I  Addr  Code            Source

 4483:					;***************************************************************
 4484:					;
 4485:	  13F8			SONERR:	; ON ERROR Statement
 4486:					;
 4487:					;***************************************************************
 4488:					;
 4489:	  13F8	12 0F 31		LCALL	INTERR		;GET THE LINE NUMBER
 4490:	  13FB	D2 13			SETB	ON_ERR
 4491:	  13FD	90 01 02		MOV	DPTR,#ERRNUM	;POINT AT THR ERROR LOCATION
 4492:	  1400	80 0B			SJMP	S20DP
 4493:					;
 4494:					;
 4495:					;**************************************************************
 4496:					;
 4497:	  1402			SONEXT:	; ON EXT1 Statement
 4498:					;
 4499:					;**************************************************************
 4500:					;
 4501:	  1402	12 0F 31		LCALL	INTERR
 4502:	  1405	D2 12			SETB	INTBIT
 4503:	  1407	43 A8 84		ORL	IE,#10000100B	;ENABLE INTERRUPTS
 4504:	  140A	90 01 20		MOV	DPTR,#INTLOC
 4505:					;
 4506:	  140D	EA		S20DP:	MOV	A,R2		;SAVE R2:R0 @DPTR
 4507:	  140E	F0			MOVX	@DPTR,A
 4508:	  140F	A3			INC	DPTR
 4509:	  1410	E8			MOV	A,R0
 4510:	  1411	F0			MOVX	@DPTR,A
 4511:	  1412	22			RET
 4512:					;
 4513:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 110



 Line  I  Addr  Code            Source

 4514:					;***************************************************************
 4515:					;
 4516:					; CASTAK - Copy and push another top of arg stack
 4517:					;
 4518:					;***************************************************************
 4519:					;
 4520:	  1413	91 15		CSTAKA2:ACALL	CSTAKA		;COPY STACK TWICE
 4521:					;
 4522:	  1415	51 3C		CSTAKA:	ACALL	SETREG		;SET UP R2:R0
 4523:	  1417	80 23			SJMP	PUSH_T1+4
 4524:					;
 4525:	  1419	90 17 EA	PLNEXP:	MOV	DPTR,#EXP1
 4526:					;
 4527:					;***************************************************************
 4528:					;
 4529:					; PUSHC - Push constant on to the arg stack
 4530:					;
 4531:					;***************************************************************
 4532:					;
 4533:	  141C	31 F4		PUSHC:	ACALL	DEC_ASTKA
 4534:	  141E	8B A0			MOV	P2,R3
 4535:	  1420	7B 06			MOV	R3,#FPSIZ	;LOOP COUNTER
 4536:					;
 4537:	  1422	E4		PCL:	CLR	A		;SET UP A
 4538:	  1423	93			MOVC	A,@A+DPTR	;LOAD IT
 4539:	  1424	F3			MOVX	@R1,A		;SAVE IT
 4540:	  1425	A3			INC	DPTR		;BUMP POINTERS
 4541:	  1426	19			DEC	R1
 4542:	  1427	DB F9			DJNZ	R3,PCL		;LOOP
 4543:					;
 4544:	  1429	D2 24			SETB	ARGF
 4545:	  142B	22			RET			;EXIT
 4546:					;
 4547:	  142C			PUSH_ONE:;
 4548:					;
 4549:	  142C	90 16 E7		MOV	DPTR,#FPONE
 4550:	  142F	81 1C			AJMP	PUSHC
 4551:					;
 4552:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 111



 Line  I  Addr  Code            Source

 4553:					;
 4554:	  1431			POP_T1:
 4555:					;
 4556:	  1431	7B 01			MOV	R3,#HIGH FPT1
 4557:	  1433	79 19			MOV	R1,#LOW FPT1
 4558:	  1435	02 0F D4		JMP	POPAS
 4559:					;
 4560:	  1438			PUSH_T1:
 4561:					;
 4562:	  1438	78 19			MOV	R0,#LOW FPT1
 4563:	  143A	7A 01			MOV	R2,#HIGH FPT1
 4564:	  143C	02 0F DE		LJMP	PUSHAS
 4565:					;
 4566:	  143F	78 1F		P_T2:	MOV	R0,#LOW FPT2
 4567:	  1441	80 F7			SJMP	$-7			;JUMP TO PUSHAS
 4568:					;
 4569:					;****************************************************************
 4570:					;
 4571:	  1443			SWAP_ASTKA:	; SWAP TOS<>TOS-1
 4572:					;
 4573:					;****************************************************************
 4574:					;
 4575:	  1443	51 3C			ACALL	SETREG		;SET UP R2:R0 AND P2
 4576:	  1445	74 06			MOV	A,#FPSIZ	;PUT TOS+1 IN R1
 4577:	  1447	FA			MOV	R2,A
 4578:	  1448	28			ADD	A,R0
 4579:	  1449	F9			MOV	R1,A
 4580:					;
 4581:	  144A	E2		S_L:	MOVX	A,@R0
 4582:	  144B	FB			MOV	R3,A
 4583:	  144C	E3			MOVX	A,@R1
 4584:	  144D	F2			MOVX	@R0,A
 4585:	  144E	EB			MOV	A,R3
 4586:	  144F	F3			MOVX	@R1,A
 4587:	  1450	19			DEC	R1
 4588:	  1451	18			DEC	R0
 4589:	  1452	DA F6			DJNZ	R2,S_L
 4590:	  1454	22			RET
 4591:					;
 4592:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 112



 Line  I  Addr  Code            Source

 4593:					;
 4594:	  1455	51 3C		C_T2:	ACALL	SETREG		;SET UP R2:R0
 4595:	  1457	7B 01			MOV	R3,#HIGH FPT2
 4596:	  1459	79 1F			MOV	R1,#LOW FPT2	;TEMP VALUE
 4597:					;
 4598:					; Fall thru
 4599:					;
 4600:					;***************************************************************
 4601:					;
 4602:					; VARCOP - Copy a variable from R2:R0 to R3:R1
 4603:					;
 4604:					;***************************************************************
 4605:					;
 4606:	  145B	7C 06		VARCOP:	MOV	R4,#FPSIZ	;LOAD THE LOOP COUNTER
 4607:					;
 4608:	  145D	8A A0		V_C:	MOV	P2,R2		;SET UP THE PORTS
 4609:	  145F	E2			MOVX	A,@R0		;READ THE VALUE
 4610:	  1460	8B A0			MOV	P2,R3		;PORT TIME AGAIN
 4611:	  1462	F3			MOVX	@R1,A		;SAVE IT
 4612:	  1463	B1 74			ACALL	DEC3210		;BUMP POINTERS
 4613:	  1465	DC F6			DJNZ	R4,V_C		;LOOP
 4614:	  1467	22			RET			;EXIT
 4615:					;
 4616:	  1468	90 17 F6	PIPI:	MOV	DPTR,#PIE
 4617:	  146B	81 1C			AJMP	PUSHC
 4618:					;
 4619:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 113



 Line  I  Addr  Code            Source

 4620:					;***************************************************************
 4621:					;
 4622:					; The logical operators ANL, ORL, XRL, NOT
 4623:					;
 4624:					;***************************************************************
 4625:					;
 4626:	  146D	91 8A		AANL:	ACALL	TWOL		;GET THE EXPRESSIONS
 4627:	  146F	EB			MOV	A,R3		;DO THE AND
 4628:	  1470	5F			ANL	A,R7
 4629:	  1471	FA			MOV	R2,A
 4630:	  1472	E9			MOV	A,R1
 4631:	  1473	5E			ANL	A,R6
 4632:	  1474	80 26			SJMP	TWO_EX
 4633:					;
 4634:	  1476	91 8A		AORL:	ACALL	TWOL		;SAME THING FOR OR
 4635:	  1478	EB			MOV	A,R3
 4636:	  1479	4F			ORL	A,R7
 4637:	  147A	FA			MOV	R2,A
 4638:	  147B	E9			MOV	A,R1
 4639:	  147C	4E			ORL	A,R6
 4640:	  147D	80 1D			SJMP	TWO_EX
 4641:					;
 4642:	  147F	71 B4		ANOT:	ACALL	FSTK		;PUT 0FFFFH ON THE STACK
 4643:					;
 4644:	  1481	91 8A		AXRL:	ACALL	TWOL
 4645:	  1483	EB			MOV	A,R3
 4646:	  1484	6F			XRL	A,R7
 4647:	  1485	FA			MOV	R2,A
 4648:	  1486	E9			MOV	A,R1
 4649:	  1487	6E			XRL	A,R6
 4650:	  1488	80 12			SJMP	TWO_EX
 4651:					;
 4652:	  148A	51 0C		TWOL:	ACALL	IFIX
 4653:	  148C	AF 03			MOV	R7,R3B0
 4654:	  148E	AE 01			MOV	R6,R1B0
 4655:	  1490	41 0C			AJMP	IFIX
 4656:					;
 4657:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 114



 Line  I  Addr  Code            Source

 4658:					;*************************************************************
 4659:					;
 4660:	  1492			AGET:	; READ THE BREAK BYTE AND PUT IT ON THE ARG STACK
 4661:					;
 4662:					;*************************************************************
 4663:					;
 4664:	  1492	90 01 00		MOV	DPTR,#GTB	;GET THE BREAK BYTE
 4665:	  1495	E0			MOVX	A,@DPTR
 4666:	  1496	10 18 01		JBC	GTRD,TWO_R2
 4667:	  1499	E4			CLR	A
 4668:					;
 4669:	  149A	7A 00		TWO_R2:	MOV	R2,#00H		;ACC GOES TO STACK
 4670:					;
 4671:					;
 4672:	  149C	F8		TWO_EX:	MOV	R0,A		;R2:ACC GOES TO STACK
 4673:					;
 4674:					;
 4675:	  149D	D2 24		TWO_EY:	SETB	ARGF		;R2:R0 GETS PUT ON THE STACK
 4676:	  149F	02 19 AB		JMP	FP_BASE+24	;DO IT
 4677:					;
 4678:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 115



 Line  I  Addr  Code            Source

 4679:					;*************************************************************
 4680:					;
 4681:					; Put directs onto the stack
 4682:					;
 4683:					;**************************************************************
 4684:					;
 4685:	  14A2	E5 A8		A_IE:	MOV	A,IE		;IE
 4686:	  14A4	80 F4			SJMP	TWO_R2
 4687:					;
 4688:	  14A6	E5 B8		A_IP:	MOV	A,IP		;IP
 4689:	  14A8	80 F0			SJMP	TWO_R2
 4690:					;
 4691:	  14AA	AA 8C		ATIM0:	MOV	R2,TH0		;TIMER 0
 4692:	  14AC	A8 8A			MOV	R0,TL0
 4693:	  14AE	80 ED			SJMP	TWO_EY
 4694:					;
 4695:	  14B0	AA 8D		ATIM1:	MOV	R2,TH1		;TIMER 1
 4696:	  14B2	A8 8B			MOV	R0,TL1
 4697:	  14B4	80 E7			SJMP	TWO_EY
 4698:					;
 4699:	  14B6	AA		ATIM2:	DB	0AAH		;MOV R2 DIRECT OP CODE
 4700:	  14B7	CD			DB	0CDH		;T2 HIGH
 4701:	  14B8	A8			DB	0A8H		;MOV R0 DIRECT OP CODE
 4702:	  14B9	CC			DB	0CCH		;T2 LOW
 4703:	  14BA	80 E1			SJMP	TWO_EY		;TIMER 2
 4704:					;
 4705:	  14BC	E5		AT2CON:	DB	0E5H		;MOV A,DIRECT OPCODE
 4706:	  14BD	C8			DB	0C8H		;T2CON LOCATION
 4707:	  14BE	80 DA			SJMP	TWO_R2
 4708:					;
 4709:	  14C0	E5 88		ATCON:	MOV	A,TCON		;TCON
 4710:	  14C2	80 D6			SJMP	TWO_R2
 4711:					;
 4712:	  14C4	E5 89		ATMOD:	MOV	A,TMOD		;TMOD
 4713:	  14C6	80 D2			SJMP	TWO_R2
 4714:					;
 4715:	  14C8	AA		ARCAP2:	DB	0AAH		;MOV R2, DIRECT OP CODE
 4716:	  14C9	CB			DB	0CBH		;RCAP2H LOCATION
 4717:	  14CA	A8			DB	0A8H		;MOV R0, DIRECT OP CODE
 4718:	  14CB	CA			DB	0CAH		;R2CAPL LOCATION
 4719:	  14CC	80 CF			SJMP	TWO_EY
 4720:					;
 4721:	  14CE	E5 90		AP1:	MOV	A,P1		;GET P1
 4722:	  14D0	80 C8			SJMP	TWO_R2		;PUT IT ON THE STACK
 4723:					;
 4724:	  14D2	E5		APCON:	DB	0E5H		;MOV A, DIRECT OP CODE
 4725:	  14D3	87			DB	87H		;ADDRESS OF PCON
 4726:	  14D4	80 C4			SJMP	TWO_R2		;PUT PCON ON THE STACK
 4727:					;
 4728:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 116



 Line  I  Addr  Code            Source

 4729:					;***************************************************************
 4730:					;
 4731:					;THIS IS THE LINE EDITOR
 4732:					;
 4733:					;TAKE THE PROCESSED LINE IN IBUF AND INSERT IT INTO THE
 4734:					;BASIC TEXT FILE.
 4735:					;
 4736:					;***************************************************************
 4737:					;
 4738:	  14D6	02 05 66		LJMP	NOGO		;CAN'T EDIT A ROM
 4739:					;
 4740:	  14D9	E5 13		LINE:	MOV	A,BOFAH
 4741:	  14DB	B4 02 F8		CJNE	A,#HIGH PSTART,LINE-3
 4742:	  14DE	12 05 A1		CALL	G4		;GET END ADDRESS FOR EDITING
 4743:	  14E1	AC 82			MOV	R4,DPL
 4744:	  14E3	AD 83			MOV	R5,DPH
 4745:	  14E5	AB 0F			MOV	R3,TEMP5	;GET HIGH ORDER IBLN
 4746:	  14E7	A9 0E			MOV	R1,TEMP4	;LOW ORDER IBLN
 4747:					;
 4748:	  14E9	12 05 84		CALL	GETLIN		;FIND THE LINE
 4749:	  14EC	70 12			JNZ	INSR		;INSERT IF NOT ZERO, ELSE APPEND
 4750:					;
 4751:					;APPEND THE LINE AT THE END
 4752:					;
 4753:	  14EE	E5 0D			MOV	A,TEMP3		;PUT IBCNT IN THE ACC
 4754:	  14F0	B4 04 01		CJNE	A,#4H,$+4	;SEE IF NO ENTRY
 4755:	  14F3	22			RET			;RET IF NO ENTRY
 4756:					;
 4757:	  14F4	B1 91			ACALL	FULL		;SEE IF ENOUGH SPACE LEFT
 4758:	  14F6	AA 05			MOV	R2,R5B0		;PUT END ADDRESS A INTO TRANSFER
 4759:	  14F8	A8 04			MOV	R0,R4B0		;REGISTERS
 4760:	  14FA	B1 4F			ACALL	IMOV		;DO THE BLOCK MOVE
 4761:					;
 4762:	  14FC	74 01		UE:	MOV	A,#EOF		;SAVE EOF CHARACTER
 4763:	  14FE	A1 82			AJMP	TBR
 4764:					;
 4765:					;INSERT A LINE INTO THE FILE
 4766:					;
 4767:	  1500	FF		INSR:	MOV	R7,A		;SAVE IT IN R7
 4768:	  1501	12 18 4C		CALL	TEMPD		;SAVE INSERATION ADDRESS
 4769:	  1504	E5 0D			MOV	A,TEMP3		;PUT THE COUNT LENGTH IN THE ACC
 4770:	  1506	40 09			JC	LTX		;JUMP IF NEW LINE # NOT = OLD LINE #
 4771:	  1508	B4 04 01		CJNE	A,#04H,$+4	;SEE IF NULL
 4772:	  150B	E4			CLR	A
 4773:					;
 4774:	  150C	9F			SUBB	A,R7		;SUBTRACT LINE COUNT FROM ACC
 4775:	  150D	60 36			JZ	LIN1		;LINE LENGTHS EQUAL
 4776:	  150F	40 1F			JC	GTX		;SMALLER LINE
 4777:					;
 4778:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 117



 Line  I  Addr  Code            Source

 4779:					;
 4780:					;EXPAND FOR A NEW LINE OR A LARGER LINE
 4781:					;
 4782:	  1511	FF		LTX:	MOV	R7,A		;SAVE A IN R7
 4783:	  1512	E5 0D			MOV	A,TEMP3		;GET THE COUNT IN THE ACC
 4784:	  1514	B4 04 01		CJNE	A,#04H,$+4	;DO NO INSERTATION IF NULL LINE
 4785:	  1517	22			RET			;EXIT IF IT IS
 4786:					;
 4787:	  1518	EF			MOV	A,R7		;GET THE COUNT BACK - DELTA IN A
 4788:	  1519	B1 91			ACALL	FULL		;SEE IF ENOUGH MEMORY NEW EOFA IN R3:R1
 4789:	  151B	12 18 45		CALL	DTEMP		;GET INSERATION ADDRESS
 4790:	  151E	B1 86			ACALL	NMOV		;R7:R6 GETS (EOFA)-DPTR
 4791:	  1520	12 0D AE		CALL	X3120
 4792:	  1523	A9 04			MOV	R1,R4B0		;EOFA LOW
 4793:	  1525	AB 05			MOV	R3,R5B0		;EOFA HIGH
 4794:	  1527	0E			INC	R6		;INCREMENT BYTE COUNT
 4795:	  1528	BE 00 01		CJNE	R6,#00,$+4	;NEED TO BUMP HIGH BYTE?
 4796:	  152B	0F			INC	R7
 4797:					;
 4798:	  152C	B1 6A			ACALL	RMOV		;GO DO THE INSERTION
 4799:	  152E	80 15			SJMP	LIN1		;INSERT THE CURRENT LINE
 4800:					;
 4801:	  1530	F4		GTX:	CPL	A		;FLIP ACC
 4802:	  1531	04			INC	A		;TWOS COMPLEMENT
 4803:	  1532	12 05 D6		CALL	ADDPTR		;DO THE ADDITION
 4804:	  1535	B1 86			ACALL	NMOV		;R7:R6 GETS (EOFA)-DPTR
 4805:	  1537	A9 82			MOV	R1,DPL		;SET UP THE REGISTERS
 4806:	  1539	AB 83			MOV	R3,DPH
 4807:	  153B	AA 0F			MOV	R2,TEMP5	;PUT INSERTATION ADDRESS IN THE RIGHT REG
 4808:	  153D	A8 0E			MOV	R0,TEMP4
 4809:	  153F	60 02			JZ	$+4		;IF ACC WAS ZERO FROM NMOV, JUMP
 4810:	  1541	B1 56			ACALL	LMOV		;IF NO ZERO DO A LMOV
 4811:					;
 4812:	  1543	91 FC			ACALL	UE		;SAVE NEW END ADDRESS
 4813:					;
 4814:	  1545	AA 0F		LIN1:	MOV	R2,TEMP5	;GET THE INSERTATION ADDRESS
 4815:	  1547	A8 0E			MOV	R0,TEMP4
 4816:	  1549	E5 0D			MOV	A,TEMP3		;PUT THE COUNT LENGTH IN ACC
 4817:	  154B	B4 04 01		CJNE	A,#04H,IMOV	;SEE IF NULL
 4818:	  154E	22			RET			;EXIT IF NULL
 4819:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 118



 Line  I  Addr  Code            Source

 4820:					;***************************************************************
 4821:					;
 4822:					;INSERT A LINE AT ADDRESS R2:R0
 4823:					;
 4824:					;***************************************************************
 4825:					;
 4826:	  154F	E4		IMOV:	CLR	A		;TO SET UP
 4827:	  1550	79 04			MOV	R1,#LOW IBCNT	;INITIALIZE THE REGISTERS
 4828:	  1552	FB			MOV	R3,A
 4829:	  1553	AE 0D			MOV	R6,TEMP3	;PUT THE BYTE COUNT IN R6 FOR LMOV
 4830:	  1555	FF			MOV	R7,A		;PUT A 0 IN R7 FOR LMOV
 4831:					;
 4832:					;***************************************************************
 4833:					;
 4834:					;COPY A BLOCK FROM THE BEGINNING
 4835:					;
 4836:					;R2:R0 IS THE DESTINATION ADDRESS
 4837:					;R3:R1 IS THE SOURCE ADDRESS
 4838:					;R7:R6 IS THE COUNT REGISTER
 4839:					;
 4840:					;***************************************************************
 4841:					;
 4842:	  1556	B1 7F		LMOV:	ACALL	TBYTE		;TRANSFER THE BYTE
 4843:	  1558	B1 5F			ACALL	INC3210		;BUMP THE POINTER
 4844:	  155A	D1 30			ACALL	DEC76		;BUMP R7:R6
 4845:	  155C	70 F8			JNZ	LMOV		;LOOP
 4846:	  155E	22			RET			;GO BACK TO CALLING ROUTINE
 4847:					;
 4848:	  155F	08		INC3210:INC	R0
 4849:	  1560	B8 00 01		CJNE	R0,#00H,$+4
 4850:	  1563	0A			INC	R2
 4851:					;
 4852:	  1564	09			INC	R1
 4853:	  1565	B9 00 01		CJNE	R1,#00H,$+4
 4854:	  1568	0B			INC	R3
 4855:	  1569	22			RET
 4856:					;
 4857:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 119



 Line  I  Addr  Code            Source

 4858:					;***************************************************************
 4859:					;
 4860:					;COPY A BLOCK STARTING AT THE END
 4861:					;
 4862:					;R2:R0 IS THE DESTINATION ADDRESS
 4863:					;R3:R1 IS THE SOURCE ADDRESS
 4864:					;R6:R7 IS THE COUNT REGISTER
 4865:					;
 4866:					;***************************************************************
 4867:					;
 4868:	  156A	B1 7F		RMOV:	ACALL	TBYTE		;TRANSFER THE BYTE
 4869:	  156C	B1 74			ACALL	DEC3210		;DEC THE LOCATIONS
 4870:	  156E	D1 30			ACALL	DEC76		;BUMP THE COUNTER
 4871:	  1570	70 F8			JNZ	RMOV		;LOOP
 4872:					;
 4873:	  1572	00		DEC_R:	NOP			;CREATE EQUAL TIMING
 4874:	  1573	22			RET			;EXIT
 4875:					;
 4876:	  1574	18		DEC3210:DEC	R0		;BUMP THE POINTER
 4877:	  1575	B8 FF 01		CJNE	R0,#0FFH,$+4	;SEE IF OVERFLOWED
 4878:	  1578	1A			DEC	R2		;BUMP THE HIGH BYTE
 4879:	  1579	19			DEC	R1		;BUMP THE POINTER
 4880:	  157A	B9 FF F5		CJNE	R1,#0FFH,DEC_R	;SEE IF OVERFLOWED
 4881:	  157D	1B			DEC	R3		;CHANGE THE HIGH BYTE
 4882:	  157E	22			RET			;EXIT
 4883:					;
 4884:					;***************************************************************
 4885:					;
 4886:					;TBYTE - TRANSFER A BYTE
 4887:					;
 4888:					;***************************************************************
 4889:					;
 4890:	  157F	8B A0		TBYTE:	MOV	P2,R3		;OUTPUT SOURCE REGISTER TO PORT
 4891:	  1581	E3			MOVX	A,@R1		;PUT BYTE IN ACC
 4892:					;
 4893:	  1582	8A A0		TBR:	MOV	P2,R2		;OUTPUT DESTINATION TO PORT
 4894:	  1584	F2			MOVX	@R0,A		;SAVE THE BYTE
 4895:	  1585	22			RET			;EXIT
 4896:					;
 4897:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 120



 Line  I  Addr  Code            Source

 4898:					;***************************************************************
 4899:					;
 4900:					;NMOV - R7:R6 = END ADDRESS - DPTR
 4901:					;
 4902:					;ACC GETS CLOBBERED
 4903:					;
 4904:					;***************************************************************
 4905:					;
 4906:	  1586	EC		NMOV:	MOV	A,R4		;THE LOW BYTE OF EOFA
 4907:	  1587	C3			CLR	C		;CLEAR THE CARRY FOR SUBB
 4908:	  1588	95 82			SUBB	A,DPL		;SUBTRACT DATA POINTER LOW
 4909:	  158A	FE			MOV	R6,A		;PUT RESULT IN R6
 4910:	  158B	ED			MOV	A,R5		;HIGH BYTE OF EOFA
 4911:	  158C	95 83			SUBB	A,DPH		;SUBTRACT DATA POINTER HIGH
 4912:	  158E	FF			MOV	R7,A		;PUT RESULT IN R7
 4913:	  158F	4E			ORL	A,R6		;SEE IF ZERO
 4914:	  1590	22			RET			;EXIT
 4915:					;
 4916:					;***************************************************************
 4917:					;
 4918:					;CHECK FOR A FILE OVERFLOW
 4919:					;LEAVES THE NEW END ADDRESS IN R3:R1
 4920:					;A HAS THE INCREASE IN SIZE
 4921:					;
 4922:					;***************************************************************
 4923:					;
 4924:	  1591	2C		FULL:	ADD	A,R4		;ADD A TO END ADDRESS
 4925:	  1592	F9			MOV	R1,A		;SAVE IT
 4926:	  1593	E4			CLR	A
 4927:	  1594	3D			ADDC	A,R5		;ADD THE CARRY
 4928:	  1595	FB			MOV	R3,A
 4929:	  1596	90 01 04		MOV	DPTR,#VARTOP	;POINT AT VARTOP
 4930:					;
 4931:	  1599	12 05 C4	FUL1:	CALL	DCMPX		;COMPARE THE TWO
 4932:	  159C	40 F2			JC	FULL-1		;OUT OF ROOM
 4933:					;
 4934:	  159E	90 18 0E	TB:	MOV	DPTR,#E5X	;OUT OF MEMORY
 4935:	  15A1	01 2E			AJMP	FPTS
 4936:					;
 4937:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 121



 Line  I  Addr  Code            Source

 4938:					;***************************************************************
 4939:					;
 4940:					; PP - Preprocesses the line in IBUF back into IBUF
 4941:					;      sets F0 if no line number
 4942:					;      leaves the correct length of processed line in IBCNT
 4943:					;      puts the line number in IBLN
 4944:					;      wastes the text address TXAL and TXAH
 4945:					;
 4946:					;***************************************************************
 4947:					;
 4948:	  15A3	F1 61		PP:	ACALL	T_BUF		;TXA GETS IBUF
 4949:	  15A5	12 0F 36		CALL	INTGER		;SEE IF A NUMBER PRESENT
 4950:	  15A8	12 18 4C		CALL	TEMPD		;SAVE THE INTEGER IN TEMP5:TEMP4
 4951:	  15AB	92 D5			MOV	F0,C		;SAVE INTEGER IF PRESENT
 4952:	  15AD	90 00 05		MOV	DPTR,#IBLN	;SAVE THE LINE NUMBER, EVEN IF NONE
 4953:	  15B0	91 0D			ACALL	S20DP
 4954:	  15B2	A8 08			MOV	R0,TXAL		;TEXT POINTER
 4955:	  15B4	79 07			MOV	R1,#LOW IBUF	;STORE POINTER
 4956:					;
 4957:					; Now process the line back into IBUF
 4958:					;
 4959:	  15B6	C2 24		PPL:	CLR	ARGF		;FIRST PASS DESIGNATOR
 4960:	  15B8	90 01 73		MOV	DPTR,#TOKTAB	;POINT DPTR AT LOOK UP TABLE
 4961:					;
 4962:	  15BB	88 05		PPL1:	MOV	R5B0,R0		;SAVE THE READ POINTER
 4963:	  15BD	E4			CLR	A		;ZERO A FOR LOOKUP
 4964:	  15BE	93			MOVC	A,@A+DPTR	;GET THE TOKEN
 4965:	  15BF	FF			MOV	R7,A		;SAVE TOKEN IN CASE OF MATCH
 4966:					;
 4967:	  15C0	E2		PPL2:	MOVX	A,@R0		;GET THE USER CHARACTER
 4968:	  15C1	FB			MOV	R3,A		;SAVE FOR REM
 4969:	  15C2	B4 61 00		CJNE	A,#'a',$+3
 4970:	  15C5	40 07			JC	PPX		;CONVERT LOWER TO UPPER CASE
 4971:	  15C7	B4 7B 00		CJNE	A,#('z'+1),$+3
 4972:	  15CA	50 02			JNC	PPX
 4973:	  15CC	C2 E5			CLR	ACC.5
 4974:					;
 4975:	  15CE	FA		PPX:	MOV	R2,A
 4976:	  15CF	F2			MOVX	@R0,A		;SAVE UPPER CASE
 4977:	  15D0	A3			INC	DPTR		;BUMP THE LOOKUP POINTER
 4978:	  15D1	E4			CLR	A
 4979:	  15D2	93			MOVC	A,@A+DPTR
 4980:	  15D3	B5 02 03		CJNE	A,R2B0,PPL3	;LEAVE IF NOT THE SAME
 4981:	  15D6	08			INC	R0		;BUMP THE USER POINTER
 4982:	  15D7	80 E7			SJMP	PPL2		;CONTINUE TO LOOP
 4983:					;
 4984:	  15D9	20 E7 2F	PPL3:	JB	ACC.7,PPL6	;JUMP IF FOUND MATCH
 4985:	  15DC	60 2D			JZ	PPL6		;USER MATCH
 4986:					;
 4987:					;
 4988:					; Scan to the next TOKTAB entry
 4989:					;
 4990:	  15DE	A3		PPL4:	INC	DPTR		;ADVANCE THE POINTER
 4991:	  15DF	E4			CLR	A		;ZERO A FOR LOOKUP
 4992:	  15E0	93			MOVC	A,@A+DPTR	;LOAD A WITH TABLE
 4993:	  15E1	20 E7 03		JB	ACC.7,$+6	;KEEP SCANNING IF NOT A RESERVED WORD

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 122



 Line  I  Addr  Code            Source

 4994:	  15E4	70 F8			JNZ	PPL4
 4995:	  15E6	A3			INC	DPTR
 4996:					;
 4997:					; See if at the end of TOKTAB
 4998:					;
 4999:	  15E7	A8 05			MOV	R0,R5B0		;RESTORE THE POINTER
 5000:	  15E9	B4 FF CF		CJNE	A,#0FFH,PPL1	;SEE IF END OF TABLE
 5001:					;
 5002:					; Character not in TOKTAB, so see what it is
 5003:					;
 5004:	  15EC	BA 20 03		CJNE	R2,#' ',PPLX	;SEE IF A SPACE
 5005:	  15EF	08			INC	R0		;BUMP USER POINTER
 5006:	  15F0	80 C4			SJMP	PPL		;TRY AGAIN
 5007:					;
 5008:	  15F2	30 2D 0A	PPLX:	JNB	XBIT,PPLY	;EXTERNAL TRAP
 5009:	  15F5	20 24 07		JB	ARGF,PPLY
 5010:	  15F8	D2 24			SETB	ARGF		;SAYS THAT THE USER HAS TABLE
 5011:	  15FA	12 20 78		LCALL	2078H		;SET UP POINTER
 5012:	  15FD	A1 BB			AJMP	PPL1
 5013:					;
 5014:	  15FF	D1 18		PPLY:	ACALL	PPL7		;SAVE CHARACTER, EXIT IF A CR
 5015:	  1601	B4 22 B2		CJNE	A,#'"',PPL	;SEE IF QUOTED STRING, START AGAIN IF NOT
 5016:					;
 5017:					; Just copy a quoted string
 5018:					;
 5019:	  1604	D1 18			ACALL	PPL7		;SAVE THE CHARACTER, TEST FOR CR
 5020:	  1606	B4 22 FB		CJNE	A,#'"',$-2	;IS THERE AN ENDQUOTE, IF NOT LOOP
 5021:	  1609	80 AB			SJMP	PPL		;DO IT AGAIN IF ENDQUOTE
 5022:					;
 5023:	  160B	EF		PPL6:	MOV	A,R7		;GET THE TOKEN
 5024:	  160C	D1 2D			ACALL	PPL9+1		;SAVE THE TOKEN
 5025:	  160E	B4 96 A5		CJNE	A,#T_REM,PPL	;SEE IF A REM TOKEN
 5026:	  1611	EB			MOV	A,R3
 5027:	  1612	D1 19			ACALL	PPL7+1		;WASTE THE REM STATEMENT
 5028:	  1614	D1 18			ACALL	PPL7		;LOOP UNTIL A CR
 5029:	  1616	80 FC			SJMP	$-2
 5030:					;
 5031:	  1618	E2		PPL7:	MOVX	A,@R0		;GET THE CHARACTER
 5032:	  1619	B4 0D 10		CJNE	A,#CR,PPL9	;FINISH IF A CR
 5033:	  161C	D0 00			POP	R0B0		;WASTE THE CALLING STACK
 5034:	  161E	D0 00			POP	R0B0
 5035:	  1620	F3			MOVX	@R1,A		;SAVE CR IN MEMORY
 5036:	  1621	09			INC	R1		;SAVE A TERMINATOR
 5037:	  1622	74 01			MOV	A,#EOF
 5038:	  1624	F3			MOVX	@R1,A
 5039:	  1625	E9			MOV	A,R1		;SUBTRACT FOR LENGTH
 5040:	  1626	94 04			SUBB	A,#4
 5041:	  1628	F5 0D			MOV	TEMP3,A		;SAVE LENGTH
 5042:	  162A	79 04			MOV	R1,#LOW IBCNT	;POINT AT BUFFER COUNT
 5043:					;
 5044:	  162C	08		PPL9:	INC	R0
 5045:	  162D	F3			MOVX	@R1,A		;SAVE THE CHARACTER
 5046:	  162E	09			INC	R1		;BUMP THE POINTERS
 5047:	  162F	22			RET			;EXIT TO CALLING ROUTINE
 5048:					;
 5049:					;

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 123



 Line  I  Addr  Code            Source

 5050:					;***************************************************************
 5051:					;
 5052:					;DEC76 - DECREMENT THE REGISTER PAIR R7:R6
 5053:					;
 5054:					;ACC = ZERO IF R7:R6 = ZERO ; ELSE ACC DOES NOT
 5055:					;
 5056:					;***************************************************************
 5057:					;
 5058:	  1630	1E		DEC76:	DEC	R6		;BUMP R6
 5059:	  1631	BE FF 01		CJNE	R6,#0FFH,$+4	;SEE IF RAPPED AROUND
 5060:	  1634	1F			DEC	R7
 5061:	  1635	EF			MOV	A,R7		;SEE IF ZERO
 5062:	  1636	4E			ORL	A,R6
 5063:	  1637	22			RET			;EXIT
 5064:					;
 5065:					;***************************************************************
 5066:					;
 5067:					; MTOP - Get or Put the top of assigned memory
 5068:					;
 5069:					;***************************************************************
 5070:					;
 5071:	  1638	90 01 0A	PMTOP:	MOV	DPTR,#MEMTOP
 5072:	  163B	12 05 6B		CALL	L20DPI
 5073:	  163E	81 9D			AJMP	TWO_EY		;PUT R2:R0 ON THE STACK
 5074:					;
 5075:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 124



 Line  I  Addr  Code            Source

 5076:					;*************************************************************
 5077:					;
 5078:					; AXTAL - Crystal value calculations
 5079:					;
 5080:					;*************************************************************
 5081:					;
 5082:	  1640	90 17 DE	AXTAL0:	MOV	DPTR,#XTALV	;CRYSTAL VALUE
 5083:	  1643	91 1C			ACALL	PUSHC
 5084:					;
 5085:	  1645	91 13		AXTAL1:	ACALL	CSTAKA2		;COPY CRYSTAL VALUE TWICE
 5086:	  1647	91 15			ACALL	CSTAKA
 5087:	  1649	90 07 01		MOV	DPTR,#PTIME	;PROM TIMER
 5088:	  164C	D1 6E			ACALL	AXTAL2
 5089:	  164E	90 01 28		MOV	DPTR,#PROGS
 5090:	  1651	F1 03			ACALL	S31L
 5091:	  1653	90 17 F0		MOV	DPTR,#IPTIME	;IPROM TIMER
 5092:	  1656	D1 6E			ACALL	AXTAL2
 5093:	  1658	90 01 2A		MOV	DPTR,#IPROGS
 5094:	  165B	F1 03			ACALL	S31L
 5095:	  165D	90 11 50		MOV	DPTR,#TTIME	;CLOCK CALCULATION
 5096:	  1660	51 08			ACALL	AXTAL3
 5097:	  1662	E9			MOV	A,R1
 5098:	  1663	F4			CPL	A
 5099:	  1664	04			INC	A
 5100:	  1665	F5 4A			MOV	SAVE_T,A
 5101:	  1667	7B 01			MOV	R3,#HIGH CXTAL
 5102:	  1669	79 13			MOV	R1,#LOW CXTAL
 5103:	  166B	02 0F D4		JMP	POPAS
 5104:					;
 5105:	  166E	51 08		AXTAL2:	ACALL	AXTAL3
 5106:					;
 5107:	  1670			CBIAS:	;Bias the crystal calculations
 5108:					;
 5109:	  1670	E9			MOV	A,R1		;GET THE LOW COUNT
 5110:	  1671	F4			CPL	A		;FLIP IT FOR TIMER LOAD
 5111:	  1672	24 0F			ADD	A,#15		;BIAS FOR CALL AND LOAD TIMES
 5112:	  1674	F9			MOV	R1,A		;RESTORE IT
 5113:	  1675	EB			MOV	A,R3		;GET THE HIGH COUNT
 5114:	  1676	F4			CPL	A		;FLIP IT
 5115:	  1677	34 00			ADDC	A,#00H		;ADD THE CARRY
 5116:	  1679	FB			MOV	R3,A		;RESTORE IT
 5117:	  167A	22			RET
 5118:					;
 5119:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 125



 Line  I  Addr  Code            Source

 5120:				;$INCLUDE(:F2:BAS52.PWM)
 5121:				;BEGINNING
 5122:					;**************************************************************
 5123:					;
 5124:	  167B			STONE:	; Toggle the I/O port
 5125:					;
 5126:					;**************************************************************
 5127:					;
 5128:	  167B	12 0E 79		CALL	THREE		;GET THE NUMBERS
 5129:	  167E	D1 70			ACALL	CBIAS		;BIAS R3:R1 FOR COUNT LOOP
 5130:					;
 5131:	  1680	C2 92		STONE1:	CLR	T_BIT		;TOGGLE THE BIT
 5132:	  1682	C2 8E			CLR	TR1		;STOP THE TIMER
 5133:	  1684	8B 8D			MOV	TH1,R3		;LOAD THE TIMER
 5134:	  1686	89 8B			MOV	TL1,R1
 5135:	  1688	C2 8F			CLR	TF1		;CLEAR THE OVERFLOW FLAG
 5136:	  168A	D2 8E			SETB	TR1		;TURN IT ON
 5137:	  168C	D1 30			ACALL	DEC76
 5138:	  168E	30 8F FD		JNB	TF1,$		;WAIT
 5139:	  1691	71 95			ACALL	ALPAR
 5140:	  1693	D2 92			SETB	T_BIT		;BACK TO A ONE
 5141:	  1695	12 05 29		CALL	TIMER_LOAD+2	;LOAD THE HIGH VALUE
 5142:	  1698	30 8F FD		JNB	TF1,$		;WAIT
 5143:	  169B	70 E3			JNZ	STONE1		;LOOP
 5144:	  169D	22			RET
 5145:					;
 5146:
 5147:				;END
 5148:				;$INCLUDE(:F2:BAS52.PWM)
 5149:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 126



 Line  I  Addr  Code            Source

 5150:					;LNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLN
 5151:					;
 5152:	  169E			LNTAB:	; Natural log lookup table
 5153:					;
 5154:					;LNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLN
 5155:					;
 5156:	  169E	80			DB	80H
 5157:	  169F	00			DB	00H
 5158:	  16A0	71			DB	71H
 5159:	  16A1	37			DB	37H
 5160:	  16A2	13			DB	13H
 5161:	  16A3	19			DB	19H
 5162:					;
 5163:	  16A4	7F			DB	7FH
 5164:	  16A5	00			DB	00H
 5165:	  16A6	76			DB	76H
 5166:	  16A7	64			DB	64H
 5167:	  16A8	37			DB	37H
 5168:	  16A9	94			DB	94H
 5169:					;
 5170:	  16AA	80			DB	80H
 5171:	  16AB	00			DB	00H
 5172:	  16AC	07			DB	07H
 5173:	  16AD	22			DB	22H
 5174:	  16AE	75			DB	75H
 5175:	  16AF	17			DB	17H
 5176:					;
 5177:	  16B0	80			DB	80H
 5178:	  16B1	00			DB	00H
 5179:	  16B2	52			DB	52H
 5180:	  16B3	35			DB	35H
 5181:	  16B4	93			DB	93H
 5182:	  16B5	28			DB	28H
 5183:					;
 5184:	  16B6	80			DB	80H
 5185:	  16B7	00			DB	00H
 5186:	  16B8	71			DB	71H
 5187:	  16B9	91			DB	91H
 5188:	  16BA	85			DB	85H
 5189:	  16BB	86			DB	86H
 5190:					;
 5191:	  16BC	FF			DB	0FFH
 5192:					;
 5193:	  16BD	81			DB	81H
 5194:	  16BE	00			DB	00H
 5195:	  16BF	51			DB	51H
 5196:	  16C0	58			DB	58H
 5197:	  16C1	02			DB	02H
 5198:	  16C2	23			DB	23H
 5199:					;
 5200:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 127



 Line  I  Addr  Code            Source

 5201:					;SINSINSINSINSINSINSINSINSINSINSINSINSINSINSINSINSIN
 5202:					;
 5203:	  16C3			SINTAB:	; Sin lookup table
 5204:					;
 5205:					;SINSINSINSINSINSINSINSINSINSINSINSINSINSINSINSINSIN
 5206:					;
 5207:	  16C3	77			DB	128-9
 5208:	  16C4	00			DB	00H
 5209:	  16C5	44			DB	44H
 5210:	  16C6	90			DB	90H
 5211:	  16C7	05			DB	05H
 5212:	  16C8	16			DB	16H
 5213:					;
 5214:	  16C9	79			DB	128-7
 5215:	  16CA	01			DB	01H
 5216:	  16CB	08			DB	08H
 5217:	  16CC	21			DB	21H
 5218:	  16CD	05			DB	05H
 5219:	  16CE	25			DB	25H
 5220:					;
 5221:	  16CF	7B			DB	128-5
 5222:	  16D0	00			DB	00H
 5223:	  16D1	19			DB	19H
 5224:	  16D2	73			DB	73H
 5225:	  16D3	55			DB	55H
 5226:	  16D4	27			DB	27H
 5227:					;
 5228:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 128



 Line  I  Addr  Code            Source

 5229:					;
 5230:	  16D5	7D			DB	128-3
 5231:	  16D6	01			DB	01H
 5232:	  16D7	70			DB	70H
 5233:	  16D8	12			DB	12H
 5234:	  16D9	84			DB	84H
 5235:	  16DA	19			DB	19H
 5236:					;
 5237:	  16DB	7E			DB	128-2
 5238:	  16DC	00			DB	00H
 5239:	  16DD	33			DB	33H
 5240:	  16DE	33			DB	33H
 5241:	  16DF	33			DB	33H
 5242:	  16E0	83			DB	83H
 5243:					;
 5244:	  16E1	80			DB	128
 5245:	  16E2	01			DB	01H
 5246:	  16E3	67			DB	67H
 5247:	  16E4	66			DB	66H
 5248:	  16E5	66			DB	66H
 5249:	  16E6	16			DB	16H
 5250:					;
 5251:	  16E7	81		FPONE:	DB	128+1
 5252:	  16E8	00			DB	00H
 5253:	  16E9	00			DB	00H
 5254:	  16EA	00			DB	00H
 5255:	  16EB	00			DB	00H
 5256:	  16EC	10			DB	10H
 5257:					;
 5258:	  16ED	FF			DB	0FFH		;END OF TABLE
 5259:					;
 5260:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 129



 Line  I  Addr  Code            Source

 5261:					;
 5262:	  16EE	12 0F DA	SBAUD:	CALL	AXTAL		;PUT CRYSTAL ON THE STACK
 5263:	  16F1	12 0F 44		CALL	EXPRB		;PUT THE NUMBER AFTER BAUD ON STACK
 5264:	  16F4	74 0C			MOV	A,#12
 5265:	  16F6	91 9A			ACALL	TWO_R2		;TOS = 12
 5266:	  16F8	31 99			ACALL	AMUL		;TOS = 12*BAUD
 5267:	  16FA	71 F3			ACALL	ADIV		;TOS = XTAL/(12*BAUD)
 5268:	  16FC	51 0C			ACALL	IFIX
 5269:	  16FE	D1 70			ACALL	CBIAS
 5270:	  1700	90 01 24		MOV	DPTR,#SPV
 5271:					;
 5272:	  1703	02 05 FD	S31L:	JMP	S31DP
 5273:					;
 5274:	  1706	D1 38		AFREE:	CALL	PMTOP		;PUT MTOP ON STACK
 5275:	  1708	12 05 A1		CALL	G4		;GET END ADDRESS
 5276:	  170B	A8 82			MOV	R0,DPL
 5277:	  170D	AA 83			MOV	R2,DPH
 5278:	  170F	91 9D			ACALL	TWO_EY
 5279:					;
 5280:	  1711	12 19 95	ASUB:	LCALL	FP_BASE+2	;DO FP SUB
 5281:	  1714	01 1B			AJMP	FPTST
 5282:					;
 5283:	  1716	12 05 16	ALEN:	CALL	CCAL		;CALCULATE THE LEN OF THE SELECTED PROGRAM
 5284:	  1719	AA 07			MOV	R2,R7B0		;SAVE THE HIGH BYTE
 5285:	  171B	EE			MOV	A,R6		;SAVE THE LOW BYTE
 5286:	  171C	81 9C			AJMP	TWO_EX		;PUT IT ON THE STACK
 5287:					;
 5288:	  171E	A2 AF		ATIME:	MOV	C,EA		;SAVE INTERRUTS
 5289:	  1720	C2 AF			CLR	EA
 5290:	  1722	C0 47			PUSH	MILLIV		;SAVE MILLI VALUE
 5291:	  1724	AA 48			MOV	R2,TVH		;GET THE TIMER
 5292:	  1726	E5 49			MOV	A,TVL
 5293:	  1728	92 AF			MOV	EA,C		;SAVE INTERRUPTS
 5294:	  172A	91 9C			ACALL	TWO_EX		;PUT TIMER ON THE STACK
 5295:	  172C	D0 E0			POP	ACC		;GET MILLI
 5296:	  172E	91 9A			ACALL	TWO_R2		;PUT MILLI ON STACK
 5297:	  1730	74 C8			MOV	A,#200
 5298:	  1732	91 9A			ACALL	TWO_R2		;DIVIDE MILLI BY 200
 5299:	  1734	71 F3			ACALL	ADIV
 5300:					;
 5301:	  1736	12 19 93	AADD:	LCALL	FP_BASE		;DO FP ADDITION
 5302:	  1739	01 1B			AJMP	FPTST		;CHECK FOR ERRORS
 5303:					;
 5304:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 130



 Line  I  Addr  Code            Source

 5305:					;**************************************************************
 5306:					;
 5307:					; Here are some error messages that were moved
 5308:					;
 5309:					;**************************************************************
 5310:					;
 5311:					;
 5312:	  173B	42 41 44 20	E1X:	DB	'BAD SYNTAX"'
	  173F	53 59 4E 54
	  1743	41 58 22
 5313:	  1746	8A		E2X:	DB	128+10
 5314:	  1747	44 49 56 49		DB	'DIVIDE BY ZERO"'
	  174B	44 45 20 42
	  174F	59 20 5A 45
	  1753	52 4F 22
 5315:					;
 5316:	  1756	41 52 52 41	E6X:	DB	'ARRAY SIZE"'
	  175A	59 20 53 49
	  175E	5A 45 22
 5317:					;
 5318:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 131



 Line  I  Addr  Code            Source

 5319:					;**************************************************************
 5320:					;
 5321:	  1761			T_BUF:	; TXA gets IBUF
 5322:					;
 5323:					;**************************************************************
 5324:					;
 5325:	  1761	75 0A 00		MOV	TXAH,#HIGH IBUF
 5326:	  1764	75 08 07		MOV	TXAL,#LOW IBUF
 5327:	  1767	22			RET
 5328:					;
 5329:					;
 5330:					;***************************************************************
 5331:					;
 5332:	  1768			CXFER:	; Transfer a program from rom to ram
 5333:					;
 5334:					;***************************************************************
 5335:					;
 5336:	  1768	12 05 16		CALL	CCAL		;GET EVERYTHING SET UP
 5337:	  176B	7A 02			MOV	R2,#HIGH PSTART
 5338:	  176D	78 00			MOV	R0,#LOW PSTART
 5339:	  176F	B1 56			ACALL	LMOV		;DO THE TRANSFER
 5340:	  1771	12 06 5C		CALL	RCLEAR		;CLEAR THE MEMORY
 5341:					;
 5342:					; Fall thru to CRAM
 5343:					;
 5344:					;***************************************************************
 5345:					;
 5346:	  1774			CRAM:	; The command action routine - RAM - Run out of ram
 5347:					;
 5348:					;***************************************************************
 5349:					;
 5350:	  1774	C2 17			CLR	CONB		;CAN'T CONTINUE IF MODE CHANGE
 5351:	  1776	75 13 02		MOV	BOFAH,#HIGH PSTART
 5352:	  1779	75 14 00		MOV	BOFAL,#LOW PSTART
 5353:					;
 5354:					; Fall thru to Command Processor
 5355:					;
 5356:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 132



 Line  I  Addr  Code            Source

 5357:					;***************************************************************
 5358:					;
 5359:	  177C			CMND1:	; The entry point for the command processor
 5360:					;
 5361:					;***************************************************************
 5362:					;
 5363:	  177C	12 0C 32		LCALL	SPRINT+4	;WASTE AT AND HEX
 5364:	  177F	C2 2D			CLR	XBIT		;TO RESET IF NEEDED
 5365:	  1781	E4			CLR	A
 5366:	  1782	90 20 02		MOV	DPTR,#2002H	;CHECK FOR EXTERNAL TRAP PACKAGE
 5367:	  1785	93			MOVC	A,@A+DPTR
 5368:	  1786	B4 5A 03		CJNE	A,#5AH,$+6
 5369:	  1789	12 20 48		LCALL	2048H		;IF PRESENT JUMP TO LOCATION 200BH
 5370:	  178C	90 00 FB		MOV	DPTR,#RDYS	;PRINT THE READY MESSAGE
 5371:	  178F	12 06 A5		CALL	CRP		;DO A CR, THEN, PRINT FROM THE ROM
 5372:					;
 5373:	  1792	D2 2F		CMNDR:	SETB	DIRF		;SET THE DIRECT INPUT BIT
 5374:	  1794	85 3E 81		MOV	SP,SPSAV	;LOAD THE STACK
 5375:	  1797	11 80			ACALL	CL7		;DO A CRLF
 5376:					;
 5377:	  1799	C2 18		CMNX:	CLR	GTRD		;CLEAR BREAK
 5378:	  179B	90 00 5E		MOV	DPTR,#5EH	;DO RUN TRAP
 5379:	  179E	E0			MOVX	A,@DPTR
 5380:	  179F	64 34			XRL	A,#52
 5381:	  17A1	70 03			JNZ	$+5
 5382:	  17A3	02 08 06		LJMP	CRUN
 5383:	  17A6	7D 3E			MOV	R5,#'>'		;OUTPUT A PROMPT
 5384:	  17A8	12 07 09		LCALL	TEROT
 5385:	  17AB	12 06 D0		CALL	INLINE		;INPUT A LINE INTO IBUF
 5386:	  17AE	B1 A3			CALL	PP		;PRE-PROCESS THE LINE
 5387:	  17B0	20 D5 0F		JB	F0,CMND3	;NO LINE NUMBER
 5388:	  17B3	91 D9			CALL	LINE		;PROCESS THE LINE
 5389:	  17B5	12 05 DF		LCALL	LCLR
 5390:	  17B8	20 15 DE		JB	LINEB,CMNX	;DON'T CLEAR MEMORY IF NO NEED
 5391:	  17BB	D2 15			SETB	LINEB
 5392:	  17BD	12 06 5C		LCALL	RCLEAR		;CLEAR THE MEMORY
 5393:	  17C0	80 D7			SJMP	CMNX		;LOOP BACK
 5394:					;
 5395:	  17C2	F1 61		CMND3:	CALL	T_BUF		;SET UP THE TEXT POINTER
 5396:	  17C4	12 0E E2		CALL	DELTST		;GET THE CHARACTER
 5397:	  17C7	60 C9			JZ	CMNDR		;IF CR, EXIT
 5398:	  17C9	90 01 0D		MOV	DPTR,#CMNDD	;POINT AT THE COMMAND LOOKUP
 5399:	  17CC	B4 F0 00		CJNE	A,#T_CMND,$+3	;PROCESS STATEMENT IF NOT A COMMAND
 5400:	  17CF	40 0A			JC	CMND5
 5401:	  17D1	12 0E D8		CALL	GCI1		;BUMP TXA
 5402:	  17D4	54 0F			ANL	A,#0FH		;STRIP MSB'S FOR LOOKUP
 5403:	  17D6	12 09 5D		LCALL	ISTA1		;PROCESS COMMAND
 5404:	  17D9	80 B7			SJMP	CMNDR
 5405:					;
 5406:	  17DB	02 08 17	CMND5:	LJMP	ILOOP		;CHECK FOR A POSSIBLE BREAK
 5407:					;
 5408:					;
 5409:					;
 5410:					;CONSTANTS
 5411:					;
 5412:	  17DE	88		XTALV:	DB	128+8		; DEFAULT CRYSTAL VALUE

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 133



 Line  I  Addr  Code            Source

 5413:	  17DF	00			DB	00H
 5414:	  17E0	00			DB	00H
 5415:	  17E1	92			DB	92H
 5416:	  17E2	05			DB	05H
 5417:	  17E3	11			DB	11H
 5418:					;
 5419:	  17E4	85		EXP11:	DB	85H
 5420:	  17E5	00			DB	00H
 5421:	  17E6	42			DB	42H
 5422:	  17E7	41			DB	41H
 5423:	  17E8	87			DB	87H
 5424:	  17E9	59			DB	59H
 5425:					;
 5426:	  17EA	81		EXP1:	DB	128+1		; EXP(1)
 5427:	  17EB	00			DB	00H
 5428:	  17EC	18			DB	18H
 5429:	  17ED	28			DB	28H
 5430:	  17EE	18			DB	18H
 5431:	  17EF	27			DB	27H
 5432:					;
 5433:	  17F0	7C		IPTIME:	DB	128-4		;FPROG TIMING
 5434:	  17F1	00			DB	00H
 5435:	  17F2	00			DB	00H
 5436:	  17F3	00			DB	00H
 5437:	  17F4	75			DB	75H
 5438:	  17F5	83			DB	83H
 5439:					;
 5440:	  17F6	81		PIE:	DB	128+1		;PI
 5441:	  17F7	00			DB	00H
 5442:	  17F8	26			DB	26H
 5443:	  17F9	59			DB	59H
 5444:	  17FA	41			DB	41H
 5445:	  17FB	31			DB	31H		; 3.1415926
 5446:					;
 5447:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 134



 Line  I  Addr  Code            Source

 5448:					;***************************************************************
 5449:					;
 5450:					; The error messages, some have been moved
 5451:					;
 5452:					;***************************************************************
 5453:					;
 5454:	  17FC	9E		E7X:	DB	128+30
 5455:	  17FD	41 52 49 54		DB	'ARITH. UNDERFLOW"'
	  1801	48 2E 20 55
	  1805	4E 44 45 52
	  1809	46 4C 4F 57
	  180D	22
 5456:					;
 5457:	  180E	4D 45 4D 4F	E5X:	DB	'MEMORY ALLOCATION"'
	  1812	52 59 20 41
	  1816	4C 4C 4F 43
	  181A	41 54 49 4F
	  181E	4E 22
 5458:					;
 5459:	  1820	A8		E3X:	DB	128+40
 5460:	  1821	42 41 44 20		DB	'BAD ARGUMENT"'
	  1825	41 52 47 55
	  1829	4D 45 4E 54
	  182D	22
 5461:					;
 5462:	  182E	49 2D 53 54	EXI:	DB	'I-STACK"'
	  1832	41 43 4B 22
 5463:					;
 5464:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 135



 Line  I  Addr  Code            Source

 5465:					;***************************************************************
 5466:					;
 5467:					; The command action routine - CONTINUE
 5468:					;
 5469:					;***************************************************************
 5470:					;
 5471:	  1836	90 1F A6	CCONT:	MOV	DPTR,#E15X
 5472:	  1839	30 17 4B		JNB	CONB,ERROR	;ERROR IF CONTINUE IS NOT SET
 5473:					;
 5474:	  183C			CC1:	;used for input statement entry
 5475:					;
 5476:	  183C	85 42 0A		MOV	TXAH,INTXAH	;RESTORE TXA
 5477:	  183F	85 43 08		MOV	TXAL,INTXAL
 5478:	  1842	02 08 13		JMP	CILOOP		;EXECUTE
 5479:					;
 5480:	  1845	85 0F 83	DTEMP:	MOV	DPH,TEMP5	;RESTORE DPTR
 5481:	  1848	85 0E 82		MOV	DPL,TEMP4
 5482:	  184B	22			RET
 5483:					;
 5484:	  184C	85 83 0F	TEMPD:	MOV	TEMP5,DPH
 5485:	  184F	85 82 0E		MOV	TEMP4,DPL
 5486:	  1852	22			RET
 5487:					;
 5488:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 136



 Line  I  Addr  Code            Source

 5489:					;**************************************************************
 5490:					;
 5491:	  1853			I_DL:	; IDLE
 5492:					;
 5493:					;**************************************************************
 5494:					;
 5495:	  1853	20 2F 27		JB	DIRF,E1XX	;SYNTAX ERROR IN DIRECT INPUT
 5496:	  1856	C2 96			CLR	DACK		;ACK IDLE
 5497:					;
 5498:	  1858	43		U_ID1:	DB	01000011B	;ORL DIRECT OP CODE
 5499:	  1859	87			DB	87H		;PCON ADDRESS
 5500:	  185A	01			DB	01H		;SET IDLE BIT
 5501:	  185B	20 16 0B		JB	INTPEN,I_RET	;EXIT IF EXTERNAL INTERRUPT
 5502:	  185E	10 21 08		JBC	U_IDL,I_RET	;EXIT IF USER WANTS TO
 5503:	  1861	30 10 F4		JNB	OTS,U_ID1	;LOOP IF TIMER NOT ENABLED
 5504:	  1864	12 07 E7		LCALL	T_CMP		;CHECK THE TIMER
 5505:	  1867	40 EF			JC	U_ID1		;LOOP IF TIME NOT BIG ENOUGH
 5506:					;
 5507:	  1869	D2 96		I_RET:	SETB	DACK		;RESTORE EXECUTION
 5508:	  186B	22			RET			;EXIT IF IT IS
 5509:					;
 5510:					;
 5511:					;
 5512:	  186C	A3		ER0:	INC	DPTR		;BUMP TO TEXT
 5513:	  186D	20 2F 23		JB	DIRF,ERROR0	;CAN'T GET OUT OF DIRECT MODE
 5514:	  1870	30 13 20		JNB	ON_ERR,ERROR0	;IF ON ERROR ISN'T SET, GO BACK
 5515:	  1873	90 01 01		MOV	DPTR,#ERRLOC	;SAVE THE ERROR CODE
 5516:	  1876	12 06 6B		CALL	RC2		;SAVE ERROR AND SET UP THE STACKS
 5517:	  1879	A3			INC	DPTR		;POINT AT ERRNUM
 5518:	  187A	02 08 48		JMP	ERL4		;LOAD ERR NUM AND EXIT
 5519:					;
 5520:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 137



 Line  I  Addr  Code            Source

 5521:					;
 5522:					; Syntax error
 5523:					;
 5524:	  187D	A2 2F		E1XX:	MOV	C,DIRF		;SEE IF IN DIRECT MODE
 5525:	  187F	90 17 3B		MOV	DPTR,#E1X	;ERROR MESSAGE
 5526:	  1882	80 04			SJMP	ERROR+1		;TRAP ON SET DIRF
 5527:					;
 5528:	  1884	90 18 2E		MOV	DPTR,#EXI	;STACK ERROR
 5529:					;
 5530:					; Falls through
 5531:					;
 5532:					;***************************************************************
 5533:					;
 5534:					;ERROR PROCESSOR - PRINT OUT THE ERROR TYPE, CHECK TO SEE IF IN
 5535:					;                  RUN OR COMMAND MODE, FIND AND PRINT OUT THE
 5536:					;                  LINE NUMBER IF IN RUN MODE
 5537:					;
 5538:					;***************************************************************
 5539:					;
 5540:	  1887	C3		ERROR:	CLR	C		;RESET STACK
 5541:	  1888	85 3E 81		MOV	SP,SPSAV	;RESET THE STACK
 5542:	  188B	12 0C 32		LCALL	SPRINT+4	;CLEAR LINE AND AT MODE
 5543:	  188E	E4			CLR	A		;SET UP TO GET ERROR CODE
 5544:	  188F	93			MOVC	A,@A+DPTR
 5545:	  1890	10 E7 D9		JBC	ACC.7,ER0	;PROCESS ERROR
 5546:					;
 5547:	  1893	11 4C		ERROR0:	ACALL	TEMPD		;SAVE THE DATA POINTER
 5548:	  1895	40 03			JC	$+5		;NO RESET IF CARRY IS SET
 5549:	  1897	12 06 67		LCALL	RC1		;RESET THE STACKS
 5550:	  189A	12 06 9B		CALL	CRLF2		;DO TWO CARRIAGE RET - LINE FEED
 5551:	  189D	90 1F F8		MOV	DPTR,#ERS	;OUTPUT ERROR MESSAGE
 5552:	  18A0	12 06 A7		CALL	ROM_P
 5553:	  18A3	11 45			CALL	DTEMP		;GET THE ERROR MESSAGE BACK
 5554:					;
 5555:	  18A5	12 06 A7	ERRS:	CALL	ROM_P		;PRINT ERROR TYPE
 5556:	  18A8	30 2F 05		JNB	DIRF,ER1	;DO NOT PRINT IN LINE IF DIRF=1
 5557:					;
 5558:	  18AB	C2 20		SERR1:	CLR	STOPBIT		;PRINT STOP THEN EXIT, FOR LIST
 5559:	  18AD	02 17 7C		JMP	CMND1
 5560:					;
 5561:	  18B0	90 01 01	ER1:	MOV	DPTR,#INS	;OUTPUT IN LINE
 5562:	  18B3	12 06 A7		CALL	ROM_P
 5563:					;
 5564:					;NOW, FIND THE LINE NUMBER
 5565:					;
 5566:					;
 5567:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 138



 Line  I  Addr  Code            Source

 5568:					;
 5569:					;
 5570:	  18B6	12 0E 9C		CALL	DP_B		;GET THE FIRST ADDRESS OF THE PROGRAM
 5571:	  18B9	E4			CLR	A		;FOR INITIALIZATION
 5572:					;
 5573:	  18BA	11 4C		ER2:	ACALL	TEMPD		;SAVE THE DPTR
 5574:	  18BC	12 05 D6		CALL	ADDPTR		;ADD ACC TO DPTR
 5575:	  18BF	11 F3			ACALL	ER4		;R3:R1 = TXA-DPTR
 5576:	  18C1	40 06		 JC	ER3		;EXIT IF DPTR>TXA
 5577:	  18C3	60 04			JZ	ER3		;EXIT IF DPTR=TXA
 5578:	  18C5	E0			MOVX	A,@DPTR		;GET LENGTH
 5579:	  18C6	B4 01 F1		CJNE	A,#EOF,ER2	;SEE IF AT THE END
 5580:					;
 5581:	  18C9	11 45		ER3:	ACALL	DTEMP		;PUT THE LINE IN THE DPTR
 5582:	  18CB	11 F3			ACALL	ER4		;R3:R1 = TXA - BEGINNING OF LINE
 5583:	  18CD	E9			MOV	A,R1		;GET LENGTH
 5584:	  18CE	24 0A		  	ADD	A,#10		;ADD 10 TO LENGTH, DPTR STILL HAS ADR
 5585:	  18D0	F5 45			MOV	MT1,A		;SAVE THE COUNT
 5586:	  18D2	A3			INC	DPTR		;POINT AT LINE NUMBER HIGH BYTE
 5587:	  18D3	12 16 3B		CALL	PMTOP+3		;LOAD R2:R0, PUT IT ON THE STACK
 5588:	  18D6	31 A1			ACALL	FP_BASE+14	;OUTPUT IT
 5589:	  18D8	20 20 D0		JB	STOPBIT,SERR1	;EXIT IF STOP BIT SET
 5590:	  18DB	12 06 9B		CALL	CRLF2		;DO SOME CRLF'S
 5591:	  18DE	11 45			CALL	DTEMP
 5592:	  18E0	12 10 86		CALL	UPPL		;UNPROCESS THE LINE
 5593:	  18E3	12 10 77		CALL	CL6		;PRINT IT
 5594:	  18E6	7D 2D			MOV	R5,#'-'		;OUTPUT DASHES, THEN AN X
 5595:	  18E8	31 90			ACALL	T_L		;PRINT AN X IF ERROR CHARACTER FOUND
 5596:	  18EA	D5 45 F9		DJNZ	MT1,$-4		;LOOP UNTIL DONE
 5597:	  18ED	7D 58			MOV	R5,#'X'
 5598:	  18EF	31 90			ACALL	T_L
 5599:	  18F1	01 AB			AJMP	SERR1
 5600:					;
 5601:	  18F3	AB 0A		ER4:	MOV	R3,TXAH		;GET TEXT POINTER AND PERFORM SUBTRACTION
 5602:	  18F5	A9 08			MOV	R1,TXAL
 5603:	  18F7	02 0A 03		JMP	DUBSUB
 5604:					;
 5605:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 139



 Line  I  Addr  Code            Source

 5606:					;**************************************************************
 5607:					;
 5608:					; Interrupt driven timer
 5609:					;
 5610:					;**************************************************************
 5611:					;
 5612:	  18FA	85 4A 8C	I_DR:	MOV	TH0,SAVE_T	;LOAD THE TIMER
 5613:	  18FD	C5 47			XCH	A,MILLIV	;SAVE A, GET MILLI COUNTER
 5614:	  18FF	04			INC	A		;BUMP COUNTER
 5615:	  1900	B4 C8 08		CJNE	A,#200,TR	;CHECK OUT TIMER VALUE
 5616:	  1903	E4			CLR	A		;FORCE ACC TO BE ZERO
 5617:	  1904	05 49			INC	TVL		;INCREMENT LOW TIMER
 5618:	  1906	B5 49 02		CJNE	A,TVL,TR	;CHECK LOW VALUE
 5619:	  1909	05 48			INC	TVH		;BUMP TIMER HIGH
 5620:					;
 5621:	  190B	C5 47		TR:	XCH	A,MILLIV
 5622:	  190D	D0 D0			POP	PSW
 5623:	  190F	32			RETI
 5624:					;
 5625:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 140



 Line  I  Addr  Code            Source

 5626:				;$INCLUDE(:F2:BAS52.CLK)
 5627:				;BEGINNING
 5628:					;**************************************************************
 5629:					;
 5630:					; The statement action routine - CLOCK
 5631:					;
 5632:					;**************************************************************
 5633:					;
 5634:	  1910	31 2D		SCLOCK:	ACALL	OTST		;GET CHARACTER AFTER CLOCK TOKEN
 5635:	  1912	C2 A9			CLR	ET0
 5636:	  1914	C2 2E			CLR	C_BIT
 5637:	  1916	50 0A			JNC	SC_R		;EXIT IF A ZERO
 5638:	  1918	53 89 F0		ANL	TMOD,#0F0H	;SET UP THE MODE
 5639:	  191B	D2 2E			SETB	C_BIT		;USER INTERRUPTS
 5640:	  191D	43 A8 82		ORL	IE,#82H		;ENABLE ET0 AND EA
 5641:	  1920	D2 8C			SETB	TR0		;TURN ON THE TIMER
 5642:					;
 5643:	  1922	22		SC_R:	RET
 5644:					;
 5645:
 5646:				;END
 5647:				;$INCLUDE(:F2:BAS52.CLK)
 5648:					;***************************************************************
 5649:					;
 5650:	  1923			SUI:	; Statement USER IN action routine
 5651:					;
 5652:					;***************************************************************
 5653:					;
 5654:	  1923	31 2D			ACALL	OTST
 5655:	  1925	92 1E			MOV	CIUB,C		;SET OR CLEAR CIUB
 5656:	  1927	22			RET
 5657:					;
 5658:					;***************************************************************
 5659:					;
 5660:	  1928			SUO:	; Statement USER OUT action routine
 5661:					;
 5662:					;***************************************************************
 5663:					;
 5664:	  1928	31 2D			ACALL	OTST
 5665:	  192A	92 1C			MOV	COUB,C
 5666:	  192C	22			RET
 5667:					;
 5668:	  192D			OTST:	; Check for a one
 5669:					;
 5670:	  192D	12 0E D6		LCALL	GCI		;GET THE CHARACTER, CLEARS CARRY
 5671:	  1930	94 31			SUBB	A,#'1'		;SEE IF A ONE
 5672:	  1932	B3			CPL	C		;SETS CARRY IF ONE, CLEARS IT IF ZERO
 5673:	  1933	22			RET
 5674:					;
 5675:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 141



 Line  I  Addr  Code            Source

 5676:					;**************************************************************
 5677:					;
 5678:					; IBLK - EXECUTE USER SUPPLIED TOKEN
 5679:					;
 5680:					;**************************************************************
 5681:					;
 5682:	  1934	20 D4 FC	IBLK:	JB	PSW.4,IBLK-1	;EXIT IF REGISTER BANK <> 0
 5683:	  1937	20 D3 F9		JB	PSW.3,IBLK-1
 5684:	  193A	10 E7 06		JBC	ACC.7,$+9	;SEE IF BIT SEVEN IS SET
 5685:	  193D	90 00 47		MOV	DPTR,#USENT	;USER ENTRY LOCATION
 5686:	  1940	02 09 5D		LJMP	ISTA1
 5687:					;
 5688:	  1943	20 E0 59		JB	ACC.0,199FH	;FLOATING POINT INPUT
 5689:	  1946	60 48			JZ	T_L		;DO OUTPUT ON 80H
 5690:	  1948	90 19 91		MOV	DPTR,#FP_BASE-2
 5691:	  194B	73			JMP	@A+DPTR
 5692:					;
 5693:					;
 5694:					;**************************************************************
 5695:					;
 5696:					; GET_NUM - GET A NUMBER, EITHER HEX OR FLOAT
 5697:					;
 5698:					;**************************************************************
 5699:					;
 5700:	  194C	31 9D		GET_NUM:ACALL	FP_BASE+10	;SCAN FOR HEX
 5701:	  194E	50 4F			JNC	FP_BASE+12	;DO FP INPUT
 5702:					;
 5703:	  1950	31 A5			ACALL	FP_BASE+18	;ASCII STRING TO R2:R0
 5704:	  1952	70 36			JNZ	H_RET
 5705:	  1954	C0 83			PUSH	DPH		;SAVE THE DATA_POINTER
 5706:	  1956	C0 82			PUSH	DPL
 5707:	  1958	31 AB			ACALL	FP_BASE+24	;PUT R2:R0 ON THE STACK
 5708:	  195A	D0 82			POP	DPL		;RESTORE THE DATA_POINTER
 5709:	  195C	D0 83			POP	DPH
 5710:	  195E	E4			CLR	A		;NO ERRORS
 5711:	  195F	22			RET			;EXIT
 5712:					;
 5713:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 142



 Line  I  Addr  Code            Source

 5714:					;**************************************************************
 5715:					;
 5716:					; WB - THE EGO MESSAGE
 5717:					;
 5718:					;**************************************************************
 5719:					;
 5720:	  1960	D7 D2		WB:	DB	'W'+80H,'R'+80H
 5721:	  1962	C9 D4 54 C5		DB	'I'+80H,'T'+80H,'T','E'+80H,'N'+80H
	  1966	CE
 5722:	  1967	20 C2 D9 20		DB	' ','B'+80H,'Y'+80H,' '
 5723:	  196B	CA CF C8 CE		DB	'J'+80H,'O'+80H,'H'+80H,'N'+80H,' '+80H
	  196F	A0
 5724:	  1970	4B C1 D4 C1		DB	'K','A'+80H,'T'+80H,'A'+80H,'U'+80H
	  1974	D5
 5725:	  1975	53 CB D9		DB	'S','K'+80H,'Y'+80H
 5726:	  1978	2C 20 49 CE		DB	', I','N'+80H,'T'+80H,'E'+80H,'L'+80H
	  197C	D4 C5 CC
 5727:	  197F	A0 C3 CF D2		DB	' '+80H,'C'+80H,'O'+80H,'R'+80H,'P'+80H
	  1983	D0
 5728:	  1984	2E 20 31 B9		DB	'. 1','9'+80H,'85'
	  1988	38 35
 5729:	  198A	22		H_RET:	RET
 5730:					;
 5731:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 143



 Line  I  Addr  Code            Source

 5732:		N      1990		ORG	1990H
 5733:					;
 5734:	  1990	02 07 09	T_L:	LJMP	TEROT
 5735:					;
 5736:		N      1F78		ORG	1F78H
 5737:					;
 5738:	  1F78	20 1A 03	CKS_I:	JB	CKS_B,CS_I
 5739:	  1F7B	02 40 1B		LJMP	401BH
 5740:					;
 5741:	  1F7E	02 20 88	CS_I:	LJMP	2088H
 5742:					;
 5743:	  1F81	4E 4F 20 44	E14X:	DB	'NO DATA"'
	  1F85	41 54 41 22
 5744:					;
 5745:	  1F89	94		E11X:	DB	128+20
 5746:	  1F8A	41 52 49 54		DB	'ARITH. OVERFLOW"'
	  1F8E	48 2E 20 4F
	  1F92	56 45 52 46
	  1F96	4C 4F 57 22
 5747:					;
 5748:	  1F9A	50 52 4F 47	E16X:	DB	'PROGRAMMING"'
	  1F9E	52 41 4D 4D
	  1FA2	49 4E 47 22
 5749:					;
 5750:	  1FA6	43 41 4E	E15X:	DB	'CAN'
 5751:	  1FA9	27			DB	27H
 5752:	  1FAA	54 20 43 4F		DB	'T CONTINUE"'
	  1FAE	4E 54 49 4E
	  1FB2	55 45 22
 5753:					;
 5754:	  1FB5	49 4E 56 41	E10X:	DB	'INVALID LINE NUMBER"'
	  1FB9	4C 49 44 20
	  1FBD	4C 49 4E 45
	  1FC1	20 4E 55 4D
	  1FC5	42 45 52 22
 5755:					;
 5756:	  1FC9	50 52 4F 4D	NOROM:	DB	'PROM MODE"'
	  1FCD	20 4D 4F 44
	  1FD1	45 22
 5757:					;
 5758:	  1FD3	2A 4D 43 53	S_N:	DB	'*MCS-51(tm) BASIC V1.1*"'
	  1FD7	2D 35 31 28
	  1FDB	74 6D 29 20
	  1FDF	42 41 53 49
	  1FE3	43 20 56 31
	  1FE7	2E 31 2A 22
 5759:					;
 5760:		N      1FF8		ORG	1FF8H
 5761:					;
 5762:	  1FF8	45 52 52 4F	ERS:	DB	'ERROR: "'
	  1FFC	52 3A 20 22
 5763:					;
 5764:				$EJECT

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 144



 Line  I  Addr  Code            Source

 5765:					;***************************************************************
 5766:					;
 5767:					XSEG	;External Ram
 5768:					;
 5769:					;***************************************************************
 5770:					;
 5771:	  0000	N      0004		DS	4
 5772:	  0004	N      0001	IBCNT:	DS	1		;LENGTH OF A LINE
 5773:	  0005	N      0002	IBLN:	DS	2		;THE LINE NUMBER
 5774:	  0007	N      0049	IBUF:	DS	LINLEN		;THE INPUT BUFFER
 5775:	  0050	N      000F	CONVT:	DS	15		;CONVERSION LOCATION FOR FPIN
 5776:					;
 5777:		N      0100		ORG	100H
 5778:					;
 5779:	  0100	N      0001	GTB:	DS	1		;GET LOCATION
 5780:	  0101	N      0001	ERRLOC:	DS	1		;ERROR TYPE
 5781:	  0102	N      0002	ERRNUM:	DS	2		;WHERE TO GO ON AN ERROR
 5782:	  0104	N      0002	VARTOP:	DS	2		;TOP OF VARIABLE STORAGE
 5783:	  0106	N      0002	ST_ALL:	DS	2		;STORAGE ALLOCATION
 5784:	  0108	N      0002	MT_ALL:	DS	2		;MATRIX ALLOCATION
 5785:	  010A	N      0002	MEMTOP:	DS	2		;TOP OF MEMORY
 5786:	  010C	N      0002	RCELL:	DS	2		;RANDOM NUMBER CELL
 5787:	  010E	N      0005		DS	FPSIZ-1
 5788:	  0113	N      0001	CXTAL:	DS	1		;CRYSTAL
 5789:	  0114	N      0005		DS	FPSIZ-1
 5790:	  0119	N      0001	FPT1:	DS	1		;FLOATINP POINT TEMP 1
 5791:	  011A	N      0005		DS	FPSIZ-1
 5792:	  011F	N      0001	FPT2:	DS	1		;FLOATING POINT TEMP 2
 5793:	  0120	N      0002	INTLOC:	DS	2		;LOCATION TO GO TO ON INTERRUPT
 5794:	  0122	N      0002	STR_AL:	DS	2		;STRING ALLOCATION
 5795:	  0124	N      0002	SPV:	DS	2		;SERIAL PORT BAUD RATE
 5796:	  0126	N      0002	TIV:	DS	2		;TIMER INTERRUPT NUM AND LOC
 5797:	  0128	N      0002	PROGS:	DS	2		;PROGRAM A PROM TIME OUT
 5798:	  012A	N      0002	IPROGS:	DS	2		;INTELLIGENT PROM PROGRAMMER TIMEOUT
 5799:	  012C	N      0001	TM_TOP:	DS	1
 5800:
 5801:					END





                     register banks used:  ---

                     no errors




ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 145





	       L I S T   O F   S Y M B O L S
	       =============================


SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
??ASEM_51			  NUMBER    8051
??VERSION			  NUMBER    0130
AABS				  CODE	    1378	4332
AADD				  CODE	    1736	5301
AANL				  CODE	    146D	4626
AATAN				  CODE	    11C9	3987
AC				  BIT	      D6
AC1				  CODE	    096D	2200
ACBYTE				  CODE	    1396	4378
ACC				  DATA	      E0
ACOS				  CODE	    1156	3882
ADBYTE				  CODE	    139F	4390
ADDPTR				  CODE	    05D6	1479
ADIV				  CODE	    13F3	4479
AEL1				  CODE	    126B	4126
AELP				  CODE	    1259	4114
AEQ				  CODE	    13C4	4440
AETOX				  CODE	    1310	4251
AEXL				  CODE	    1337	4274
AEXP				  CODE	    1314	4254
AFREE				  CODE	    1706	5274
AGE				  CODE	    13D0	4448
AGET				  CODE	    1492	4660
AGT				  CODE	    13AE	4422
AI1				  CODE	    1363	4310
AI2				  CODE	    136B	4317
AI3				  CODE	    1377	4327
AINT				  CODE	    1356	4299
AL				  CODE	    0D50	3002
ALE				  CODE	    13D4	4451
ALED				  BIT	      93	 285
ALEN				  CODE	    1716	5283
ALN				  CODE	    12A9	4183
ALN11				  CODE	    12D8	4212
ALNE				  CODE	    12CE	4206
ALNL				  CODE	    12BC	4196
ALNO				  CODE	    12E1	4218
ALPAR				  CODE	    1395	4373
ALT				  CODE	    13BF	4436
AMUL				  CODE	    1199	3938
ANE				  CODE	    13CA	4444
ANEG				  CODE	    138A	4361
ANOT				  CODE	    147F	4642
ANU				  CODE	    0D45	2996
AORL				  CODE	    1476	4634
AP1				  CODE	    14CE	4721
APCON				  CODE	    14D2	4724
ARCAP2				  CODE	    14C8	4715
ARGF				  BIT	      24	 261
ARND				  CODE	    13DA	4458

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 146



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
ASGN				  CODE	    137E	4344
ASIN				  CODE	    115A	3891
ASQR				  CODE	    1276	4140
ASTKA				  NUMBER    0009	 199
ASTKAH				  NUMBER    0001	 334
ASUB				  CODE	    1711	5280
AT2CON				  CODE	    14BC	4705
ATAN				  CODE	    11B9	3971
ATCON				  CODE	    14C0	4709
ATIM0				  CODE	    14AA	4691
ATIM1				  CODE	    14B0	4695
ATIM2				  CODE	    14B6	4699
ATIME				  CODE	    171E	5288
ATMOD				  CODE	    14C4	4712
ATTAB				  CODE	    1113	3796
AXBYTE				  CODE	    13A7	4401
AXRL				  CODE	    1481	4644
AXTAL				  CODE	    0FDA	3549
AXTAL0				  CODE	    1640	5082
AXTAL1				  CODE	    1645	5085
AXTAL2				  CODE	    166E	5105
AXTAL3				  CODE	    1208	4038
A_D				  CODE	    1249	4098
A_IE				  CODE	    14A2	4685
A_IP				  CODE	    14A6	4688
B				  DATA	      F0
BABC				  NUMBER    0027	 292
BCHR				  CODE	    0833	1993
BCK				  CODE	    0785	1860
BELL				  NUMBER    0007	 322
BG1				  CODE	    041C	1063
BG2				  CODE	    0424	1069
BG3				  CODE	    0437	1077
BI				  BIT	      32	 275
BO				  BIT	      2C	 269
BOFAH				  NUMBER    0013	 220
BOFAL				  NUMBER    0014	 221
BR0				  CODE	    07F5	1945
BR2				  CODE	    0842	1999
BS				  NUMBER    0008	 323
B_C				  CODE	    0AA5	2445
B_TXA				  CODE	    0F24	3405
C0				  CODE	    0CF7	2945
C0C				  CODE	    1008	3605
C0ORX1				  BIT	      34	 277
C1				  CODE	    0CFE	2949
C1C				  CODE	    1013	3611
C2				  CODE	    0D07	2954
C2C				  CODE	    1012	3609
C3C				  CODE	    1018	3615
CBIAS				  CODE	    1670	5107
CC1				  CODE	    183C	5474
CCAL				  CODE	    0516	1236
CCLR3				  CODE	    0684	1664
CCONT				  CODE	    1836	5471
CILOOP				  CODE	    0813	1973

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 147



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
CIPROG				  CODE	    045A	1111
CIUB				  BIT	      1E	 253
CI_RET				  CODE	    07BA	1893
CKS_B				  BIT	      1A	 245
CKS_I				  CODE	    1F78	5738
CL1				  CODE	    1052	3654
CL2				  CODE	    1057	3657
CL3				  CODE	    1075	3673
CL6				  CODE	    1077	3675
CL7				  CODE	    1080	3679
CLIST				  CODE	    1031	3637
CLN_UP				  CODE	    0F18	3397
CL_1				  CODE	    0675	1652
CL_2				  CODE	    0683	1662
CMND1				  CODE	    177C	5359
CMND3				  CODE	    17C2	5395
CMND5				  CODE	    17DB	5406
CMNDD				  CODE	    010D	 495
CMNDLK				  CODE	    0859	2012
CMNDR				  CODE	    1792	5373
CMNDSP				  NUMBER    004D	 314
CMNX				  CODE	    1799	5377
CMPLK				  CODE	    11F1	4016
CN0				  CODE	    0FFF	3600
CNEW				  CODE	    0654	1616
CNTRLC				  NUMBER    0003	 324
CNTRLD				  NUMBER    0004	 325
CNT_S				  BIT	      35	 278
CNULL				  CODE	    0B09	2555
CNX				  CODE	    0FFA	3597
COB				  BIT	      1B	 246
CONB				  BIT	      17	 242
CONST				  CODE	    0FF0	3588
CONVT				  XDATA	    0050	5775
COUB				  BIT	      1C	 249
CPROG				  CODE	    0461	1115
CPS				  CODE	    0EAA	3264
CR				  NUMBER    000D	 320
CR0				  CODE	    03E3	1033
CR1				  CODE	    03F4	1044
CR2				  CODE	    0400	1050
CRAM				  CODE	    1774	5346
CRLF				  CODE	    069D	1697
CRLF2				  CODE	    069B	1695
CROM				  CODE	    0536	1279
CRP				  CODE	    06A5	1706
CRS				  CODE	    03D7	1027
CRST				  CODE	    0387	 973
CRUN				  CODE	    0806	1965
CS1				  CODE	    0B48	2626
CSC				  CODE	    0BBE	2712
CSETUP				  CODE	    0B4C	2629
CSTAKA				  CODE	    1415	4522
CSTAKA2				  CODE	    1413	4520
CSTKA				  NUMBER    0011	 215
CSTKAH				  NUMBER    0000	 335

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 148



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
CSTS				  CODE	    07C4	1910
CSY				  CODE	    0A1F	2341
CS_I				  CODE	    1F7E	5741
CXFER				  CODE	    1768	5332
CXTAL				  XDATA	    0113	5788
CY				  BIT	      D7
C_1				  CODE	    0F13	3394
C_2				  CODE	    0F0E	3391
C_BIT				  BIT	      2E	 271
C_EX				  CODE	    07D8	1926
C_K				  CODE	    053A	1286
C_T2				  CODE	    1455	4594
C_TST				  CODE	    0EC7	3291
D1				  CODE	    05D4	1468
DACK				  BIT	      96	 282
DBTWO				  CODE	    117D	3912
DCMPX				  CODE	    05C4	1456
DEC3210				  CODE	    1574	4876
DEC76				  CODE	    1630	5058
DECDP				  CODE	    05BA	1437
DECDP2				  CODE	    05B8	1435
DEC_ASTKA			  CODE	    11F4	4020
DEC_R				  CODE	    1572	4873
DELTST				  CODE	    0EE2	3328
DIGIT				  NUMBER    0004	 344
DIRF				  BIT	      2F	 272
DLD				  CODE	    0623	1562
DPH				  DATA	      83
DPL				  DATA	      82
DP_B				  CODE	    0E9C	3256
DP_T				  CODE	    0EA3	3260
DRQ				  BIT	      31	 274
DT1				  CODE	    0EE9	3333
DTEMP				  CODE	    1845	5480
DTYPE				  NUMBER    0003	 338
DUBSUB				  CODE	    0A03	2310
D_CHK				  CODE	    0DCD	3085
D_L1				  CODE	    0AF9	2532
E10X				  CODE	    1FB5	5754
E11X				  CODE	    1F89	5745
E14X				  CODE	    1F81	5743
E15X				  CODE	    1FA6	5750
E16X				  CODE	    1F9A	5748
E1X				  CODE	    173B	5312
E1XX				  CODE	    187D	5524
E2X				  CODE	    1746	5313
E3X				  CODE	    1820	5459
E3XX				  CODE	    09BE	2260
E4XX				  CODE	    0BC2	2715
E4YY				  CODE	    1203	4034
E5X				  CODE	    180E	5457
E6X				  CODE	    1756	5316
E7X				  CODE	    17FC	5454
EA				  BIT	      AF
EATC				  CODE	    0CE6	2928
EBIAS				  CODE	    124A	4106

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 149



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
EIG				  CODE	    0369	 961
EIGP				  CODE	    0E4F	3167
EK				  CODE	    0C0F	2779
ENDBIT				  BIT	      29	 266
EOF				  NUMBER    0001	 333
EP1				  CODE	    0F46	3449
EP2				  CODE	    0F4A	3452
EP3				  CODE	    0F70	3471
EP4				  CODE	    0F72	3473
EP5				  CODE	    0F83	3482
ER0				  CODE	    186C	5512
ER1				  CODE	    18B0	5561
ER2				  CODE	    18BA	5573
ER3				  CODE	    18C9	5581
ER4				  CODE	    18F3	5601
ERL4				  CODE	    0848	2003
ERPAR				  CODE	    0CE4	2926
ERRLK				  CODE	    04D3	1181
ERRLOC				  XDATA	    0101	5780
ERRNUM				  XDATA	    0102	5781
ERROR				  CODE	    1887	5540
ERROR0				  CODE	    1893	5547
ERRS				  CODE	    18A5	5555
ERS				  CODE	    1FF8	5762
ES				  BIT	      AC
ET0				  BIT	      A9
ET1				  BIT	      AB
EX0				  BIT	      A8
EX1				  BIT	      AA
EXA				  CODE	    0377	 963
EXC				  CODE	    037F	 965
EXI				  CODE	    182E	5462
EXP1				  CODE	    17EA	5426
EXP11				  CODE	    17E4	5419
EXPRB				  CODE	    0F44	3447
EXTI0				  CODE	    0003
EXTI1				  CODE	    0013
E_FIND				  CODE	    0A94	2435
F0				  BIT	      D5
FCMP				  CODE	    11EB	4012
FINDC				  CODE	    0EEF	3346
FINDCR				  CODE	    0EED	3344
FL1				  CODE	    0AD4	2497
FL2				  CODE	    0AED	2515
FL3				  CODE	    0ADD	2504
FNDCL2				  CODE	    0EF7	3352
FORMAT				  NUMBER    0017	 224
FPONE				  CODE	    16E7	5251
FPSIZ				  NUMBER    0006	 343
FPT1				  XDATA	    0119	5790
FPT2				  XDATA	    011F	5792
FPTS				  CODE	    102E	3628
FPTST				  CODE	    101B	3617
FP_BASE				  NUMBER    1993	 346
FS				  CODE	    13B9	4429
FSIZE				  NUMBER    0011	 348

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 150



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
FSTK				  CODE	    13B4	4426
FTYPE				  NUMBER    0001	 336
FUL1				  CODE	    1599	4931
FULL				  CODE	    1591	4924
F_VAR				  CODE	    0611	1549
F_VAR0				  CODE	    0618	1553
F_VAR1				  CODE	    062E	1570
F_VAR2				  CODE	    063B	1582
G1				  CODE	    0587	1375
G2				  CODE	    059A	1385
G3				  CODE	    059E	1388
G4				  CODE	    05A1	1391
G5				  CODE	    05A4	1393
GC				  CODE	    0ECE	3304
GCI				  CODE	    0ED6	3310
GCI1				  CODE	    0ED8	3314
GETEND				  CODE	    0582	1371
GETLIN				  CODE	    0584	1373
GET_NUM				  CODE	    194C	5700
GLN				  CODE	    0AD2	2495
GTB				  XDATA	    0100	5779
GTRD				  BIT	      18	 243
GTX				  CODE	    1530	4801
GTYPE				  NUMBER    0002	 337
HMODE				  BIT	      37	 280
H_RET				  CODE	    198A	5729
I2				  CODE	    1224	4068
IAN				  CODE	    00F1	 483
IAT				  CODE	    090C	2144
IBCNT				  XDATA	    0004	5772
IBLK				  CODE	    1934	5682
IBLN				  XDATA	    0005	5773
IBUF				  XDATA	    0007	5774
ICLR				  CODE	    0692	1679
IE				  DATA	      A8
IE0				  BIT	      89
IE1				  BIT	      8B
IFIX				  CODE	    120C	4046
IFIXL				  CODE	    0E91	3236
IGC				  CODE	    0ECC	3302
ILOOP				  CODE	    0817	1978
IMOV				  CODE	    154F	4826
IN2				  CODE	    0DFE	3123
IN2A				  CODE	    0E03	3126
IN3				  CODE	    0E10	3132
IN3A				  CODE	    0E21	3142
IN5				  CODE	    0E41	3159
IN6				  CODE	    0E4A	3163
INBIT				  BIT	      1D	 252
INC3210				  CODE	    155F	4848
INCH1				  CODE	    07A2	1881
INCHAR				  CODE	    0789	1870
INC_ASTKA			  CODE	    1238	4083
INL0				  CODE	    06CE	1741
INL1				  CODE	    06D5	1746
INL2				  CODE	    06CB	1739

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 151



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
INL2B				  CODE	    06E4	1755
INL6				  CODE	    06F6	1765
INLINE				  CODE	    06D0	1743
INLX				  CODE	    06E0	1752
INPROG				  BIT	      11	 236
INP_B				  BIT	      22	 259
INS				  CODE	    0101	 487
INSR				  CODE	    1500	4767
INT0				  BIT	      B2
INT1				  BIT	      B3
INTBIT				  BIT	      12	 237
INTELB				  BIT	      33	 276
INTERR				  CODE	    0F31	3423
INTERX				  CODE	    0939	2170
INTGER				  CODE	    0F36	3427
INTLOC				  XDATA	    0120	5793
INTPEN				  BIT	      16	 241
INTXAH				  NUMBER    0042	 304
INTXAL				  NUMBER    0043	 305
IP				  DATA	      B8
IPROGS				  XDATA	    012A	5798
IPTIME				  CODE	    17F0	5433
IRAMTOP				  NUMBER    00FF	 315
ISAV				  BIT	      2B	 268
ISTA0				  CODE	    0951	2182
ISTA1				  CODE	    095D	2188
ISTAT				  CODE	    08F9	2135
ISTAX				  CODE	    091D	2153
ISTAX1				  CODE	    0922	2156
ISTAY				  CODE	    0926	2160
IST_CAL				  CODE	    09E8	2295
IT0				  BIT	      88
IT1				  BIT	      8A
ITRAP				  CODE	    086E	2036
ITRET				  CODE	    0F41	3433
I_DL				  CODE	    1853	5491
I_DR				  CODE	    18FA	5612
I_L				  CODE	    084D	2006
I_PI				  CODE	    0E96	3243
I_RET				  CODE	    1869	5507
I_S				  CODE	    0934	2167
I_T0				  BIT	      26	 263
JKBIT				  BIT	      28	 265
L20DPI				  CODE	    056B	1320
L31DPI				  CODE	    05B2	1422
LCLR				  CODE	    05DF	1488
LDPTRI				  CODE	    05A8	1406
LD_A				  CODE	    0FEA	3577
LD_T				  CODE	    057A	1347
LF				  NUMBER    000A	 321
LIN1				  CODE	    1545	4814
LINE				  CODE	    14D9	4740
LINEB				  BIT	      15	 240
LINLEN				  NUMBER    0049	 332
LMOV				  CODE	    1556	4842
LNTAB				  CODE	    169E	5152

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 152



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
LN_D				  CODE	    1304	4236
LP				  BIT	      97	 281
LPB				  BIT	      19	 244
LTOUT1				  CODE	    0742	1818
LTX				  CODE	    1511	4782
L_RET				  CODE	    0EEC	3335
MEMTOP				  XDATA	    010A	5785
MILLIV				  NUMBER    0047	 308
MT1				  NUMBER    0045	 306
MT2				  NUMBER    0046	 307
MT_ALL				  XDATA	    0108	5784
MU1				  CODE	    1354	4290
N4				  CODE	    0BC7	2718
NLC				  CODE	    0772	1846
NMOV				  CODE	    1586	4906
NOGO				  CODE	    0566	1314
NOPASS				  CODE	    0F22	3402
NOROM				  CODE	    1FC9	5756
NO_C				  BIT	      30	 273
NTWO				  CODE	    114A	3861
NULL				  NUMBER    0000	 326
NULLCT				  NUMBER    0015	 222
NUMC				  CODE	    0C1A	2786
NUMC1				  CODE	    0C23	2791
ONE				  CODE	    0E8F	3230
ON_ERR				  BIT	      13	 238
OOPS				  CODE	    0D3B	2981
OPBOL				  CODE	    00CD	 440
OPTAB				  CODE	    0057	 372
OTI				  BIT	      14	 239
OTS				  BIT	      10	 235
OTST				  CODE	    192D	5668
OV				  BIT	      D2
P				  BIT	      D0
P0				  DATA	      80
P1				  DATA	      90
P2				  DATA	      A0
P3				  DATA	      B0
PAREN_INT			  CODE	    0E98	3249
PCL				  CODE	    1422	4537
PCON				  DATA	      87
PG1				  CODE	    0495	1144
PG11				  CODE	    0505	1213
PG2				  CODE	    049D	1149
PG3				  CODE	    04A5	1154
PG4				  CODE	    04B1	1161
PG5				  CODE	    04C3	1172
PG6				  CODE	    04C8	1176
PG7				  CODE	    04D6	1184
PG8				  CODE	    043F	1094
PG9				  CODE	    04F0	1202
PGR				  CODE	    0491	1141
PGU				  CODE	    050C	1223
PHEAD				  NUMBER    0016	 223
PIE				  CODE	    17F6	5440
PIPI				  CODE	    1468	4616

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 153



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
PLNEXP				  CODE	    1419	4525
PMTOP				  CODE	    1638	5071
PN0				  CODE	    06BB	1724
PN1				  CODE	    06B1	1715
POLY1				  CODE	    118C	3930
POLYC				  CODE	    1184	3921
POPAS				  CODE	    0FD4	3546
POP_T1				  CODE	    1431	4554
POTWO				  CODE	    117B	3910
PP				  CODE	    15A3	4948
PPL				  CODE	    15B6	4959
PPL1				  CODE	    15BB	4962
PPL2				  CODE	    15C0	4967
PPL3				  CODE	    15D9	4984
PPL4				  CODE	    15DE	4990
PPL6				  CODE	    160B	5023
PPL7				  CODE	    1618	5031
PPL9				  CODE	    162C	5044
PPLX				  CODE	    15F2	5008
PPLY				  CODE	    15FF	5014
PPX				  CODE	    15CE	4975
PRNTCR				  CODE	    06B9	1722
PROGS				  XDATA	    0128	5797
PROMP				  BIT	      94	 284
PROMV				  BIT	      95	 283
PS				  BIT	      BC
PSTART				  NUMBER    0200	 347
PSW				  DATA	      D0
PT0				  BIT	      B9
PT1				  BIT	      BB
PTIME				  CODE	    0701	1772
PUSHAS				  CODE	    0FDE	3556
PUSHC				  CODE	    141C	4533
PUSHCS				  CODE	    0BB2	2703
PUSH_ONE			  CODE	    142C	4547
PUSH_T1				  CODE	    1438	4560
PX0				  BIT	      B8
PX1				  BIT	      BA
P_E				  CODE	    0CE0	2923
P_T2				  CODE	    143F	4566
P_Z				  CODE	    135E	4307
R0B0				  NUMBER    0000	 186
R1B0				  NUMBER    0001	 187
R2B0				  NUMBER    0002	 188
R3B0				  NUMBER    0003	 189
R3CK				  CODE	    09D6	2276
R4B0				  NUMBER    0004	 190
R5B0				  NUMBER    0005	 191
R6B0				  NUMBER    0006	 192
R76S				  CODE	    0DF0	3103
R7B0				  NUMBER    0007	 193
RB8				  BIT	      9A
RC1				  CODE	    0667	1636
RC2				  CODE	    066B	1639
RCELL				  XDATA	    010C	5786
RCL				  CODE	    0889	2054

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 154



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
RCLEAR				  CODE	    065C	1630
RD				  BIT	      B7
RDYS				  CODE	    00FB	 485
RECIP				  CODE	    1265	4122
REN				  BIT	      9C
RESET				  CODE	    0000
RETBIT				  BIT	      25	 262
RF1				  CODE	    0556	1301
RF2				  CODE	    055D	1307
RF3				  CODE	    0563	1312
RFX				  CODE	    055C	1305
RI				  BIT	      98
RL1				  CODE	    0AF5	2528
RLINE				  CODE	    0AF3	2526
RMOV				  CODE	    156A	4868
RO1				  CODE	    053D	1288
ROMADR				  NUMBER    8000	 339
ROMFD				  CODE	    0553	1299
ROM_P				  CODE	    06A7	1708
RROM				  CODE	    07BC	1902
RS0				  BIT	      D3
RS1				  BIT	      D4
RTST				  CODE	    0AC8	2477
RTXAH				  NUMBER    0012	 216
RTXAL				  NUMBER    0010	 214
RV				  CODE	    119E	3943
RXD				  BIT	      B0
S13				  CODE	    0D3E	2983
S20DP				  CODE	    140D	4506
S31DP				  CODE	    05FD	1517
S31DP2				  CODE	    05FB	1515
S31L				  CODE	    1703	5272
SA				  CODE	    0D1C	2968
SAVE_T				  NUMBER    004A	 311
SBAUD				  CODE	    16EE	5262
SBUF				  DATA	      99
SCALL				  CODE	    0E64	3187
SCLOCK				  CODE	    1910	5634
SCLR				  CODE	    0687	1668
SCON				  DATA	      98
SC_R				  CODE	    1922	5643
SD0				  CODE	    0D5D	3010
SDI				  CODE	    0DBD	3076
SDIMX				  CODE	    0D62	3013
SE0				  CODE	    0CBF	2889
SERR1				  CODE	    18AB	5558
SETREG				  CODE	    123C	4090
SF2				  CODE	    0A54	2382
SF3				  CODE	    0A73	2399
SFOR				  CODE	    0A3D	2370
SGOSUB				  CODE	    0B2E	2605
SGOTO				  CODE	    0AAB	2457
SGS0				  CODE	    0B30	2607
SGS1				  CODE	    0B36	2611
SGT1				  CODE	    0AAD	2459
SGT2				  CODE	    0ABA	2467

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 155



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
SIF				  CODE	    0A87	2428
SIN0				  CODE	    11E5	4001
SINPUT				  CODE	    0DF6	3117
SINT				  CODE	    0023
SINTAB				  CODE	    16C3	5203
SLET				  CODE	    096F	2210
SLET0				  CODE	    09C3	2263
SLET1				  CODE	    09C7	2266
SLET2				  CODE	    09C9	2268
SM				  CODE	    0C60	2839
SM0				  BIT	      9F
SM1				  BIT	      9E
SM2				  BIT	      9D
SNEXT				  CODE	    0B60	2647
SONERR				  CODE	    13F8	4485
SONEXT				  CODE	    1402	4497
SOT				  CODE	    0E57	3173
SP				  DATA	      81
SP0				  CODE	    0C3D	2816
SP1				  CODE	    0C44	2821
SP2				  CODE	    0C40	2818
SP4				  CODE	    0C48	2824
SP6				  CODE	    0C53	2830
SP7				  CODE	    0C58	2833
SP8				  CODE	    0C76	2850
SP9				  CODE	    0CD8	2910
SP9A				  CODE	    0CDF	2915
SPEOP				  CODE	    09DA	2279
SPH0				  CODE	    0C2A	2802
SPH1				  CODE	    0C2C	2804
SPINT				  BIT	      1F	 256
SPOP				  CODE	    0A7E	2415
SPRINT				  CODE	    0C2E	2806
SPSAV				  NUMBER    003E	 300
SPUSH				  CODE	    0A77	2409
SPV				  XDATA	    0124	5795
SP_H				  NUMBER    004B	 312
SP_L				  NUMBER    004C	 313
SQ				  CODE	    0C7D	2854
SQR1				  CODE	    128C	4153
SQR2				  CODE	    1293	4160
SQR4				  CODE	    1296	4165
SQ_ERR				  CODE	    1273	4131
SR0				  CODE	    0B15	2581
SRD				  CODE	    0BEA	2757
SRD0				  CODE	    0BE6	2754
SRD1				  CODE	    0BF3	2762
SRD2				  CODE	    0BF5	2764
SRD4				  CODE	    0C00	2771
SRD5				  CODE	    0C07	2775
SRD6				  CODE	    0C12	2781
SREAD				  CODE	    0BE4	2752
SRESTR				  CODE	    0BCF	2728
SRETI				  CODE	    0B0F	2570
SRETRN				  CODE	    0B11	2578
SRT				  CODE	    1202	4032

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 156



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
SS				  CODE	    0D13	2963
SSOOP				  CODE	    099E	2238
SSTOP				  CODE	    085C	2020
SSTOP0				  CODE	    0864	2024
STACKTP				  NUMBER    00FE	 316
STATD				  CODE	    0121	 513
STEROT				  CODE	    0707	1789
STESIZ				  NUMBER    0009	 345
STJ				  CODE	    0020	 123
STK				  CODE	    0041	 167
STONE				  CODE	    167B	5124
STONE1				  CODE	    1680	5131
STOPBIT				  BIT	      20	 257
STP				  CODE	    00EC	 481
STQ				  CODE	    0033	 159
STRING				  CODE	    0604	1528
STRIP				  CODE	    11C3	3977
STR_AL				  XDATA	    0122	5794
STS				  CODE	    003E	 165
STU				  CODE	    0044	 170
ST_A				  CODE	    0FE6	3567
ST_ALL				  XDATA	    0106	5783
SUI				  CODE	    1923	5650
SUNTIL				  CODE	    0B02	2546
SUO				  CODE	    1928	5660
SWAP_ASTKA			  CODE	    1443	4571
SWHILE				  CODE	    0AFD	2542
SX				  CODE	    0C82	2857
S_0				  CODE	    0983	2221
S_1				  CODE	    09B3	2253
S_3				  CODE	    0992	2231
S_4				  CODE	    09A0	2240
S_5				  CODE	    09AE	2250
S_C				  CODE	    0EC0	3279
S_C_1				  CODE	    0E73	3199
S_DO				  CODE	    0F06	3378
S_E				  CODE	    098D	2227
S_L				  CODE	    144A	4581
S_LEN				  NUMBER    003F	 301
S_N				  CODE	    1FD3	5758
S_ON				  CODE	    0CEC	2935
S_WU				  CODE	    0B04	2548
T0				  BIT	      B4
T1				  BIT	      B5
TB				  CODE	    159E	4934
TB8				  BIT	      9B
TBR				  CODE	    1582	4893
TBYTE				  CODE	    157F	4890
TCON				  DATA	      88
TEMP1				  NUMBER    000B	 204
TEMP2				  NUMBER    000C	 205
TEMP3				  NUMBER    000D	 206
TEMP4				  NUMBER    000E	 207
TEMP5				  NUMBER    000F	 208
TEMPD				  CODE	    184C	5484
TEMP_COMP			  CODE	    1305	4240

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 157



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
TEROT				  CODE	    0709	1791
TEROT1				  CODE	    075E	1834
TEROT2				  CODE	    076B	1841
TF0				  BIT	      8D
TF1				  BIT	      8F
TH0				  DATA	      8C
TH1				  DATA	      8D
THREE				  CODE	    0E79	3206
TI				  BIT	      99
TIMER0				  CODE	    000B
TIMER1				  CODE	    001B
TIMER_LOAD			  CODE	    0527	1261
TIV				  XDATA	    0126	5796
TL0				  DATA	      8A
TL1				  DATA	      8B
TMOD				  DATA	      89
TMR0				  NUMBER    00C8	 868
TMR1				  NUMBER    00C9	 872
TMR2				  NUMBER    00CA	 876
TM_TOP				  XDATA	    012C	5799
TOKTAB				  CODE	    0173	 562
TR				  CODE	    190B	5621
TR0				  BIT	      8C
TR1				  BIT	      8E
TRC2				  NUMBER    00CE	 896
TT2C				  NUMBER    00CB	 884
TTC				  NUMBER    00CC	 888
TTIME				  CODE	    1150	3868
TTM				  NUMBER    00CD	 892
TVH				  NUMBER    0048	 309
TVL				  NUMBER    0049	 310
TWO				  CODE	    0E86	3219
TWOL				  CODE	    148A	4652
TWO_EX				  CODE	    149C	4672
TWO_EY				  CODE	    149D	4675
TWO_R2				  CODE	    149A	4669
TXAH				  NUMBER    000A	 200
TXAL				  NUMBER    0008	 198
TXD				  BIT	      B1
TXX				  CODE	    0757	1830
T_1				  CODE	    0732	1809
T_ADD				  NUMBER    00E3	 749
T_ASC				  NUMBER    00D1	 908
T_BIT				  BIT	      92	 286
T_BUF				  CODE	    1761	5321
T_CHR				  NUMBER    00D3	 918
T_CMND				  NUMBER    00F0	 923
T_CMP				  CODE	    07E7	1934
T_CR				  NUMBER    00AA	 717
T_DATA				  NUMBER    009C	 664
T_DIR				  NUMBER    0090	 627
T_DP				  CODE	    0EB9	3273
T_ELSE				  NUMBER    00A8	 709
T_EQU				  NUMBER    00EA	 771
T_F1				  CODE	    0A9F	2441
T_GOSB				  NUMBER    009F	 674

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 158



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
T_GOTO				  NUMBER    0083	 577
T_HH				  NUMBER    0040	 302
T_IE				  NUMBER    00C6	 860
T_IP				  NUMBER    00C7	 864
T_L				  CODE	    1990	5734
T_LAST				  NUMBER    00A4	 691
T_LL				  NUMBER    0041	 303
T_LPAR				  NUMBER    00E0	 739
T_MTOP				  NUMBER    00C4	 856
T_NEG				  NUMBER    00E9	 769
T_P1				  NUMBER    00CF	 900
T_PC				  NUMBER    00D0	 904
T_REM				  NUMBER    0096	 645
T_SPC				  NUMBER    00A9	 713
T_STEP				  NUMBER    00A7	 705
T_STOP				  NUMBER    0090	 623
T_SUB				  NUMBER    00E5	 756
T_T				  CODE	    08B4	2092
T_T1				  CODE	    08D2	2106
T_T2				  CODE	    08E0	2114
T_TAB				  NUMBER    00A4	 693
T_THEN				  NUMBER    00A5	 697
T_TIME				  NUMBER    00C5	 880
T_TO				  NUMBER    00A6	 701
T_TRAP				  CODE	    08E6	2119
T_ULAST				  NUMBER    00BE	 835
T_UOP				  NUMBER    00B0	 791
T_USE				  NUMBER    00D2	 912
T_XTAL				  NUMBER    00C3	 852
T_X_S				  CODE	    0B3A	2614
U3				  CODE	    0C9C	2869
U4				  CODE	    0CA0	2872
U5				  CODE	    0CAA	2877
U5A				  CODE	    0CC1	2891
U6				  CODE	    0CCE	2903
U7				  CODE	    0CD0	2905
U8				  CODE	    0CCA	2900
U8A				  CODE	    0CC5	2895
U8B				  CODE	    0CC7	2897
UBIT				  BIT	      2A	 267
UE				  CODE	    14FC	4762
UOPBOL				  CODE	    00DE	 459
UPB				  BIT	      27	 264
UPP0				  CODE	    1097	3699
UPP1				  CODE	    10C6	3724
UPP1A				  CODE	    10C2	3721
UPP2				  CODE	    10D5	3731
UPP3				  CODE	    10EA	3744
UPP4				  CODE	    10F6	3752
UPP7				  CODE	    110A	3764
UPP7A				  CODE	    1108	3762
UPP8				  CODE	    110C	3766
UPP9				  CODE	    10B6	3714
UPPL				  CODE	    1086	3690
UPRNT				  CODE	    06B7	1720
UP_2				  CODE	    10E0	3738

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                        PAGE 159



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
UP_3				  CODE	    10E3	3740
USENT				  CODE	    0047	 353
U_ID1				  CODE	    1858	5498
U_IDL				  BIT	      21	 258
V4				  CODE	    0DB5	3069
VAR				  CODE	    0D66	3016
VAR1				  CODE	    0D68	3018
VAR2				  CODE	    0D9B	3050
VARB				  CODE	    0A0E	2326
VARCOP				  CODE	    145B	4606
VARD				  CODE	    0A11	2328
VARTOP				  XDATA	    0104	5782
VAR_ER				  CODE	    0F02	3368
VX				  CODE	    0D81	3037
VY				  CODE	    0D75	3027
V_C				  CODE	    145D	4608
WB				  CODE	    1960	5720
WCR				  CODE	    0EFD	3357
WE				  CODE	    0F42	3436
WR				  BIT	      B6
X3120				  CODE	    0DAE	3061
X31DP				  CODE	    0571	1333
XBILT				  CODE	    0FB9	3523
XBIT				  BIT	      2D	 270
XLPAR				  CODE	    0FC5	3529
XOP				  CODE	    0F87	3487
XOP1				  CODE	    0F91	3493
XOP2				  CODE	    0FB0	3516
XOP3				  CODE	    0FCB	3533
XPOP				  CODE	    0FD2	3538
XTALV				  CODE	    17DE	5412
XXI				  CODE	    0B68	2652
X_TR				  CODE	    0BD7	2735
ZRO				  CODE	    04E0	1190
ZSURP				  BIT	      36	 279
